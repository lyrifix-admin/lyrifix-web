var Rr=Object.defineProperty;var Dr=Object.getPrototypeOf;var Fr=Reflect.get;var Vr=(s,i,e)=>i in s?Rr(s,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[i]=e;var u=(s,i,e)=>Vr(s,typeof i!="symbol"?i+"":i,e);var de=(s,i,e)=>Fr(Dr(s),e,i);import{a as Et,B as ie,o as Ne}from"./chunk-NL6KNZEE-CxvR8bn4.js";import{o as Nr,d as Pi,s as ht}from"./hooks-PJGK5Pe1.js";var zr=Object.defineProperty,Br=(s,i,e)=>i in s?zr(s,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[i]=e,pi=(s,i,e)=>(Br(s,typeof i!="symbol"?i+"":i,e),e);function Hr(s){let i=e=>{var t;for(let r in e)((t=e[r])==null?void 0:t.constructor)===Object&&(e[r]=i(e[r]));return{...e}};return i(s)}var x=class{constructor(s){s.constructor===Object?this.store=Hr(s):(this._storeIsProxy=!0,this.store=s),this.callbackMap=Object.create(null)}static warn(s,i){console.warn(`Symbiote Data: cannot ${s}. Prop name: `+i)}read(s){return!this._storeIsProxy&&!this.store.hasOwnProperty(s)?(x.warn("read",s),null):this.store[s]}has(s){return this._storeIsProxy?this.store[s]!==void 0:this.store.hasOwnProperty(s)}add(s,i,e=!1){!e&&Object.keys(this.store).includes(s)||(this.store[s]=i,this.notify(s))}pub(s,i){if(!this._storeIsProxy&&!this.store.hasOwnProperty(s)){x.warn("publish",s);return}this.store[s]=i,this.notify(s)}multiPub(s){for(let i in s)this.pub(i,s[i])}notify(s){this.callbackMap[s]&&this.callbackMap[s].forEach(i=>{i(this.store[s])})}sub(s,i,e=!0){return!this._storeIsProxy&&!this.store.hasOwnProperty(s)?(x.warn("subscribe",s),null):(this.callbackMap[s]||(this.callbackMap[s]=new Set),this.callbackMap[s].add(i),e&&i(this.store[s]),{remove:()=>{this.callbackMap[s].delete(i),this.callbackMap[s].size||delete this.callbackMap[s]},callback:i})}static registerCtx(s,i=Symbol()){let e=x.globalStore.get(i);return e?console.warn('State: context UID "'+i+'" already in use'):(e=new x(s),x.globalStore.set(i,e)),e}static deleteCtx(s){x.globalStore.delete(s)}static getCtx(s,i=!0){return x.globalStore.get(s)||(i&&console.warn('State: wrong context UID - "'+s+'"'),null)}};x.globalStore=new Map;var w=Object.freeze({BIND_ATTR:"set",ATTR_BIND_PRFX:"@",EXT_DATA_CTX_PRFX:"*",NAMED_DATA_CTX_SPLTR:"/",CTX_NAME_ATTR:"ctx-name",CTX_OWNER_ATTR:"ctx-owner",CSS_CTX_PROP:"--ctx-name",EL_REF_ATTR:"ref",AUTO_TAG_PRFX:"sym",REPEAT_ATTR:"repeat",REPEAT_ITEM_TAG_ATTR:"repeat-item-tag",SET_LATER_KEY:"__toSetLater__",USE_TPL:"use-template",ROOT_STYLE_ATTR_NAME:"sym-component"}),bs="1234567890QWERTYUIOPASDFGHJKLZXCVBNMqwertyuiopasdfghjklzxcvbnm",jr=bs.length-1,ot=class{static generate(s="XXXXXXXXX-XXX"){let i="";for(let e=0;e<s.length;e++)i+=s[e]==="-"?s[e]:bs.charAt(Math.random()*jr);return i}};function _s(s,i,e){let t=!0,r,n=i.split(".");return n.forEach((o,a)=>{a<n.length-1?s=s[o]:r=o}),s?s[r]=e:t=!1,t}function Gr(s){return s.split("-").map((i,e)=>i&&e?i[0].toUpperCase()+i.slice(1):i).join("").split("_").map((i,e)=>i&&e?i.toUpperCase():i).join("")}function Wr(s,i){[...s.querySelectorAll(`[${w.REPEAT_ATTR}]`)].forEach(e=>{let t=e.getAttribute(w.REPEAT_ITEM_TAG_ATTR),r;if(t&&(r=window.customElements.get(t)),!r){r=class extends i.BaseComponent{constructor(){super(),t||(this.style.display="contents")}};let o=e.innerHTML;r.template=o,r.reg(t)}for(;e.firstChild;)e.firstChild.remove();let n=e.getAttribute(w.REPEAT_ATTR);i.sub(n,o=>{if(!o){for(;e.firstChild;)e.firstChild.remove();return}let a=[...e.children],l,c=d=>{d.forEach((f,m)=>{if(a[m])if(a[m].set$)setTimeout(()=>{a[m].set$(f)});else for(let p in f)a[m][p]=f[p];else{l||(l=new DocumentFragment);let p=new r;Object.assign(p.init$,f),l.appendChild(p)}}),l&&e.appendChild(l);let h=a.slice(d.length,a.length);for(let f of h)f.remove()};if(o.constructor===Array)c(o);else if(o.constructor===Object){let d=[];for(let h in o){let f=o[h];Object.defineProperty(f,"_KEY_",{value:h,enumerable:!0}),d.push(f)}c(d)}else console.warn("Symbiote repeat data type error:"),console.log(o)}),e.removeAttribute(w.REPEAT_ATTR),e.removeAttribute(w.REPEAT_ITEM_TAG_ATTR)})}var Ui="__default__";function qr(s,i){if(i.shadowRoot)return;let e=[...s.querySelectorAll("slot")];if(!e.length)return;let t={};e.forEach(r=>{let n=r.getAttribute("name")||Ui;t[n]={slot:r,fr:document.createDocumentFragment()}}),i.initChildren.forEach(r=>{var n;let o=Ui;r instanceof Element&&r.hasAttribute("slot")&&(o=r.getAttribute("slot"),r.removeAttribute("slot")),(n=t[o])==null||n.fr.appendChild(r)}),Object.values(t).forEach(r=>{if(r.fr.childNodes.length)r.slot.parentNode.replaceChild(r.fr,r.slot);else if(r.slot.childNodes.length){let n=document.createDocumentFragment();n.append(...r.slot.childNodes),r.slot.parentNode.replaceChild(n,r.slot)}else r.slot.remove()})}function Xr(s,i){[...s.querySelectorAll(`[${w.EL_REF_ATTR}]`)].forEach(e=>{let t=e.getAttribute(w.EL_REF_ATTR);i.ref[t]=e,e.removeAttribute(w.EL_REF_ATTR)})}function Zr(s,i){[...s.querySelectorAll(`[${w.BIND_ATTR}]`)].forEach(e=>{let r=e.getAttribute(w.BIND_ATTR).split(";");[...e.attributes].forEach(n=>{if(n.name.startsWith("-")&&n.value){let o=Gr(n.name.replace("-",""));r.push(o+":"+n.value),e.removeAttribute(n.name)}}),r.forEach(n=>{if(!n)return;let o=n.split(":").map(d=>d.trim()),a=o[0],l;a.indexOf(w.ATTR_BIND_PRFX)===0&&(l=!0,a=a.replace(w.ATTR_BIND_PRFX,""));let c=o[1].split(",").map(d=>d.trim());for(let d of c){let h;d.startsWith("!!")?(h="double",d=d.replace("!!","")):d.startsWith("!")&&(h="single",d=d.replace("!","")),i.sub(d,f=>{h==="double"?f=!!f:h==="single"&&(f=!f),l?(f==null?void 0:f.constructor)===Boolean?f?e.setAttribute(a,""):e.removeAttribute(a):e.setAttribute(a,f):_s(e,a,f)||(e[w.SET_LATER_KEY]||(e[w.SET_LATER_KEY]=Object.create(null)),e[w.SET_LATER_KEY][a]=f)})}}),e.removeAttribute(w.BIND_ATTR)})}var wt="{{",We="}}",Kr="skip-text";function Yr(s){let i,e=[],t=document.createTreeWalker(s,NodeFilter.SHOW_TEXT,{acceptNode:r=>{var n;return!((n=r.parentElement)!=null&&n.hasAttribute(Kr))&&r.textContent.includes(wt)&&r.textContent.includes(We)&&1}});for(;i=t.nextNode();)e.push(i);return e}var Jr=function(s,i){Yr(s).forEach(t=>{let r=[],n;for(;t.textContent.includes(We);)t.textContent.startsWith(wt)?(n=t.textContent.indexOf(We)+We.length,t.splitText(n),r.push(t)):(n=t.textContent.indexOf(wt),t.splitText(n)),t=t.nextSibling;r.forEach(o=>{let a=o.textContent.replace(wt,"").replace(We,"");o.textContent="",i.sub(a,l=>{o.textContent=l})})})},Qr=[Wr,qr,Xr,Zr,Jr],At="'",Oe='"',en=/\\([0-9a-fA-F]{1,6} ?)/g;function tn(s){return(s[0]===Oe||s[0]===At)&&(s[s.length-1]===Oe||s[s.length-1]===At)}function sn(s){return(s[0]===Oe||s[0]===At)&&(s=s.slice(1)),(s[s.length-1]===Oe||s[s.length-1]===At)&&(s=s.slice(0,-1)),s}function rn(s){let i="",e="";for(var t=0;t<s.length;t++){const r=s[t+1];s[t]==="\\"&&r==='"'?(i+='\\"',t++):s[t]==='"'&&e!=="\\"?i+='\\"':i+=s[t],e=s[t]}return i}function nn(s){let i=s;tn(s)&&(i=sn(i),i=i.replace(en,(e,t)=>String.fromCodePoint(parseInt(t.trim(),16))),i=i.replaceAll(`\\
`,"\\n"),i=rn(i),i=Oe+i+Oe);try{return JSON.parse(i)}catch{throw new Error(`Failed to parse CSS property value: ${i}. Original input: ${s}`)}}var Ri=0,Se=null,ne=null,he=class extends HTMLElement{constructor(){super(),pi(this,"updateCssData",()=>{var s;this.dropCssDataCache(),(s=this.__boundCssProps)==null||s.forEach(i=>{let e=this.getCssData(this.__extractCssName(i),!0);e!==null&&this.$[i]!==e&&(this.$[i]=e)})}),this.init$=Object.create(null),this.cssInit$=Object.create(null),this.tplProcessors=new Set,this.ref=Object.create(null),this.allSubs=new Set,this.pauseRender=!1,this.renderShadow=!1,this.readyToDestroy=!0,this.processInnerHtml=!1,this.allowCustomTemplate=!1,this.ctxOwner=!1}get BaseComponent(){return he}initCallback(){}__initCallback(){var s;this.__initialized||(this.__initialized=!0,(s=this.initCallback)==null||s.call(this))}render(s,i=this.renderShadow){let e;if((i||this.constructor.__shadowStylesUrl)&&!this.shadowRoot&&this.attachShadow({mode:"open"}),this.allowCustomTemplate){let r=this.getAttribute(w.USE_TPL);if(r){let n=this.getRootNode(),o=(n==null?void 0:n.querySelector(r))||document.querySelector(r);o?s=o.content.cloneNode(!0):console.warn(`Symbiote template "${r}" is not found...`)}}if(this.processInnerHtml)for(let r of this.tplProcessors)r(this,this);if(s||this.constructor.template){if(this.constructor.template&&!this.constructor.__tpl&&(this.constructor.__tpl=document.createElement("template"),this.constructor.__tpl.innerHTML=this.constructor.template),(s==null?void 0:s.constructor)===DocumentFragment)e=s;else if((s==null?void 0:s.constructor)===String){let r=document.createElement("template");r.innerHTML=s,e=r.content.cloneNode(!0)}else this.constructor.__tpl&&(e=this.constructor.__tpl.content.cloneNode(!0));for(let r of this.tplProcessors)r(e,this)}let t=()=>{e&&(i&&this.shadowRoot.appendChild(e)||this.appendChild(e)),this.__initCallback()};if(this.constructor.__shadowStylesUrl){i=!0;let r=document.createElement("link");r.rel="stylesheet",r.href=this.constructor.__shadowStylesUrl,r.onload=t,this.shadowRoot.prepend(r)}else t()}addTemplateProcessor(s){this.tplProcessors.add(s)}get autoCtxName(){return this.__autoCtxName||(this.__autoCtxName=ot.generate(),this.style.setProperty(w.CSS_CTX_PROP,`'${this.__autoCtxName}'`)),this.__autoCtxName}get cssCtxName(){return this.getCssData(w.CSS_CTX_PROP,!0)}get ctxName(){var s;let i=((s=this.getAttribute(w.CTX_NAME_ATTR))==null?void 0:s.trim())||this.cssCtxName||this.__cachedCtxName||this.autoCtxName;return this.__cachedCtxName=i,i}get localCtx(){return this.__localCtx||(this.__localCtx=x.registerCtx({},this)),this.__localCtx}get nodeCtx(){return x.getCtx(this.ctxName,!1)||x.registerCtx({},this.ctxName)}static __parseProp(s,i){let e,t;if(s.startsWith(w.EXT_DATA_CTX_PRFX))e=i.nodeCtx,t=s.replace(w.EXT_DATA_CTX_PRFX,"");else if(s.includes(w.NAMED_DATA_CTX_SPLTR)){let r=s.split(w.NAMED_DATA_CTX_SPLTR);e=x.getCtx(r[0]),t=r[1]}else e=i.localCtx,t=s;return{ctx:e,name:t}}sub(s,i,e=!0){let t=n=>{this.isConnected&&i(n)},r=he.__parseProp(s,this);r.ctx.has(r.name)?this.allSubs.add(r.ctx.sub(r.name,t,e)):window.setTimeout(()=>{this.allSubs.add(r.ctx.sub(r.name,t,e))})}notify(s){let i=he.__parseProp(s,this);i.ctx.notify(i.name)}has(s){let i=he.__parseProp(s,this);return i.ctx.has(i.name)}add(s,i,e=!1){let t=he.__parseProp(s,this);t.ctx.add(t.name,i,e)}add$(s,i=!1){for(let e in s)this.add(e,s[e],i)}get $(){if(!this.__stateProxy){let s=Object.create(null);this.__stateProxy=new Proxy(s,{set:(i,e,t)=>{let r=he.__parseProp(e,this);return r.ctx.pub(r.name,t),!0},get:(i,e)=>{let t=he.__parseProp(e,this);return t.ctx.read(t.name)}})}return this.__stateProxy}set$(s,i=!1){for(let e in s){let t=s[e];i||![String,Number,Boolean].includes(t==null?void 0:t.constructor)?this.$[e]=t:this.$[e]!==t&&(this.$[e]=t)}}get __ctxOwner(){return this.ctxOwner||this.hasAttribute(w.CTX_OWNER_ATTR)&&this.getAttribute(w.CTX_OWNER_ATTR)!=="false"}__initDataCtx(){let s=this.constructor.__attrDesc;if(s)for(let i of Object.values(s))Object.keys(this.init$).includes(i)||(this.init$[i]="");for(let i in this.init$)if(i.startsWith(w.EXT_DATA_CTX_PRFX))this.nodeCtx.add(i.replace(w.EXT_DATA_CTX_PRFX,""),this.init$[i],this.__ctxOwner);else if(i.includes(w.NAMED_DATA_CTX_SPLTR)){let e=i.split(w.NAMED_DATA_CTX_SPLTR),t=e[0].trim(),r=e[1].trim();if(t&&r){let n=x.getCtx(t,!1);n||(n=x.registerCtx({},t)),n.add(r,this.init$[i])}}else this.localCtx.add(i,this.init$[i]);for(let i in this.cssInit$)this.bindCssData(i,this.cssInit$[i]);this.__dataCtxInitialized=!0}connectedCallback(){var s;if(this.isConnected){if(this.__disconnectTimeout&&window.clearTimeout(this.__disconnectTimeout),!this.connectedOnce){let i=(s=this.getAttribute(w.CTX_NAME_ATTR))==null?void 0:s.trim();if(i&&this.style.setProperty(w.CSS_CTX_PROP,`'${i}'`),this.__initDataCtx(),this[w.SET_LATER_KEY]){for(let e in this[w.SET_LATER_KEY])_s(this,e,this[w.SET_LATER_KEY][e]);delete this[w.SET_LATER_KEY]}this.initChildren=[...this.childNodes];for(let e of Qr)this.addTemplateProcessor(e);if(this.pauseRender)this.__initCallback();else if(this.constructor.__rootStylesLink){let e=this.getRootNode();if(!e)return;if(e==null?void 0:e.querySelector(`link[${w.ROOT_STYLE_ATTR_NAME}="${this.constructor.is}"]`)){this.render();return}let r=this.constructor.__rootStylesLink.cloneNode(!0);r.setAttribute(w.ROOT_STYLE_ATTR_NAME,this.constructor.is),r.onload=()=>{this.render()},e.nodeType===Node.DOCUMENT_NODE?e.head.appendChild(r):e.prepend(r)}else this.render()}this.connectedOnce=!0}}destroyCallback(){}disconnectedCallback(){this.connectedOnce&&(this.dropCssDataCache(),this.readyToDestroy&&(this.__disconnectTimeout&&window.clearTimeout(this.__disconnectTimeout),this.__disconnectTimeout=window.setTimeout(()=>{this.destroyCallback();for(let s of this.allSubs)s.remove(),this.allSubs.delete(s);for(let s of this.tplProcessors)this.tplProcessors.delete(s);ne==null||ne.delete(this.updateCssData),ne!=null&&ne.size||(Se==null||Se.disconnect(),Se=null,ne=null)},100)))}static reg(s,i=!1){s||(Ri++,s=`${w.AUTO_TAG_PRFX}-${Ri}`),this.__tag=s;let e=window.customElements.get(s);if(e){!i&&e!==this&&console.warn([`Element with tag name "${s}" already registered.`,`You're trying to override it with another class "${this.name}".`,"This is most likely a mistake.","New element will not be registered."].join(`
`));return}window.customElements.define(s,i?class extends this{}:this)}static get is(){return this.__tag||this.reg(),this.__tag}static bindAttributes(s){this.observedAttributes=Object.keys(s),this.__attrDesc=s}attributeChangedCallback(s,i,e){var t;if(i===e)return;let r=(t=this.constructor.__attrDesc)==null?void 0:t[s];r?this.__dataCtxInitialized?this.$[r]=e:this.init$[r]=e:this[s]=e}getCssData(s,i=!1){if(this.__cssDataCache||(this.__cssDataCache=Object.create(null)),!Object.keys(this.__cssDataCache).includes(s)){this.__computedStyle||(this.__computedStyle=window.getComputedStyle(this));let e=this.__computedStyle.getPropertyValue(s).trim();try{this.__cssDataCache[s]=nn(e)}catch{!i&&console.warn(`CSS Data error: ${s}`),this.__cssDataCache[s]=null}}return this.__cssDataCache[s]}__extractCssName(s){return s.split("--").map((i,e)=>e===0?"":i).join("--")}__initStyleAttrObserver(){ne||(ne=new Set),ne.add(this.updateCssData),Se||(Se=new MutationObserver(s=>{s[0].type==="attributes"&&ne.forEach(i=>{i()})}),Se.observe(document,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["style"]}))}bindCssData(s,i=""){this.__boundCssProps||(this.__boundCssProps=new Set),this.__boundCssProps.add(s);let e=this.getCssData(this.__extractCssName(s),!0);e===null&&(e=i),this.add(s,e),this.__initStyleAttrObserver()}dropCssDataCache(){this.__cssDataCache=null,this.__computedStyle=null}defineAccessor(s,i,e){let t="__"+s;this[t]=this[s],Object.defineProperty(this,s,{set:r=>{this[t]=r,e?window.setTimeout(()=>{i==null||i(r)}):i==null||i(r)},get:()=>this[t]}),this[s]=this[t]}static set shadowStyles(s){let i=new Blob([s],{type:"text/css"});this.__shadowStylesUrl=URL.createObjectURL(i)}static set rootStyles(s){if(!this.__rootStylesLink){let i=new Blob([s],{type:"text/css"}),e=URL.createObjectURL(i),t=document.createElement("link");t.href=e,t.rel="stylesheet",this.__rootStylesLink=t}}},at=he;pi(at,"template");function mi(s,i){for(let e in i)e.includes("-")?s.style.setProperty(e,i[e]):s.style[e]=i[e]}function on(s,i){for(let e in i)i[e].constructor===Boolean?i[e]?s.setAttribute(e,""):s.removeAttribute(e):s.setAttribute(e,i[e])}function vs(s={tag:"div"}){let i=document.createElement(s.tag);if(s.attributes&&on(i,s.attributes),s.styles&&mi(i,s.styles),s.properties)for(let e in s.properties)i[e]=s.properties[e];return s.processors&&s.processors.forEach(e=>{e(i)}),s.children&&s.children.forEach(e=>{let t=vs(e);i.appendChild(t)}),i}var ys="idb-store-ready",an="symbiote-db",ln="symbiote-idb-update_",cn=class{_notifyWhenReady(s=null){window.dispatchEvent(new CustomEvent(ys,{detail:{dbName:this.name,storeName:this.storeName,event:s}}))}get _updEventName(){return ln+this.name}_getUpdateEvent(s){return new CustomEvent(this._updEventName,{detail:{key:this.name,newValue:s}})}_notifySubscribers(s){window.localStorage.removeItem(this.name),window.localStorage.setItem(this.name,s),window.dispatchEvent(this._getUpdateEvent(s))}constructor(s,i){this.name=s,this.storeName=i,this.version=1,this.request=window.indexedDB.open(this.name,this.version),this.request.onupgradeneeded=e=>{this.db=e.target.result,this.objStore=this.db.createObjectStore(i,{keyPath:"_key"}),this.objStore.transaction.oncomplete=t=>{this._notifyWhenReady(t)}},this.request.onsuccess=e=>{this.db=e.target.result,this._notifyWhenReady(e)},this.request.onerror=e=>{console.error(e)},this._subscriptionsMap={},this._updateHandler=e=>{e.key===this.name&&this._subscriptionsMap[e.newValue]&&this._subscriptionsMap[e.newValue].forEach(async r=>{r(await this.read(e.newValue))})},this._localUpdateHandler=e=>{this._updateHandler(e.detail)},window.addEventListener("storage",this._updateHandler),window.addEventListener(this._updEventName,this._localUpdateHandler)}read(s){let e=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).get(s);return new Promise((t,r)=>{e.onsuccess=n=>{var o;(o=n.target.result)!=null&&o._value?t(n.target.result._value):(t(null),console.warn(`IDB: cannot read "${s}"`))},e.onerror=n=>{r(n)}})}write(s,i,e=!1){let t={_key:s,_value:i},n=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).put(t);return new Promise((o,a)=>{n.onsuccess=l=>{e||this._notifySubscribers(s),o(l.target.result)},n.onerror=l=>{a(l)}})}delete(s,i=!1){let t=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).delete(s);return new Promise((r,n)=>{t.onsuccess=o=>{i||this._notifySubscribers(s),r(o)},t.onerror=o=>{n(o)}})}getAll(){let i=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).getAll();return new Promise((e,t)=>{i.onsuccess=r=>{let n=r.target.result;e(n.map(o=>o._value))},i.onerror=r=>{t(r)}})}subscribe(s,i){this._subscriptionsMap[s]||(this._subscriptionsMap[s]=new Set);let e=this._subscriptionsMap[s];return e.add(i),{remove:()=>{e.delete(i),e.size||delete this._subscriptionsMap[s]}}}stop(){window.removeEventListener("storage",this._updateHandler),this._subscriptionsMap=null,ws.clear(this.name)}},ws=class{static get readyEventName(){return ys}static open(s=an,i="store"){let e=s+"/"+i;return this._reg[e]||(this._reg[e]=new cn(s,i)),this._reg[e]}static clear(s){window.indexedDB.deleteDatabase(s);for(let i in this._reg)i.split("/")[0]===s&&delete this._reg[i]}};pi(ws,"_reg",Object.create(null));const Cs=s=>{if(typeof s!="string"||!s)return"";let i=s.trim();return i.startsWith("-/")?i=i.slice(2):i.startsWith("/")&&(i=i.slice(1)),i.endsWith("/")&&(i=i.slice(0,i.length-1)),i},gi=(...s)=>s.filter(i=>typeof i=="string"&&i).map(i=>Cs(i)).join("/-/"),ge=(...s)=>{let i=gi(...s);return i?`-/${i}/`:""};function bi(s){let i=new URL(s),e=i.pathname+i.search+i.hash,t=e.lastIndexOf("http"),r=e.lastIndexOf("/"),n="";return t>=0?n=e.slice(t):r>=0&&(n=e.slice(r+1)),n}function Es(s){let i=new URL(s),{pathname:e}=i;const t=e.indexOf("/"),r=e.indexOf("/",t+1);return e.substring(t+1,r)}function As(s){let i=Ts(s),e=new URL(i),t=e.pathname.indexOf("/-/");return t===-1?"":e.pathname.substring(t).slice(1)}function un(s){return As(s).split("/-/").filter(Boolean).map(e=>Cs(e))}function Ts(s){let i=new URL(s),e=bi(s),t=xs(e)?Ss(e).pathname:e;return i.pathname=i.pathname.replace(t,""),i.search="",i.hash="",i.toString()}function xs(s){return s.startsWith("http")}function Ss(s){let i=new URL(s);return{pathname:i.origin+i.pathname||"",search:i.search||"",hash:i.hash||""}}const X=(s,i,e)=>{let t=new URL(Ts(s));if(e=e||bi(s),t.pathname.startsWith("//")&&(t.pathname=t.pathname.replace("//","/")),xs(e)){let r=Ss(e);t.pathname=t.pathname+(i||"")+(r.pathname||""),t.search=r.search,t.hash=r.hash}else t.pathname=t.pathname+(i||"")+(e||"");return t.toString()},tt=(s,i)=>{let e=new URL(s);return e.pathname=i+"/",e.toString()},le=(s,i=",")=>s.trim().split(i).map(e=>e.trim()).filter(e=>e.length>0),q=Object.freeze({brightness:0,exposure:0,gamma:100,contrast:0,saturation:0,vibrance:0,warmth:0,enhance:0,filter:0,rotate:0,mirror:!1,flip:!1,crop:void 0}),Is=["enhance","brightness","exposure","gamma","contrast","saturation","vibrance","warmth","filter","mirror","flip","rotate","crop"];function dn(s,i){if(typeof i=="number"){const e=i;return q[s]!==e?`${s}/${e}`:""}if(typeof i=="boolean"){const e=i;return q[s]!==e?`${s}`:""}if(s==="filter"&&i){const{name:e,amount:t}=i;return q.filter===t?"":`${s}/${e}/${t}`}if(s==="crop"&&i){let{dimensions:e,coords:t}=i;return`${s}/${e.join("x")}/${t.join(",")}`}return""}function Lt(s){return gi(...Is.filter(i=>typeof s[i]<"u"&&s[i]!==null).map(i=>{let e=s[i];return dn(i,e)}).filter(i=>!!i))}const $s=gi("format/auto","progressive/yes"),oe=([s])=>typeof s<"u"?Number(s):void 0,Di=()=>!0,hn=([s,i])=>({name:s,amount:typeof i<"u"?Number(i):100}),fn=([s,i])=>{if(!/\d+x\d+/.test(s)||!/\d+,\d+/.test(i))throw new Error("Crop by aspect ratio, percentage or alignment shortcuts is not supported.");return{dimensions:le(s,"x").map(Number),coords:le(i).map(Number)}},pn=Object.freeze({enhance:oe,brightness:oe,exposure:oe,gamma:oe,contrast:oe,saturation:oe,vibrance:oe,warmth:oe,filter:hn,mirror:Di,flip:Di,rotate:oe,crop:fn});function mn(s){const i={};for(const e of s){const[t,...r]=e.split("/");if(!Is.includes(t))continue;const n=t,o=pn[n];try{const a=o(r);i[n]=a}catch(a){console.warn([`Failed to parse URL operation "${e}". It will be ignored.`,a instanceof Error?`Error message: "${a.message}"`:a,"If you need this functionality, please feel free to open an issue at https://github.com/uploadcare/blocks/issues/new"].join(`
`))}}return i}const O=Object.freeze({CROP:"crop",TUNING:"tuning",FILTERS:"filters"}),se=[O.CROP,O.TUNING,O.FILTERS],gn=["brightness","exposure","gamma","contrast","saturation","vibrance","warmth","enhance"],bn=["adaris","briaril","calarel","carris","cynarel","cyren","elmet","elonni","enzana","erydark","fenralan","ferand","galen","gavin","gethriel","iorill","iothari","iselva","jadis","lavra","misiara","namala","nerion","nethari","pamaya","sarnar","sedis","sewen","sorahel","sorlen","tarian","thellassan","varriel","varven","vevera","virkas","yedis","yllara","zatvel","zevcen"],_n=["rotate","mirror","flip"],Me=Object.freeze({brightness:{zero:q.brightness,range:[-100,100],keypointsNumber:2},exposure:{zero:q.exposure,range:[-500,500],keypointsNumber:2},gamma:{zero:q.gamma,range:[0,1e3],keypointsNumber:2},contrast:{zero:q.contrast,range:[-100,500],keypointsNumber:2},saturation:{zero:q.saturation,range:[-100,500],keypointsNumber:1},vibrance:{zero:q.vibrance,range:[-100,500],keypointsNumber:1},warmth:{zero:q.warmth,range:[-100,100],keypointsNumber:1},enhance:{zero:q.enhance,range:[0,100],keypointsNumber:1},filter:{zero:q.filter,range:[0,100],keypointsNumber:1}}),be=s=>s?s.split(",").map(i=>i.trim()).filter(Boolean):[],it=s=>s?s.join(","):"",vn="https://ucarecdn.com",yn="https://upload.uploadcare.com",wn="https://social.uploadcare.com",pe={pubkey:"",multiple:!0,multipleMin:0,multipleMax:Number.MAX_SAFE_INTEGER,confirmUpload:!1,imgOnly:!1,accept:"",externalSourcesPreferredTypes:"",externalSourcesEmbedCss:"",store:"auto",cameraMirror:!1,cameraCapture:"",sourceList:"local, url, camera, dropbox, gdrive",cloudImageEditorTabs:it(se),maxLocalFileSizeBytes:0,thumbSize:76,showEmptyList:!1,useLocalImageEditor:!1,useCloudImageEditor:!0,removeCopyright:!1,cropPreset:"",imageShrink:"",modalScrollLock:!0,modalBackdropStrokes:!1,sourceListWrap:!0,remoteTabSessionKey:"",cdnCname:vn,baseUrl:yn,socialBaseUrl:wn,secureSignature:"",secureExpire:"",secureDeliveryProxy:"",retryThrottledRequestMaxTimes:10,multipartMinFileSize:26214400,multipartChunkSize:5242880,maxConcurrentRequests:10,multipartMaxConcurrentRequests:4,multipartMaxAttempts:3,checkForUrlDuplicates:!1,saveUrlForRecurrentUploads:!1,groupOutput:!1,userAgentIntegration:"",debug:!1,metadata:null,localeName:"en",localeDefinitionOverride:null,secureUploadsExpireThreshold:10*60*1e3,secureUploadsSignatureResolver:null,secureDeliveryProxyUrlResolver:null,iconHrefResolver:null,fileValidators:[],collectionValidators:[],cameraModes:"photo, video",defaultCameraMode:null,enableAudioRecording:!0,enableVideoRecording:null,maxVideoRecordingDuration:null,mediaRecorderOptions:null,filesViewMode:"list",gridShowFileNames:!1,cloudImageEditorAutoOpen:!1,cloudImageEditorMaskHref:null},Cn=20,k=Object.freeze({FILE_ADDED:"file-added",FILE_REMOVED:"file-removed",FILE_UPLOAD_START:"file-upload-start",FILE_UPLOAD_PROGRESS:"file-upload-progress",FILE_UPLOAD_SUCCESS:"file-upload-success",FILE_UPLOAD_FAILED:"file-upload-failed",FILE_URL_CHANGED:"file-url-changed",MODAL_OPEN:"modal-open",MODAL_CLOSE:"modal-close",DONE_CLICK:"done-click",UPLOAD_CLICK:"upload-click",ACTIVITY_CHANGE:"activity-change",COMMON_UPLOAD_START:"common-upload-start",COMMON_UPLOAD_PROGRESS:"common-upload-progress",COMMON_UPLOAD_SUCCESS:"common-upload-success",COMMON_UPLOAD_FAILED:"common-upload-failed",CHANGE:"change",GROUP_CREATED:"group-created"});class En{constructor(i){u(this,"_timeoutStore",new Map);u(this,"_targets",new Set);u(this,"_debugPrint",null);this._debugPrint=i}bindTarget(i){this._targets.add(i)}unbindTarget(i){this._targets.delete(i)}_dispatch(i,e){var t;for(const r of this._targets)r.dispatchEvent(new CustomEvent(i,{detail:e}));(t=this._debugPrint)==null||t.call(this,()=>{const r=e&&typeof e=="object"?{...e}:e;return[`event "${i}"`,r]})}emit(i,e,{debounce:t}={}){if(typeof t!="number"&&!t){this._dispatch(i,typeof e=="function"?e():e);return}this._timeoutStore.has(i)&&window.clearTimeout(this._timeoutStore.get(i));const r=typeof t=="number"?t:Cn,n=window.setTimeout(()=>{this._dispatch(i,typeof e=="function"?e():e),this._timeoutStore.delete(i)},r);this._timeoutStore.set(i,n)}}function H(s,i){let e;const t=(...r)=>{clearTimeout(e),e=setTimeout(()=>s(...r),i)};return t.cancel=()=>{clearTimeout(e)},t}const Fi="--uploadcare-blocks-window-height";class Tt{static registerClient(i){this.clientsRegistry.size===0&&this.attachTracker(),this.clientsRegistry.add(i)}static unregisterClient(i){this.clientsRegistry.delete(i),this.clientsRegistry.size===0&&this.detachTracker()}static attachTracker(){window.addEventListener("resize",this.flush,{passive:!0,capture:!0}),this.flush()}static detachTracker(){window.removeEventListener("resize",this.flush,{capture:!0}),document.documentElement.style.removeProperty(Fi)}}u(Tt,"clientsRegistry",new Set),u(Tt,"flush",H(()=>{document.documentElement.style.setProperty(Fi,`${window.innerHeight}px`)},100));const An=s=>{var t;const i=new Intl.Locale(s);let e="ltr";return typeof i.getTextInfo=="function"&&i.getTextInfo().direction?e=i.getTextInfo().direction:"textInfo"in i&&((t=i.textInfo)!=null&&t.direction)&&(e=i.textInfo.direction),e},ks=(s,i)=>new Intl.PluralRules(s).select(i),Tn=s=>s,oi="{{",Os="}}",Vi="plural:";function ai(s,i,e={}){var o;let{openToken:t=oi,closeToken:r=Os,transform:n=Tn}=e;for(let a in i){let l=(o=i[a])==null?void 0:o.toString();s=s.replaceAll(t+a+r,typeof l=="string"?n(l):l)}return s}function xn(s){const i=[];let e=s.indexOf(oi);for(;e!==-1;){const t=s.indexOf(Os,e),r=s.substring(e+2,t);if(r.startsWith(Vi)){const n=s.substring(e+2,t).replace(Vi,""),o=n.substring(0,n.indexOf("(")),a=n.substring(n.indexOf("(")+1,n.indexOf(")"));i.push({variable:r,pluralKey:o,countVariable:a})}e=s.indexOf(oi,t)}return i}const Sn=({element:s,attribute:i,onSuccess:e,onTimeout:t,timeout:r=300})=>{const n=s.getAttribute(i);if(n!==null){e(n);return}const o=new MutationObserver(c=>{const d=c[c.length-1];l(d)});o.observe(s,{attributes:!0,attributeFilter:[i]});const a=setTimeout(()=>{o.disconnect(),t()},r),l=c=>{const d=s.getAttribute(i);c.type==="attributes"&&c.attributeName===i&&d!==null&&(clearTimeout(a),o.disconnect(),e(d))}};function Ni(s){return Object.prototype.toString.call(s)==="[object Object]"}const In=/\W|_/g;function $n(s){return s.split(In).map((i,e)=>i.charAt(0)[e>0?"toUpperCase":"toLowerCase"]()+i.slice(1)).join("")}function zi(s,{ignoreKeys:i}={ignoreKeys:[]}){return Array.isArray(s)?s.map(e=>ue(e,{ignoreKeys:i})):s}function ue(s,{ignoreKeys:i}={ignoreKeys:[]}){if(Array.isArray(s))return zi(s,{ignoreKeys:i});if(!Ni(s))return s;const e={};for(const t of Object.keys(s)){let r=s[t];if(i.includes(t)){e[t]=r;continue}Ni(r)?r=ue(r,{ignoreKeys:i}):Array.isArray(r)&&(r=zi(r,{ignoreKeys:i})),e[$n(t)]=r}return e}const kn=s=>new Promise(i=>setTimeout(i,s));function Ms({libraryName:s,libraryVersion:i,userAgent:e,publicKey:t="",integration:r=""}){const n="JavaScript";if(typeof e=="string")return e;if(typeof e=="function")return e({publicKey:t,libraryName:s,libraryVersion:i,languageName:n,integration:r});const o=[s,i,t].filter(Boolean).join("/"),a=[n,r].filter(Boolean).join("; ");return`${o} (${a})`}const On={factor:2,time:100};function Mn(s,i=On){let e=0;function t(r){const n=Math.round(i.time*i.factor**e);return r({attempt:e,retry:a=>kn(a??n).then(()=>(e+=1,t(r)))})}return t(s)}class Pt extends Error{}class lt extends Pt{constructor(e){super();u(this,"originalProgressEvent");this.name="NetworkError",this.message="Network error",Object.setPrototypeOf(this,lt.prototype),this.originalProgressEvent=e}}const Ut=(s,i)=>{s&&(s.aborted?Promise.resolve().then(i):s.addEventListener("abort",()=>i(),{once:!0}))};class Te extends Pt{constructor(e="Request canceled"){super(e);u(this,"isCancel",!0);this.name="CancelError",Object.setPrototypeOf(this,Te.prototype)}}const Ln=500,Ls=({check:s,interval:i=Ln,timeout:e,signal:t})=>new Promise((r,n)=>{let o,a;Ut(t,()=>{o&&clearTimeout(o),n(new Te("Poll cancelled"))}),e&&(a=setTimeout(()=>{o&&clearTimeout(o),n(new Te("Timed out"))},e));const l=()=>{try{Promise.resolve(s(t)).then(c=>{c?(a&&clearTimeout(a),r(c)):o=setTimeout(l,i)}).catch(c=>{a&&clearTimeout(a),n(c)})}catch(c){a&&clearTimeout(a),n(c)}};o=setTimeout(l,0)}),A={baseCDN:"https://ucarecdn.com",baseURL:"https://upload.uploadcare.com",retryThrottledRequestMaxTimes:1,retryNetworkErrorMaxTimes:3,multipartMinFileSize:25*1024*1024,multipartChunkSize:5*1024*1024,maxConcurrentRequests:4,pusherKey:"79ae88bd931ea68464d9"},Rt="application/octet-stream",Ps="original",_e=({method:s,url:i,data:e,headers:t={},signal:r,onProgress:n})=>new Promise((o,a)=>{const l=new XMLHttpRequest,c=(s==null?void 0:s.toUpperCase())||"GET";let d=!1;l.open(c,i,!0),t&&Object.entries(t).forEach(h=>{const[f,m]=h;typeof m<"u"&&!Array.isArray(m)&&l.setRequestHeader(f,m)}),l.responseType="text",Ut(r,()=>{d=!0,l.abort(),a(new Te)}),l.onload=()=>{if(l.status!=200)a(new Error(`Error ${l.status}: ${l.statusText}`));else{const h={method:c,url:i,data:e,headers:t||void 0,signal:r,onProgress:n},f=l.getAllResponseHeaders().trim().split(/[\r\n]+/),m={};f.forEach(function(v){const C=v.split(": "),_=C.shift(),y=C.join(": ");_&&typeof _<"u"&&(m[_]=y)});const p=l.response,b=l.status;o({request:h,data:p,headers:m,status:b})}},l.onerror=h=>{d||a(new lt(h))},n&&typeof n=="function"&&(l.upload.onprogress=h=>{h.lengthComputable?n({isComputable:!0,value:h.loaded/h.total}):n({isComputable:!1})}),e?l.send(e):l.send()});function Pn(s,...i){return s}const Un=({name:s})=>s?[s]:[],Rn=Pn;var Dn=()=>new FormData;const Us=s=>!1,Dt=s=>typeof Blob<"u"&&s instanceof Blob,Ft=s=>typeof File<"u"&&s instanceof File,Vt=s=>!!s&&typeof s=="object"&&!Array.isArray(s)&&"uri"in s&&typeof s.uri=="string",De=s=>Dt(s)||Ft(s)||Us()||Vt(s),Fn=s=>typeof s=="string"||typeof s=="number"||typeof s>"u",Vn=s=>!!s&&typeof s=="object"&&!Array.isArray(s),Nn=s=>!!s&&typeof s=="object"&&"data"in s&&De(s.data);function Rs(s,i,e){if(Array.isArray(e))for(const t of e)Rs(s,`${i}[]`,t);else if(Nn(e)){const{name:t,contentType:r}=e,n=Rn(e.data,t,r??Rt),o=Un({name:t});s.push([i,n,...o])}else if(Vn(e))for(const[t,r]of Object.entries(e))typeof r<"u"&&s.push([`${i}[${t}]`,String(r)]);else Fn(e)&&e&&s.push([i,e.toString()])}function zn(s){const i=[];for(const[e,t]of Object.entries(s))Rs(i,e,t);return i}function Nt(s){const i=Dn(),e=zn(s);for(const t of e){const[r,n,...o]=t;i.append(r,n,...o)}return i}class N extends Pt{constructor(e,t,r,n,o){super();u(this,"code");u(this,"request");u(this,"response");u(this,"headers");this.name="UploadError",this.message=e,this.code=t,this.request=r,this.response=n,this.headers=o,Object.setPrototypeOf(this,N.prototype)}}const Bn=s=>{const i=new URLSearchParams;for(const[e,t]of Object.entries(s))t&&typeof t=="object"&&!Array.isArray(t)?Object.entries(t).filter(r=>r[1]??!1).forEach(r=>i.set(`${e}[${r[0]}]`,String(r[1]))):Array.isArray(t)?t.forEach(r=>{i.append(`${e}[]`,r)}):typeof t=="string"&&t?i.set(e,t):typeof t=="number"&&i.set(e,t.toString());return i.toString()},ce=(s,i,e)=>{const t=new URL(s);return t.pathname=(t.pathname+i).replace("//","/"),e&&(t.search=Bn(e)),t.toString()};var Hn="6.14.3";const jn="UploadcareUploadClient",Gn=Hn;function xe(s){return Ms({libraryName:jn,libraryVersion:Gn,...s})}const Wn="RequestThrottledError",Bi=15e3,qn=1e3;function Xn(s){const{headers:i}=s||{};if(!i||typeof i["retry-after"]!="string")return Bi;const e=parseInt(i["retry-after"],10);return Number.isFinite(e)?e*1e3:Bi}function ve(s,i){const{retryThrottledRequestMaxTimes:e,retryNetworkErrorMaxTimes:t}=i;return Mn(({attempt:r,retry:n})=>s().catch(o=>{if("response"in o&&(o==null?void 0:o.code)===Wn&&r<e)return n(Xn(o));if(o instanceof lt&&r<t)return n((r+1)*qn);throw o}))}const Ds=s=>{let i="";return(Dt(s)||Ft(s)||Vt(s))&&(i=s.type),i||Rt},Fs=s=>{let i="";return Ft(s)&&s.name?i=s.name:Dt(s)||Us()?i="":Vt(s)&&s.name&&(i=s.name),i||Ps};function _i(s){return typeof s>"u"||s==="auto"?"auto":s?"1":"0"}function Zn(s,{publicKey:i,fileName:e,contentType:t,baseURL:r=A.baseURL,secureSignature:n,secureExpire:o,store:a,signal:l,onProgress:c,source:d="local",integration:h,userAgent:f,retryThrottledRequestMaxTimes:m=A.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:p=A.retryNetworkErrorMaxTimes,metadata:b}){return ve(()=>_e({method:"POST",url:ce(r,"/base/",{jsonerrors:1}),headers:{"X-UC-User-Agent":xe({publicKey:i,integration:h,userAgent:f})},data:Nt({file:{data:s,name:e||Fs(s),contentType:t||Ds(s)},UPLOADCARE_PUB_KEY:i,UPLOADCARE_STORE:_i(a),signature:n,expire:o,source:d,metadata:b}),signal:l,onProgress:c}).then(({data:v,headers:C,request:_})=>{const y=ue(JSON.parse(v));if("error"in y)throw new N(y.error.content,y.error.errorCode,_,y,C);return y}),{retryNetworkErrorMaxTimes:p,retryThrottledRequestMaxTimes:m})}var li;(function(s){s.Token="token",s.FileInfo="file_info"})(li||(li={}));function Kn(s,{publicKey:i,baseURL:e=A.baseURL,store:t,fileName:r,checkForUrlDuplicates:n,saveUrlForRecurrentUploads:o,secureSignature:a,secureExpire:l,source:c="url",signal:d,integration:h,userAgent:f,retryThrottledRequestMaxTimes:m=A.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:p=A.retryNetworkErrorMaxTimes,metadata:b}){return ve(()=>_e({method:"POST",headers:{"X-UC-User-Agent":xe({publicKey:i,integration:h,userAgent:f})},url:ce(e,"/from_url/",{jsonerrors:1,pub_key:i,source_url:s,store:_i(t),filename:r,check_URL_duplicates:n?1:void 0,save_URL_duplicates:o?1:void 0,signature:a,expire:l,source:c,metadata:b}),signal:d}).then(({data:v,headers:C,request:_})=>{const y=ue(JSON.parse(v));if("error"in y)throw new N(y.error.content,y.error.errorCode,_,y,C);return y}),{retryNetworkErrorMaxTimes:p,retryThrottledRequestMaxTimes:m})}var V;(function(s){s.Unknown="unknown",s.Waiting="waiting",s.Progress="progress",s.Error="error",s.Success="success"})(V||(V={}));const Yn=s=>"status"in s&&s.status===V.Error;function Jn(s,{publicKey:i,baseURL:e=A.baseURL,signal:t,integration:r,userAgent:n,retryThrottledRequestMaxTimes:o=A.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:a=A.retryNetworkErrorMaxTimes}={}){return ve(()=>_e({method:"GET",headers:i?{"X-UC-User-Agent":xe({publicKey:i,integration:r,userAgent:n})}:void 0,url:ce(e,"/from_url/status/",{jsonerrors:1,token:s}),signal:t}).then(({data:l,headers:c,request:d})=>{const h=ue(JSON.parse(l));if("error"in h&&!Yn(h))throw new N(h.error.content,h.error.errorCode,d,h,c);return h}),{retryNetworkErrorMaxTimes:a,retryThrottledRequestMaxTimes:o})}function Qn(s,{publicKey:i,baseURL:e=A.baseURL,jsonpCallback:t,secureSignature:r,secureExpire:n,signal:o,source:a,integration:l,userAgent:c,retryThrottledRequestMaxTimes:d=A.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:h=A.retryNetworkErrorMaxTimes}){return ve(()=>_e({method:"POST",headers:{"X-UC-User-Agent":xe({publicKey:i,integration:l,userAgent:c})},url:ce(e,"/group/",{jsonerrors:1}),data:Nt({files:s,callback:t,pub_key:i,signature:r,expire:n,source:a}),signal:o}).then(({data:f,headers:m,request:p})=>{const b=ue(JSON.parse(f));if("error"in b)throw new N(b.error.content,b.error.errorCode,p,b,m);return b}),{retryNetworkErrorMaxTimes:h,retryThrottledRequestMaxTimes:d})}function Vs(s,{publicKey:i,baseURL:e=A.baseURL,signal:t,source:r,integration:n,userAgent:o,retryThrottledRequestMaxTimes:a=A.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:l=A.retryNetworkErrorMaxTimes}){return ve(()=>_e({method:"GET",headers:{"X-UC-User-Agent":xe({publicKey:i,integration:n,userAgent:o})},url:ce(e,"/info/",{jsonerrors:1,pub_key:i,file_id:s,source:r}),signal:t}).then(({data:c,headers:d,request:h})=>{const f=ue(JSON.parse(c));if("error"in f)throw new N(f.error.content,f.error.errorCode,h,f,d);return f}),{retryThrottledRequestMaxTimes:a,retryNetworkErrorMaxTimes:l})}function eo(s,{publicKey:i,contentType:e,fileName:t,multipartChunkSize:r=A.multipartChunkSize,baseURL:n="",secureSignature:o,secureExpire:a,store:l,signal:c,source:d="local",integration:h,userAgent:f,retryThrottledRequestMaxTimes:m=A.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:p=A.retryNetworkErrorMaxTimes,metadata:b}){return ve(()=>_e({method:"POST",url:ce(n,"/multipart/start/",{jsonerrors:1}),headers:{"X-UC-User-Agent":xe({publicKey:i,integration:h,userAgent:f})},data:Nt({filename:t||Ps,size:s,content_type:e||Rt,part_size:r,UPLOADCARE_STORE:_i(l),UPLOADCARE_PUB_KEY:i,signature:o,expire:a,source:d,metadata:b}),signal:c}).then(({data:v,headers:C,request:_})=>{const y=ue(JSON.parse(v));if("error"in y)throw new N(y.error.content,y.error.errorCode,_,y,C);return y.parts=Object.keys(y.parts).map(M=>y.parts[Number(M)]),y}),{retryThrottledRequestMaxTimes:m,retryNetworkErrorMaxTimes:p})}function to(s,i,{contentType:e,signal:t,onProgress:r,retryThrottledRequestMaxTimes:n=A.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:o=A.retryNetworkErrorMaxTimes}){return ve(()=>_e({method:"PUT",url:i,data:s,onProgress:r,signal:t,headers:{"Content-Type":e||Rt}}).then(a=>(r&&r({isComputable:!0,value:1}),a)).then(({status:a})=>({code:a})),{retryThrottledRequestMaxTimes:n,retryNetworkErrorMaxTimes:o})}function io(s,{publicKey:i,baseURL:e=A.baseURL,source:t="local",signal:r,integration:n,userAgent:o,retryThrottledRequestMaxTimes:a=A.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:l=A.retryNetworkErrorMaxTimes}){return ve(()=>_e({method:"POST",url:ce(e,"/multipart/complete/",{jsonerrors:1}),headers:{"X-UC-User-Agent":xe({publicKey:i,integration:n,userAgent:o})},data:Nt({uuid:s,UPLOADCARE_PUB_KEY:i,source:t}),signal:r}).then(({data:c,headers:d,request:h})=>{const f=ue(JSON.parse(c));if("error"in f)throw new N(f.error.content,f.error.errorCode,h,f,d);return f}),{retryThrottledRequestMaxTimes:a,retryNetworkErrorMaxTimes:l})}function vi(s,{publicKey:i,baseURL:e,source:t,integration:r,userAgent:n,retryThrottledRequestMaxTimes:o,retryNetworkErrorMaxTimes:a,signal:l,onProgress:c}){return Ls({check:d=>Vs(s,{publicKey:i,baseURL:e,signal:d,source:t,integration:r,userAgent:n,retryThrottledRequestMaxTimes:o,retryNetworkErrorMaxTimes:a}).then(h=>h.isReady?h:(c&&c({isComputable:!0,value:1}),!1)),signal:l})}function so(s){return"defaultEffects"in s}class Fe{constructor(i,{baseCDN:e=A.baseCDN,fileName:t}={}){u(this,"uuid");u(this,"name");u(this,"size");u(this,"isStored");u(this,"isImage");u(this,"mimeType");u(this,"cdnUrl");u(this,"s3Url");u(this,"originalFilename");u(this,"imageInfo");u(this,"videoInfo");u(this,"contentInfo");u(this,"metadata");u(this,"s3Bucket");u(this,"defaultEffects",null);const{uuid:r,s3Bucket:n}=i,o=ce(e,`${r}/`),a=n?ce(`https://${n}.s3.amazonaws.com/`,`${r}/${i.filename}`):null;this.uuid=r,this.name=t||i.filename,this.size=i.size,this.isStored=i.isStored,this.isImage=i.isImage,this.mimeType=i.mimeType,this.cdnUrl=o,this.originalFilename=i.originalFilename,this.imageInfo=i.imageInfo,this.videoInfo=i.videoInfo,this.contentInfo=i.contentInfo,this.metadata=i.metadata||null,this.s3Bucket=n||null,this.s3Url=a,so(i)&&(this.defaultEffects=i.defaultEffects)}}const ro=(s,{publicKey:i,fileName:e,baseURL:t,secureSignature:r,secureExpire:n,store:o,contentType:a,signal:l,onProgress:c,source:d,integration:h,userAgent:f,retryThrottledRequestMaxTimes:m,retryNetworkErrorMaxTimes:p,baseCDN:b,metadata:v})=>Zn(s,{publicKey:i,fileName:e,contentType:a,baseURL:t,secureSignature:r,secureExpire:n,store:o,signal:l,onProgress:c,source:d,integration:h,userAgent:f,retryThrottledRequestMaxTimes:m,retryNetworkErrorMaxTimes:p,metadata:v}).then(({file:C})=>vi(C,{publicKey:i,baseURL:t,source:d,integration:h,userAgent:f,retryThrottledRequestMaxTimes:m,retryNetworkErrorMaxTimes:p,onProgress:c,signal:l})).then(C=>new Fe(C,{baseCDN:b})),no=(s,{publicKey:i,fileName:e,baseURL:t,signal:r,onProgress:n,source:o,integration:a,userAgent:l,retryThrottledRequestMaxTimes:c,retryNetworkErrorMaxTimes:d,baseCDN:h})=>Vs(s,{publicKey:i,baseURL:t,signal:r,source:o,integration:a,userAgent:l,retryThrottledRequestMaxTimes:c,retryNetworkErrorMaxTimes:d}).then(f=>new Fe(f,{baseCDN:h,fileName:e})).then(f=>(n&&n({isComputable:!0,value:1}),f)),oo=(s,{signal:i}={})=>{let e=null,t=null;const r=s.map(()=>new AbortController),n=o=>()=>{t=o,r.forEach((a,l)=>l!==o&&a.abort())};return Ut(i,()=>{r.forEach(o=>o.abort())}),Promise.all(s.map((o,a)=>{const l=n(a);return Promise.resolve().then(()=>o({stopRace:l,signal:r[a].signal})).then(c=>(l(),c)).catch(c=>(e=c,null))})).then(o=>{if(t===null)throw e;return o[t]})};var ao=window.WebSocket;class lo{constructor(){u(this,"events",Object.create({}))}emit(i,e){var t;(t=this.events[i])==null||t.forEach(r=>r(e))}on(i,e){this.events[i]=this.events[i]||[],this.events[i].push(e)}off(i,e){e?this.events[i]=this.events[i].filter(t=>t!==e):this.events[i]=[]}}const co=(s,i)=>s==="success"?{status:V.Success,...i}:s==="progress"?{status:V.Progress,...i}:{status:V.Error,...i};class uo{constructor(i,e=3e4){u(this,"key");u(this,"disconnectTime");u(this,"ws");u(this,"queue",[]);u(this,"isConnected",!1);u(this,"subscribers",0);u(this,"emmitter",new lo);u(this,"disconnectTimeoutId",null);this.key=i,this.disconnectTime=e}connect(){if(this.disconnectTimeoutId&&clearTimeout(this.disconnectTimeoutId),!this.isConnected&&!this.ws){const i=`wss://ws.pusherapp.com/app/${this.key}?protocol=5&client=js&version=1.12.2`;this.ws=new ao(i),this.ws.addEventListener("error",e=>{this.emmitter.emit("error",new Error(e.message))}),this.emmitter.on("connected",()=>{this.isConnected=!0,this.queue.forEach(e=>this.send(e.event,e.data)),this.queue=[]}),this.ws.addEventListener("message",e=>{const t=JSON.parse(e.data.toString());switch(t.event){case"pusher:connection_established":{this.emmitter.emit("connected",void 0);break}case"pusher:ping":{this.send("pusher:pong",{});break}case"progress":case"success":case"fail":this.emmitter.emit(t.channel,co(t.event,JSON.parse(t.data)))}})}}disconnect(){const i=()=>{var e;(e=this.ws)==null||e.close(),this.ws=void 0,this.isConnected=!1};this.disconnectTime?this.disconnectTimeoutId=setTimeout(()=>{i()},this.disconnectTime):i()}send(i,e){var r;const t=JSON.stringify({event:i,data:e});(r=this.ws)==null||r.send(t)}subscribe(i,e){this.subscribers+=1,this.connect();const t=`task-status-${i}`,r={event:"pusher:subscribe",data:{channel:t}};this.emmitter.on(t,e),this.isConnected?this.send(r.event,r.data):this.queue.push(r)}unsubscribe(i){this.subscribers-=1;const e=`task-status-${i}`,t={event:"pusher:unsubscribe",data:{channel:e}};this.emmitter.off(e),this.isConnected?this.send(t.event,t.data):this.queue=this.queue.filter(r=>r.data.channel!==e),this.subscribers===0&&this.disconnect()}onError(i){return this.emmitter.on("error",i),()=>this.emmitter.off("error",i)}}let Zt=null;const yi=s=>{if(!Zt){const i=typeof window>"u"?0:3e4;Zt=new uo(s,i)}return Zt},ho=s=>{yi(s).connect()};function fo({token:s,publicKey:i,baseURL:e,integration:t,userAgent:r,retryThrottledRequestMaxTimes:n,retryNetworkErrorMaxTimes:o,onProgress:a,signal:l}){return Ls({check:c=>Jn(s,{publicKey:i,baseURL:e,integration:t,userAgent:r,retryThrottledRequestMaxTimes:n,retryNetworkErrorMaxTimes:o,signal:c}).then(d=>{switch(d.status){case V.Error:return new N(d.error,d.errorCode);case V.Waiting:return!1;case V.Unknown:return new N(`Token "${s}" was not found.`);case V.Progress:return a&&(d.total==="unknown"?a({isComputable:!1}):a({isComputable:!0,value:d.done/d.total})),!1;case V.Success:return a&&a({isComputable:!0,value:d.done/d.total}),d;default:throw new Error("Unknown status")}}),signal:l})}const po=({token:s,pusherKey:i,signal:e,onProgress:t})=>new Promise((r,n)=>{const o=yi(i),a=o.onError(n),l=()=>{a(),o.unsubscribe(s)};Ut(e,()=>{l(),n(new Te("pusher cancelled"))}),o.subscribe(s,c=>{switch(c.status){case V.Progress:{t&&(c.total==="unknown"?t({isComputable:!1}):t({isComputable:!0,value:c.done/c.total}));break}case V.Success:{l(),t&&t({isComputable:!0,value:c.done/c.total}),r(c);break}case V.Error:l(),n(new N(c.msg,c.error_code))}})}),mo=(s,{publicKey:i,fileName:e,baseURL:t,baseCDN:r,checkForUrlDuplicates:n,saveUrlForRecurrentUploads:o,secureSignature:a,secureExpire:l,store:c,signal:d,onProgress:h,source:f,integration:m,userAgent:p,retryThrottledRequestMaxTimes:b,pusherKey:v=A.pusherKey,metadata:C})=>Promise.resolve(ho(v)).then(()=>Kn(s,{publicKey:i,fileName:e,baseURL:t,checkForUrlDuplicates:n,saveUrlForRecurrentUploads:o,secureSignature:a,secureExpire:l,store:c,signal:d,source:f,integration:m,userAgent:p,retryThrottledRequestMaxTimes:b,metadata:C})).catch(_=>{const y=yi(v);return y==null||y.disconnect(),Promise.reject(_)}).then(_=>_.type===li.FileInfo?_:oo([({signal:y})=>fo({token:_.token,publicKey:i,baseURL:t,integration:m,userAgent:p,retryThrottledRequestMaxTimes:b,onProgress:h,signal:y}),({signal:y})=>po({token:_.token,pusherKey:v,signal:y,onProgress:h})],{signal:d})).then(_=>{if(_ instanceof N)throw _;return _}).then(_=>vi(_.uuid,{publicKey:i,baseURL:t,integration:m,userAgent:p,retryThrottledRequestMaxTimes:b,onProgress:h,signal:d})).then(_=>new Fe(_,{baseCDN:r})),Kt=new WeakMap,go=async s=>{if(Kt.has(s))return Kt.get(s);const i=await fetch(s.uri).then(e=>e.blob());return Kt.set(s,i),i},Ns=async s=>{if(Ft(s)||Dt(s))return s.size;if(Vt(s))return(await go(s)).size;throw new Error("Unknown file type. Cannot determine file size.")},bo=(s,i=A.multipartMinFileSize)=>s>=i,zs=s=>{const i="[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}",e=new RegExp(i);return!De(s)&&e.test(s)},wi=s=>{const i="^(?:\\w+:)?\\/\\/([^\\s\\.]+\\.\\S{2}|localhost[\\:?\\d]*)\\S*$",e=new RegExp(i);return!De(s)&&e.test(s)},_o=(s,i)=>new Promise((e,t)=>{const r=[];let n=!1,o=i.length;const a=[...i],l=()=>{const c=i.length-a.length,d=a.shift();d&&d().then(h=>{n||(r[c]=h,o-=1,o?l():e(r))}).catch(h=>{n=!0,t(h)})};for(let c=0;c<s;c++)l()}),vo=(s,i,e,t)=>{const r=t*i,n=Math.min(r+t,e);return s.slice(r,n)},yo=async(s,i,e)=>t=>vo(s,t,i,e),wo=(s,i,{publicKey:e,contentType:t,onProgress:r,signal:n,integration:o,retryThrottledRequestMaxTimes:a,retryNetworkErrorMaxTimes:l})=>to(s,i,{contentType:t,onProgress:r,signal:n,retryThrottledRequestMaxTimes:a,retryNetworkErrorMaxTimes:l}),Co=async(s,{publicKey:i,fileName:e,fileSize:t,baseURL:r,secureSignature:n,secureExpire:o,store:a,signal:l,onProgress:c,source:d,integration:h,userAgent:f,retryThrottledRequestMaxTimes:m,retryNetworkErrorMaxTimes:p,contentType:b,multipartChunkSize:v=A.multipartChunkSize,maxConcurrentRequests:C=A.maxConcurrentRequests,baseCDN:_,metadata:y})=>{const M=t??await Ns(s);let j;const J=(L,D)=>{if(!c)return;j||(j=Array(L).fill(0));const Z=Q=>Q.reduce((re,Xt)=>re+Xt,0);return Q=>{Q.isComputable&&(j[D]=Q.value,c({isComputable:!0,value:Z(j)/L}))}};return b||(b=Ds(s)),eo(M,{publicKey:i,contentType:b,fileName:e||Fs(s),baseURL:r,secureSignature:n,secureExpire:o,store:a,signal:l,source:d,integration:h,userAgent:f,retryThrottledRequestMaxTimes:m,retryNetworkErrorMaxTimes:p,metadata:y,multipartChunkSize:v}).then(async({uuid:L,parts:D})=>{const Z=await yo(s,M,v);return Promise.all([L,_o(C,D.map((Q,re)=>()=>wo(Z(re),Q,{publicKey:i,contentType:b,onProgress:J(D.length,re),signal:l,integration:h,retryThrottledRequestMaxTimes:m,retryNetworkErrorMaxTimes:p})))])}).then(([L])=>io(L,{publicKey:i,baseURL:r,source:d,integration:h,userAgent:f,retryThrottledRequestMaxTimes:m,retryNetworkErrorMaxTimes:p})).then(L=>L.isReady?L:vi(L.uuid,{publicKey:i,baseURL:r,source:d,integration:h,userAgent:f,retryThrottledRequestMaxTimes:m,retryNetworkErrorMaxTimes:p,onProgress:c,signal:l})).then(L=>new Fe(L,{baseCDN:_}))};async function Bs(s,{publicKey:i,fileName:e,baseURL:t=A.baseURL,secureSignature:r,secureExpire:n,store:o,signal:a,onProgress:l,source:c,integration:d,userAgent:h,retryThrottledRequestMaxTimes:f,retryNetworkErrorMaxTimes:m,contentType:p,multipartMinFileSize:b,multipartChunkSize:v,maxConcurrentRequests:C,baseCDN:_=A.baseCDN,checkForUrlDuplicates:y,saveUrlForRecurrentUploads:M,pusherKey:j,metadata:J}){if(De(s)){const L=await Ns(s);return bo(L,b)?Co(s,{publicKey:i,contentType:p,multipartChunkSize:v,fileSize:L,fileName:e,baseURL:t,secureSignature:r,secureExpire:n,store:o,signal:a,onProgress:l,source:c,integration:d,userAgent:h,maxConcurrentRequests:C,retryThrottledRequestMaxTimes:f,retryNetworkErrorMaxTimes:m,baseCDN:_,metadata:J}):ro(s,{publicKey:i,fileName:e,contentType:p,baseURL:t,secureSignature:r,secureExpire:n,store:o,signal:a,onProgress:l,source:c,integration:d,userAgent:h,retryThrottledRequestMaxTimes:f,retryNetworkErrorMaxTimes:m,baseCDN:_,metadata:J})}if(wi(s))return mo(s,{publicKey:i,fileName:e,baseURL:t,baseCDN:_,checkForUrlDuplicates:y,saveUrlForRecurrentUploads:M,secureSignature:r,secureExpire:n,store:o,signal:a,onProgress:l,source:c,integration:d,userAgent:h,retryThrottledRequestMaxTimes:f,pusherKey:j,metadata:J});if(zs(s))return no(s,{publicKey:i,fileName:e,baseURL:t,signal:a,onProgress:l,source:c,integration:d,userAgent:h,retryThrottledRequestMaxTimes:f,retryNetworkErrorMaxTimes:m,baseCDN:_});throw new TypeError(`File uploading from "${s}" is not supported`)}class Eo{constructor(i,{baseCDN:e=A.baseCDN}={}){u(this,"uuid");u(this,"filesCount");u(this,"totalSize");u(this,"isStored");u(this,"isImage");u(this,"cdnUrl");u(this,"files");u(this,"createdAt");u(this,"storedAt",null);this.uuid=i.id,this.filesCount=i.filesCount;const t=i.files.filter(Boolean);this.totalSize=Object.values(t).reduce((r,n)=>r+n.size,0),this.isStored=!!i.datetimeStored,this.isImage=!!Object.values(t).filter(r=>r.isImage).length,this.cdnUrl=i.cdnUrl,this.files=t.map(r=>new Fe(r,{baseCDN:e})),this.createdAt=i.datetimeCreated,this.storedAt=i.datetimeStored}}const Ao=s=>{for(const i of s)if(!De(i))return!1;return!0},To=s=>{for(const i of s)if(!zs(i))return!1;return!0},xo=s=>{for(const i of s)if(!wi(i))return!1;return!0};function So(s,{publicKey:i,fileName:e,baseURL:t=A.baseURL,secureSignature:r,secureExpire:n,store:o,signal:a,onProgress:l,source:c,integration:d,userAgent:h,retryThrottledRequestMaxTimes:f,retryNetworkErrorMaxTimes:m,contentType:p,multipartChunkSize:b=A.multipartChunkSize,baseCDN:v=A.baseCDN,checkForUrlDuplicates:C,saveUrlForRecurrentUploads:_,jsonpCallback:y}){if(!Ao(s)&&!xo(s)&&!To(s))throw new TypeError(`Group uploading from "${s}" is not supported`);let M,j=!0;const J=s.length,L=(D,Z)=>{if(!l)return;M||(M=Array(D).fill(0));const Q=re=>re.reduce((Xt,Ur)=>Xt+Ur)/D;return re=>{if(!re.isComputable||!j){j=!1,l({isComputable:!1});return}M[Z]=re.value,l({isComputable:!0,value:Q(M)})}};return Promise.all(s.map((D,Z)=>De(D)||wi(D)?Bs(D,{publicKey:i,fileName:e,baseURL:t,secureSignature:r,secureExpire:n,store:o,signal:a,onProgress:L(J,Z),source:c,integration:d,userAgent:h,retryThrottledRequestMaxTimes:f,retryNetworkErrorMaxTimes:m,contentType:p,multipartChunkSize:b,baseCDN:v,checkForUrlDuplicates:C,saveUrlForRecurrentUploads:_}).then(Q=>Q.uuid):D)).then(D=>Qn(D,{publicKey:i,baseURL:t,jsonpCallback:y,secureSignature:r,secureExpire:n,signal:a,source:c,integration:d,userAgent:h,retryThrottledRequestMaxTimes:f,retryNetworkErrorMaxTimes:m}).then(Z=>new Eo(Z,{baseCDN:v})).then(Z=>(l&&l({isComputable:!0,value:1}),Z)))}class Io{constructor(i){u(this,"_concurrency",1);u(this,"_pending",[]);u(this,"_running",0);u(this,"_resolvers",new Map);u(this,"_rejectors",new Map);this._concurrency=i}_run(){const i=this._concurrency-this._running;for(let e=0;e<i;e++){const t=this._pending.shift();if(!t)return;const r=this._resolvers.get(t),n=this._rejectors.get(t);if(!r||!n)throw new Error("Unexpected behavior: resolver or rejector is undefined");this._running+=1,t().finally(()=>{this._resolvers.delete(t),this._rejectors.delete(t),this._running-=1,this._run()}).then(o=>r(o)).catch(o=>n(o))}}add(i){return new Promise((e,t)=>{this._resolvers.set(i,e),this._rejectors.set(i,t),this._pending.push(i),this._run()})}get pending(){return this._pending.length}get running(){return this._running}set concurrency(i){this._concurrency=i,this._run()}get concurrency(){return this._concurrency}}const Hs=()=>({}),js=s=>({...Hs(),"*currentActivity":null,"*currentActivityParams":{},"*history":[],"*historyBack":null,"*closeModal":()=>{s.modalManager.close(s.$["*currentActivity"]),s.set$({"*currentActivity":null})}}),Gs=s=>({...js(s),"*commonProgress":0,"*uploadList":[],"*uploadQueue":new Io(1),"*collectionErrors":[],"*collectionState":null,"*groupInfo":null,"*uploadTrigger":new Set,"*secureUploadsManager":null}),Ci={"locale-id":"en","social-source-lang":"en","upload-file":"Upload file","upload-files":"Upload files","choose-file":"Choose file","choose-files":"Choose files","drop-files-here":"Drop files here","select-file-source":"Select file source",selected:"Selected",upload:"Upload","add-more":"Add more",cancel:"Cancel","start-from-cancel":"Cancel",clear:"Clear","camera-shot":"Shot","upload-url":"Import","upload-url-placeholder":"Paste link here","edit-image":"Edit image","edit-detail":"Details",back:"Back",done:"Done",ok:"Ok","remove-from-list":"Remove",no:"No",yes:"Yes","confirm-your-action":"Confirm your action","are-you-sure":"Are you sure?","selected-count":"{{count}} of {{total}} selected","select-all":"Select all","deselect-all":"Deselect all","upload-error":"Upload error","validation-error":"Validation error","no-files":"No files selected",browse:"Browse","not-uploaded-yet":"Not uploaded yet...",file__one:"file",file__other:"files",error__one:"error",error__other:"errors","header-uploading":"Uploading {{count}} {{plural:file(count)}}","header-failed":"{{count}} {{plural:error(count)}}","header-succeed":"{{count}} {{plural:file(count)}} uploaded","header-total":"{{count}} {{plural:file(count)}} selected","src-type-local":"From device","src-type-from-url":"From link","src-type-camera":"Camera","src-type-mobile-video-camera":"Video","src-type-mobile-photo-camera":"Photo","src-type-draw":"Draw","src-type-facebook":"Facebook","src-type-dropbox":"Dropbox","src-type-gdrive":"Google Drive","src-type-gphotos":"Google Photos","src-type-flickr":"Flickr","src-type-vk":"VK","src-type-evernote":"Evernote","src-type-box":"Box","src-type-onedrive":"Onedrive","src-type-huddle":"Huddle","src-type-other":"Other","caption-from-url":"Import from link","caption-camera":"Camera","caption-draw":"Draw","caption-edit-file":"Edit file","file-no-name":"No name...","toggle-fullscreen":"Toggle fullscreen","toggle-guides":"Toggle guides",rotate:"Rotate","flip-vertical":"Flip vertical","flip-horizontal":"Flip horizontal",apply:"Apply",brightness:"Brightness",contrast:"Contrast",saturation:"Saturation",exposure:"Exposure",gamma:"Gamma",vibrance:"Vibrance",warmth:"Warmth",enhance:"Enhance",original:"Original",resize:"Resize image",crop:"Crop","select-color":"Select color",text:"Text",draw:"Draw","cancel-edit":"Cancel edit","tab-view":"Preview","tab-details":"Details","file-name":"Name","file-size":"Size","cdn-url":"CDN URL","file-size-unknown":"Unknown","camera-permissions-denied":"Camera access denied","camera-permissions-prompt":"Please allow access to the camera","camera-permissions-request":"Request access","files-count-limit-error-title":"Files count limit overflow","files-count-limit-error-too-few":"Youve chosen {{total}} {{plural:file(total)}}. At least {{min}} {{plural:file(min)}} required.","files-count-limit-error-too-many":"Youve chosen too many files. {{max}} {{plural:file(max)}} is maximum.","files-max-size-limit-error":"File is too big. Max file size is {{maxFileSize}}.","has-validation-errors":"File validation error occurred. Please, check your files before upload.","images-only-accepted":"Only image files are accepted.","file-type-not-allowed":"Uploading of these file types is not allowed.","some-files-were-not-uploaded":"Some files were not uploaded.","file-item-edit-button":"Edit","file-item-remove-button":"Remove","a11y-editor-tab-filters":"Filters","a11y-editor-tab-tuning":"Tuning","a11y-editor-tab-crop":"Crop","a11y-activity-header-button-close":"Close",flip:"Flip",mirror:"Mirror","a11y-cloud-editor-apply-filter":"Apply {{name}} filter","a11y-cloud-editor-apply-crop":"Apply {{name}} operation","a11y-cloud-editor-apply-tuning":"Apply {{name}} tuning",finished:"Finished",failed:"Failed",uploading:"Uploading",idle:"Idle","a11y-file-item-status":"File {{fileName}} in status {{status}}","waiting-for":"Waiting for {{source}}",queued:"Queued"},xt=new Map,ci=new Map,Ws=(s,i)=>{xt.has(s)&&console.log(`Locale ${s} is already defined. Overwriting...`),xt.set(s,{...Ci,...i})},$o=(s,i)=>{ci.set(s,i)},qs=(s,i)=>{typeof i=="function"?$o(s,i):Ws(s,i)},ko=async s=>{if(!xt.has(s)){if(!ci.has(s))throw new Error(`Locale ${s} is not defined`);const e=await ci.get(s)();Ws(s,e)}return xt.get(s)};qs("en",Ci);const Ee=s=>`*l10n/${s}`,Oo="en";class Mo{constructor(i){u(this,"_blockInstance",null);u(this,"_localeName","");u(this,"_callbacks",new Set);u(this,"_boundBlocks",new Map);this._blockInstance=i;for(let[e,t]of Object.entries(Ci))this._blockInstance.add(Ee(e),t,!1);setTimeout(()=>{i.subConfigValue("localeName",async e=>{var n;if(!this._blockInstance||!e)return;this._localeName=e;const t=await ko(e);if(e!==Oo&&this._localeName!==e)return;const r=(n=this._blockInstance.cfg.localeDefinitionOverride)==null?void 0:n[e];for(const[o,a]of Object.entries(t)){const l=r==null?void 0:r[o];this._blockInstance.add(Ee(o),l??a,!0);for(const c of this._callbacks)c()}}),i.subConfigValue("localeDefinitionOverride",e=>{var r;if(!e)return;const t=e[this._localeName];if(t)for(const[n,o]of Object.entries(t)){(r=this._blockInstance)==null||r.add(Ee(n),o,!0);for(const a of this._callbacks)a()}})})}onLocaleChange(i){const e=H(i,0);return this._callbacks.add(e),()=>{this._callbacks.delete(e)}}bindL10n(i,e,t){var n,o,a;i.$[e]=t(),this._boundBlocks.has(i)||this._boundBlocks.set(i,new Map),(o=(n=this._boundBlocks.get(i))==null?void 0:n.get(e))==null||o();const r=this.onLocaleChange(()=>{i.$[e]=t()});(a=this._boundBlocks.get(i))==null||a.set(e,r)}destroyL10nBindings(i){const e=this._boundBlocks.get(i);if(e){for(const t of e.values())t();this._boundBlocks.delete(i)}}destroy(){this._callbacks.clear()}}function Lo(s,i){[...s.querySelectorAll("[l10n]")].forEach(e=>{let t=e.getAttribute("l10n");if(!t)return;const r=t.split(";");for(const n of r)n&&Po(e,n,i)})}const Po=(s,i,e)=>{let t="textContent",r=!1;if(i.includes(":")){const a=i.split(":");t=a[0],i=a[1],t.startsWith("@")&&(t=t.slice(1),r=!0)}const n=i;e.has(n)&&e.sub(n,a=>{if(!a)return;e.l10nProcessorSubs.has(n)||e.l10nProcessorSubs.set(n,new Set);const l=e.l10nProcessorSubs.get(n);l==null||l.forEach(h=>{h.remove(),l.delete(h),e.allSubs.delete(h)});const c=Ee(a).replace("*","");e.nodeCtx.has(c)||e.nodeCtx.add(c,a);const d=e.nodeCtx.sub(c,()=>{s[t]=e.l10n(a)});l==null||l.add(d),e.allSubs.add(d),s.removeAttribute("l10n")});const o=Ee(i);e.has(o)||e.add(o,""),e.sub(o,()=>{i=i,r?s.setAttribute(t,e.l10n(i)):s[t]=e.l10n(i)}),s.removeAttribute("l10n")},B=s=>`*cfg/${s}`,Uo={button:["toolbar"],checkbox:["toolbar"],menuitem:["menu","menubar"],option:["listbox"],tab:["tablist"]};function ze(s,i){i.tabIndex=0,i.focus(),s.tabIndex=-1}function Yt(s){let i=s.role||s.type||s.tagName;if(!i)return null;let e=Uo[i.toLowerCase()];if(!e)return null;for(let t of e){let r=s.closest(`[role=${t}]`);if(r)return r}}function Jt(s,i){return i.role==="toolbar"?Ro(i):i.querySelectorAll(`[role=${s.role}]`)}function Ro(s){return[...s.querySelectorAll("*")].filter(e=>e.role==="button"||e.type==="button"||e.role==="checkbox"||e.type==="checkbox")}function Do(s){let i=s.getAttribute("aria-orientation");if(i==="vertical")return!1;if(i==="horizontal")return!0;let e=s.role;return e==="menubar"||e==="tablist"||e==="toolbar"}function Fo(s){return i=>{let e=!1,t=300,r=0,n="";function o(h){let f=Yt(h.target);if(!f){a();return}let m=Jt(h.target,f),p=Array.from(m).indexOf(h.target),b="ArrowDown",v="ArrowUp";if(Do(f)&&(i.document.dir==="rtl"?(b="ArrowLeft",v="ArrowRight"):(b="ArrowRight",v="ArrowLeft")),h.key===b)h.preventDefault(),ze(h.target,m[p+1]||m[0]);else if(h.key===v)h.preventDefault(),ze(h.target,m[p-1]||m[m.length-1]);else if(h.key==="Home")h.preventDefault(),ze(h.target,m[0]);else if(h.key==="End")h.preventDefault(),ze(h.target,m[m.length-1]);else if(h.key.length===1&&f.role!=="tablist"){let C=Date.now();C-r<=t?n+=h.key.toLowerCase():n=h.key.toLowerCase(),r=C;let _=Array.from(m).find(y=>{var M,j,J;return(J=(j=(M=y.textContent)==null?void 0:M.trim())==null?void 0:j.toLowerCase())==null?void 0:J.startsWith(n)});_&&(h.preventDefault(),ze(h.target,_))}}function a(){e=!1,i.removeEventListener("keydown",o)}function l(h){let f=Yt(h.target);if(f){e||(e=!0,i.addEventListener("keydown",o));let m=Jt(h.target,f);for(let p of m)p!==h.target&&p.setAttribute("tabindex",-1)}else e&&a()}function c(h){(!h.relatedTarget||h.relatedTarget===i.document)&&a()}function d(h){let f=Yt(h.target);if(f){let m=Jt(h.target,f);for(let p of m)p!==h.target&&p.setAttribute("tabindex",-1);h.target.setAttribute("tabindex",0)}}return i.addEventListener("click",d),i.addEventListener("focusin",l),i.addEventListener("focusout",c),()=>{a(),i.removeEventListener("click",d),i.removeEventListener("focusin",l),i.removeEventListener("focusout",c)}}}function Vo(){return s=>{let i,e;function t(n){if(n.target.getAttribute("aria-hidden")==="true"){i=n.target,i.setAttribute("aria-hidden","false"),e=i.hidden,e&&(i.hidden=!1);let o=n.target.querySelector('a, button, select, textarea, input:not([type=radio]), [type=radio]:checked, [tabindex]:not([tabindex="-1"])');o&&(o.tabIndex=0)}}function r(n){i&&i.contains(n.target)&&(!n.relatedTarget||!i.contains(n.relatedTarget))&&(n.target.tabIndex=-1,i.setAttribute("aria-hidden","true"),e&&(i.hidden=!0),i=null)}return s.addEventListener("keyuxJump",t),s.addEventListener("focusout",r),()=>{s.removeEventListener("keyuxJump",t),s.removeEventListener("focusout",r)}}}function No(){return s=>{let i=[];function e(l){let c=s.document.activeElement;c&&c!==s.document.body&&i.push(new WeakRef(c)),l.focus({focusVisible:!0})}function t(){let l=i.pop();if(!l){s.document.activeElement.blur();return}let c=l.deref();c&&c.isConnected?c.focus():t()}let r=0,n;function o(l){clearInterval(n);let c=l.getAttribute("aria-controls");n=setInterval(()=>{if(r++>50){clearInterval(n);return}let d=s.document.getElementById(c);if(d){let h=d.querySelector('a, button, select, textarea, input:not([type=radio]), [type=radio]:checked, [tabindex]:not([tabindex="-1"])');h&&(clearInterval(n),d.dispatchEvent(new s.CustomEvent("keyuxJump",{bubbles:!0})),e(h))}},50)}function a(l){l.target.getAttribute("aria-controls")&&l.key==="Enter"&&o(l.target),l.key==="Escape"&&t()}return s.addEventListener("keydown",a),()=>{s.removeEventListener("keydown",a)}}}function zo(s){let i,e=s.split(" "),t;function r(a){a.key==="Enter"&&(a.target.tagName==="BUTTON"||a.target.tagName==="A")&&(n(),a.target.classList.add(...e),i=a.target,t=a.target)}function n(){i&&i.classList.remove(...e),t=null}function o(a){a.clientX===0&&a.clientY===0&&t!==a.target&&(n(),a.target.classList.add(...e),i=a.target)}return a=>(a.addEventListener("click",o),a.addEventListener("keydown",r),a.addEventListener("keyup",n),()=>{a.removeEventListener("click",o),a.removeEventListener("keydown",r),a.removeEventListener("keyup",n)})}function Bo(s,i){let e=i.map(t=>t(s));return()=>{e.forEach(t=>t())}}class Ho{constructor(){u(this,"_listeners",new Map);u(this,"_scope",[])}addEventListener(i,e){const t=r=>{const n=r.target;n&&this._scope.some(o=>o===r.target||o.contains(n))&&e(r)};this._listeners.set(e,t),window.addEventListener(i,t)}removeEventListener(i,e){const t=this._listeners.get(e);t&&window.removeEventListener(i,t),this._listeners.delete(e)}get CustomEvent(){return window.CustomEvent}get document(){return window.document}get navigator(){return window.navigator}registerScope(i){this._scope.push(i)}destroy(){this._scope=[],this._listeners.forEach((i,e)=>{window.removeEventListener("keydown",i),window.removeEventListener("keyup",i),this._listeners.delete(e)})}}class jo{constructor(){u(this,"_destroyKeyUX");u(this,"_scopedWindow");this._scopedWindow=new Ho,this._destroyKeyUX=Bo(this._scopedWindow,[Fo(),zo("is-pressed"),No(),Vo()])}registerBlock(i){this._scopedWindow.registerScope(i)}destroy(){var i;(i=this._destroyKeyUX)==null||i.call(this),this._scopedWindow.destroy()}}const P=Object.freeze({ADD:"modal:add",DELETE:"modal:delete",OPEN:"modal:open",CLOSE:"modal:close",CLOSE_ALL:"modal:closeAll",DESTROY:"modal:destroy"});class Go{constructor(i){u(this,"_modals",new Map);u(this,"_activeModals",new Set);u(this,"_subscribers",new Map);this._block=i}_debugPrint(...i){this._block.debugPrint("[modal-manager]",...i)}registerModal(i,e){this._modals.set(i,e),this._notify(P.ADD,{id:i,modal:e})}deleteModal(i){if(!this._modals.has(i))return!1;const e=this._modals.get(i);return this._modals.delete(i),this._activeModals.delete(i),this._notify(P.DELETE,{id:i,modal:e}),!0}open(i){if(!this._modals.has(i))return this._debugPrint(`Modal with ID "${i}" not found`),!1;const e=this._modals.get(i);return this._activeModals.add(i),this._notify(P.OPEN,{modal:e,id:i}),!0}close(i){if(!this._modals.has(i)||!this._activeModals.has(i))return this._debugPrint(`Modal with ID "${i}" not found or not active`),!1;const e=this._modals.get(i);return this._activeModals.delete(i),this._notify(P.CLOSE,{id:i,modal:e}),!0}toggle(i){return this._modals.has(i)?this._activeModals.has(i)?this.close(i):this.open(i):(this._debugPrint(`Modal with ID "${i}" not found`),!1)}get hasActiveModals(){return this._activeModals.size>0}back(){if(this._activeModals.size===0)return this._debugPrint("No active modals to go back from"),!1;const i=Array.from(this._activeModals).pop();return this.close(i)}closeAll(){const i=this._activeModals.size;return this._activeModals.clear(),this._notify(P.CLOSE_ALL,{}),i}subscribe(i,e){var t;return this._subscribers.has(i)||this._subscribers.set(i,new Set),(t=this._subscribers.get(i))==null||t.add(e),()=>this.unsubscribe(i,e)}unsubscribe(i,e){var t;this._subscribers.has(i)&&((t=this._subscribers.get(i))==null||t.delete(e))}_notify(i,e){if(this._subscribers.has(i))for(const t of this._subscribers.get(i)??new Set)try{t(e)}catch(r){this._debugPrint("Error in modal subscriber:",r)}}destroy(){this.closeAll(),this._modals.clear(),this._subscribers.clear(),this._notify(P.DESTROY,{})}}const Wo="uc-";class I extends at{constructor(){super();u(this,"requireCtxName",!1);u(this,"activityType",null);u(this,"init$",Hs());this.l10nProcessorSubs=new Map,this.addTemplateProcessor(Lo)}l10n(e,t={}){if(!e)return"";let r=this.$[Ee(e)]||e,n=xn(r);for(let a of n)t[a.variable]=this.pluralize(a.pluralKey,Number(t[a.countVariable]));return ai(r,t)}pluralize(e,t){const r=this.l10n("locale-id")||"en",n=ks(r,t);return this.l10n(`${e}__${n}`)}bindL10n(e,t){var r;(r=this.localeManager)==null||r.bindL10n(this,e,t)}emit(e,t,r){const n=this.has("*eventEmitter")&&this.$["*eventEmitter"];n&&n.emit(e,t,r)}hasBlockInCtx(e){for(let t of this.blocksRegistry)if(e(t))return!0;return!1}setOrAddState(e,t){this.add$({[e]:t},!0)}connectedCallback(){this.constructor.styleAttrs.forEach(t=>{this.setAttribute(t,"")}),this.hasAttribute("retpl")&&(this.constructor.template=null,this.processInnerHtml=!0),this.requireCtxName?Sn({element:this,attribute:"ctx-name",onSuccess:()=>{super.connectedCallback()},onTimeout:()=>{console.error("Attribute `ctx-name` is required and it is not set.")}}):super.connectedCallback(),Tt.registerClient(this)}disconnectedCallback(){super.disconnectedCallback(),Tt.unregisterClient(this)}initCallback(){this.has("*blocksRegistry")||this.add("*blocksRegistry",new Set),this.$["*blocksRegistry"].add(this),this.has("*eventEmitter")||this.add("*eventEmitter",new En(this.debugPrint.bind(this))),this.has("*localeManager")||this.add("*localeManager",new Mo(this)),this.has("*a11y")||this.add("*a11y",new jo),this.has("*modalManager")||this.add("*modalManager",new Go(this)),this.sub(Ee("locale-id"),t=>{const r=An(t);this.style.direction=r==="ltr"?"":r})}get modalManager(){return this.has("*modalManager")&&this.$["*modalManager"]}get localeManager(){return this.has("*localeManager")?this.$["*localeManager"]:null}get a11y(){return this.has("*a11y")?this.$["*a11y"]:null}get blocksRegistry(){return this.$["*blocksRegistry"]}destroyCallback(){var t;super.destroyCallback();let e=this.blocksRegistry;e==null||e.delete(this),(t=this.localeManager)==null||t.destroyL10nBindings(this),this.l10nProcessorSubs=new Map,x.deleteCtx(this),(e==null?void 0:e.size)===0&&setTimeout(()=>{this.destroyCtxCallback()},0)}destroyCtxCallback(){var e,t;x.deleteCtx(this.ctxName),(e=this.localeManager)==null||e.destroy(),this.modalManager&&((t=this.modalManager)==null||t.destroy())}async proxyUrl(e){if(this.cfg.secureDeliveryProxy&&this.cfg.secureDeliveryProxyUrlResolver&&console.warn("Both secureDeliveryProxy and secureDeliveryProxyUrlResolver are set. The secureDeliveryProxyUrlResolver will be used."),this.cfg.secureDeliveryProxyUrlResolver)try{return await this.cfg.secureDeliveryProxyUrlResolver(e,{uuid:Es(e),cdnUrlModifiers:As(e),fileName:bi(e)})}catch(t){return console.error("Failed to resolve secure delivery proxy URL. Falling back to the default URL.",t),e}return this.cfg.secureDeliveryProxy?ai(this.cfg.secureDeliveryProxy,{previewUrl:e},{transform:t=>window.encodeURIComponent(t)}):e}get cfg(){if(!this.__cfgProxy){let e=Object.create(null);this.__cfgProxy=new Proxy(e,{set:(t,r,n)=>{if(typeof r!="string")return!1;const o=B(r);return this.has(o)||this.add(o,pe[r]),this.$[o]=n,!0},get:(t,r)=>{const n=B(r);return this.has(n)||this.add(n,pe[r]),this.$[B(r)]}})}return this.__cfgProxy}subConfigValue(e,t){const r=B(e);this.has(r)||this.add(r,pe[e]),this.sub(r,t)}debugPrint(...e){if(!this.cfg.debug)return;let t=e;if(typeof(e==null?void 0:e[0])=="function"){const r=e[0];t=r()}console.log(`[${this.ctxName}]`,...t)}static reg(e){if(!e){super.reg();return}e.startsWith(Wo)&&super.reg(e)}}u(I,"StateConsumerScope",null),u(I,"styleAttrs",[]);const qo="<svg width='0' height='0' style='position:absolute'><symbol viewBox='0 0 24 24' id='uc-icon-about' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M11.152 14.12v.1h1.523v-.1c.007-.409.053-.752.138-1.028.086-.277.22-.517.405-.72.188-.202.434-.397.735-.586.32-.191.593-.412.82-.66.232-.249.41-.531.533-.847.125-.32.187-.678.187-1.076 0-.579-.137-1.085-.41-1.518a2.717 2.717 0 0 0-1.14-1.018c-.49-.245-1.062-.367-1.715-.367-.597 0-1.142.114-1.636.34-.49.228-.884.564-1.182 1.008-.299.44-.46.98-.485 1.619h1.62c.024-.377.118-.684.282-.922a1.48 1.48 0 0 1 .617-.532c.25-.114.51-.17.784-.17.301 0 .575.063.82.191.248.124.447.302.597.533.149.23.223.504.223.82 0 .263-.05.502-.149.72a1.91 1.91 0 0 1-.405.574 3.48 3.48 0 0 1-.575.453 4.22 4.22 0 0 0-.847.66c-.234.242-.415.558-.543.949-.125.39-.19.916-.197 1.577Zm.053 3.03c.21.206.46.31.75.31.196 0 .374-.049.534-.144a1.1 1.1 0 0 0 .383-.384c.1-.163.15-.343.15-.538a1 1 0 0 0-.32-.746 1.019 1.019 0 0 0-.746-.314c-.291 0-.542.105-.751.314-.21.206-.314.455-.314.746 0 .295.104.547.314.756ZM24 12c0 6.627-5.373 12-12 12S0 18.627 0 12 5.373 0 12 0s12 5.373 12 12Zm-1.5 0c0 5.799-4.701 10.5-10.5 10.5S1.5 17.799 1.5 12 6.201 1.5 12 1.5 22.5 6.201 22.5 12Z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-add' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M12.75 21a.75.75 0 0 1-1.5 0v-8.25H3a.75.75 0 0 1 0-1.5h8.25V3a.75.75 0 0 1 1.5 0v8.25H21a.75.75 0 0 1 0 1.5h-8.25V21Z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-arrow-down' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M11.5 23.03a.75.75 0 0 0 .999 0l9.29-8.276a.75.75 0 0 0-.998-1.12l-8.042 7.164V1.53a.75.75 0 0 0-1.5 0v19.267l-8.04-7.163a.75.75 0 0 0-.998 1.12z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-back' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M20.251 12a.75.75 0 0 1-.75.75H6.067l5.72 5.85a.75.75 0 1 1-1.072 1.05L4.136 12.92a1.292 1.292 0 0 1 0-1.842l6.579-6.728a.75.75 0 1 1 1.072 1.048l-5.72 5.851H19.5a.75.75 0 0 1 .75.75Z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-badge-error' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M13.6 18.4a1.6 1.6 0 1 1-3.2 0 1.6 1.6 0 0 1 3.2 0zM12 4.5A1.5 1.5 0 0 1 13.5 6v7a1.5 1.5 0 0 1-3 0V6A1.5 1.5 0 0 1 12 4.5z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-badge-success' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='m10.5 18.204 7.6-8.183a1.5 1.5 0 0 0-2.2-2.042l-5.4 5.817-2.4-2.586a1.5 1.5 0 1 0-2.2 2.041l4.6 4.953Z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-box' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M1.01 4.148a.75.75 0 0 1 .75.75v4.348a4.437 4.437 0 0 1 2.988-1.153c1.734 0 3.23.992 3.978 2.438a4.478 4.478 0 0 1 3.978-2.438c2.49 0 4.488 2.044 4.488 4.543 0 2.5-1.999 4.544-4.488 4.544a4.478 4.478 0 0 1-3.978-2.438 4.478 4.478 0 0 1-3.978 2.438C2.26 17.18.26 15.135.26 12.636V4.898a.75.75 0 0 1 .75-.75Zm.75 8.488c0 1.692 1.348 3.044 2.988 3.044s2.989-1.352 2.989-3.044c0-1.691-1.349-3.043-2.989-3.043S1.76 10.945 1.76 12.636Zm10.944-3.043c-1.64 0-2.988 1.352-2.988 3.043 0 1.692 1.348 3.044 2.988 3.044s2.988-1.352 2.988-3.044c0-1.69-1.348-3.043-2.988-3.043Zm4.328-1.23a.75.75 0 0 1 1.052.128l2.333 2.983 2.333-2.983a.75.75 0 0 1 1.181.924l-2.562 3.277 2.562 3.276a.75.75 0 1 1-1.181.924l-2.333-2.983-2.333 2.983a.75.75 0 1 1-1.181-.924l2.562-3.276-2.562-3.277a.75.75 0 0 1 .129-1.052Z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-camera' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M7.65 2.55a.75.75 0 0 1 .6-.3h7.5a.75.75 0 0 1 .6.3l2.025 2.7H21a3 3 0 0 1 3 3v10.5a3 3 0 0 1-3 3H3a3 3 0 0 1-3-3V8.25a3 3 0 0 1 3-3h2.625zm.975 1.2L6.6 6.45a.75.75 0 0 1-.6.3H3a1.5 1.5 0 0 0-1.5 1.5v10.5a1.5 1.5 0 0 0 1.5 1.5h18a1.5 1.5 0 0 0 1.5-1.5V8.25a1.5 1.5 0 0 0-1.5-1.5h-3a.75.75 0 0 1-.6-.3l-2.025-2.7zm3.375 6a3.375 3.375 0 1 0 0 6.75 3.375 3.375 0 0 0 0-6.75zm-4.875 3.375a4.875 4.875 0 1 1 9.75 0 4.875 4.875 0 0 1-9.75 0z'/></symbol><symbol viewBox='0 0 20 20' id='uc-icon-camera-full' xmlns='http://www.w3.org/2000/svg'><path fill-rule='evenodd' clip-rule='evenodd' d='M2 4.667a2 2 0 0 0-2 2V16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V6.667a2 2 0 0 0-2-2h-2.667l-2-2.667H6.667l-2 2.667H2Zm8 10a3.667 3.667 0 1 0 0-7.334 3.667 3.667 0 0 0 0 7.334Z' fill='currentColor'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-close' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M4.604 4.604a.75.75 0 0 1 1.06 0L12 10.939l6.335-6.335a.75.75 0 1 1 1.061 1.06L13.061 12l6.335 6.335a.75.75 0 1 1-1.06 1.061L12 13.061l-6.335 6.335a.75.75 0 0 1-1.061-1.06L10.939 12 4.604 5.665a.75.75 0 0 1 0-1.061z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-collapse' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M3.116 12a.75.75 0 0 1 .75-.75h16.268a.75.75 0 0 1 0 1.5H3.866a.75.75 0 0 1-.75-.75Z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-default' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M11.501.392a.75.75 0 0 1 .998 0l6.704 5.972a.75.75 0 0 1-.998 1.12l-5.455-4.86v13.439a.75.75 0 0 1-1.5 0V2.625l-5.454 4.86a.75.75 0 1 1-.998-1.12zM.857 16.73a.75.75 0 0 1 .75.75v4.914h20.786v-4.914a.75.75 0 0 1 1.5 0v5.664a.75.75 0 0 1-.75.75H.857a.75.75 0 0 1-.75-.75v-5.664a.75.75 0 0 1 .75-.75z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-dropbox' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M6.019 1.92a.75.75 0 0 1 .806 0L12 5.219l5.176-3.297a.75.75 0 0 1 .806 0l5.577 3.553a.75.75 0 0 1 0 1.265l-4.574 2.914 4.574 2.914a.75.75 0 0 1 0 1.265l-5.577 3.554a.75.75 0 0 1-.806 0L12 14.089l-5.175 3.297a.75.75 0 0 1-.806 0L.44 13.833a.75.75 0 0 1 0-1.266l4.575-2.914L.44 6.74a.75.75 0 0 1 0-1.265zm.403 8.616L2.24 13.2l4.182 2.664 4.181-2.664zm6.975 2.664 4.182 2.664L21.76 13.2l-4.181-2.664zm2.776-3.547L12 12.311 7.828 9.653 12 6.995zm1.406-.882 4.181-2.664-4.181-2.664-4.182 2.664zm-6.976-2.664L6.422 3.443 2.24 6.107 6.422 8.77zM5.791 18.544a.75.75 0 0 1 1.035-.23l5.175 3.297 5.175-3.297a.75.75 0 1 1 .806 1.265l-5.578 3.554a.75.75 0 0 1-.806 0L6.02 19.579a.75.75 0 0 1-.23-1.035z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-edit-file' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M18.558 2.804a.78.78 0 0 0-.557.235l-.008.007-2.472 2.46 3.847 3.848 2.46-2.473.004-.003a.78.78 0 0 0 0-1.108l-.004-.003-2.712-2.728a.78.78 0 0 0-.558-.235Zm-.248 7.613-3.852-3.852-8.93 8.887-1.516 5.41 5.41-1.515 8.888-8.93Zm-.636-8.934a2.28 2.28 0 0 1 2.512.505l2.702 2.717.002.002a2.278 2.278 0 0 1 0 3.234l-.002.002-12.541 12.602a.75.75 0 0 1-.33.193l-6.884 1.928a.75.75 0 0 1-.925-.924l1.928-6.885a.75.75 0 0 1 .193-.33l12.603-12.54a2.28 2.28 0 0 1 .742-.504Z' clip-rule='evenodd'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-error' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M13 13h-2V7h2m0 10h-2v-2h2M12 2A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10A10 10 0 0 0 12 2Z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-evernote' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M9.804 2.27v-.048c.055-.263.313-.562.85-.562h.44c.142 0 .325.014.526.033.066.009.124.023.267.06l.13.032h.002c.319.079.515.275.644.482a1.461 1.461 0 0 1 .16.356l.004.012a.75.75 0 0 0 .603.577l1.191.207a1988.512 1988.512 0 0 0 2.332.402c.512.083 1.1.178 1.665.442.64.3 1.19.795 1.376 1.77.548 2.931.657 5.829.621 8a39.233 39.233 0 0 1-.125 2.602 17.518 17.518 0 0 1-.092.849.735.735 0 0 0-.024.112c-.378 2.705-1.269 3.796-2.04 4.27-.746.457-1.53.451-2.217.447h-.192c-.46 0-1.073-.23-1.581-.635-.518-.412-.763-.87-.763-1.217 0-.45.188-.688.355-.786.161-.095.436-.137.796.087a.75.75 0 1 0 .792-1.274c-.766-.476-1.64-.52-2.345-.108-.7.409-1.098 1.188-1.098 2.08 0 .996.634 1.84 1.329 2.392.704.56 1.638.96 2.515.96l.185.002c.667.009 1.874.025 3.007-.67 1.283-.786 2.314-2.358 2.733-5.276a4.213 4.213 0 0 0 .056-.335c.023-.184.051-.445.079-.772.055-.655.111-1.585.13-2.704.037-2.234-.074-5.239-.647-8.301v-.002c-.294-1.544-1.233-2.391-2.215-2.85-.777-.363-1.623-.496-2.129-.576a8.872 8.872 0 0 1-.25-.041l-.006-.001-1.99-.345-.761-.132a2.93 2.93 0 0 0-.182-.338A2.532 2.532 0 0 0 12.379.329l-.091-.023a3.967 3.967 0 0 0-.493-.103L11.769.2a7.846 7.846 0 0 0-.675-.04h-.44c-.733 0-1.368.284-1.795.742L2.416 7.431c-.468.428-.751 1.071-.751 1.81 0 .02 0 .041.003.062l.003.034c.017.21.038.468.096.796.107.715.275 1.47.391 1.994.029.13.055.245.075.342l.002.008c.258 1.141.641 1.94.978 2.466.168.263.323.456.444.589a2.808 2.808 0 0 0 .192.194c1.536 1.562 3.713 2.196 5.731 2.08.13-.005.35-.032.537-.073a2.627 2.627 0 0 0 .652-.24c.425-.26.75-.661.992-1.046.184-.294.342-.61.473-.915a3.8 3.8 0 0 0 .627.493 5.022 5.022 0 0 0 1.97.709l.023.002.018.003.11.016c.088.014.205.035.325.058l.056.014c.088.022.164.04.235.061a1.736 1.736 0 0 1 .145.048l.03.014c.765.34 1.302 1.09 1.302 1.871a.75.75 0 0 0 1.5 0c0-1.456-.964-2.69-2.18-3.235a3.595 3.595 0 0 0-.679-.217l-.063-.015a10.616 10.616 0 0 0-.606-.105l-.02-.003-.03-.003h-.002a3.542 3.542 0 0 1-1.331-.485c-.471-.298-.788-.692-.828-1.234a.75.75 0 0 0-1.48-.106l-.001.003-.004.017a8.23 8.23 0 0 1-.092.352 9.963 9.963 0 0 1-.298.892c-.132.34-.29.68-.47.966-.174.276-.339.454-.478.549a1.178 1.178 0 0 1-.221.072 1.949 1.949 0 0 1-.241.036h-.013l-.032.002c-1.684.1-3.423-.437-4.604-1.65a.746.746 0 0 0-.053-.05L4.84 14.6a1.348 1.348 0 0 1-.07-.073 2.99 2.99 0 0 1-.293-.392c-.242-.379-.558-1.014-.778-1.985a54.1 54.1 0 0 0-.083-.376 27.494 27.494 0 0 1-.367-1.872l-.003-.02a6.791 6.791 0 0 1-.08-.67c.004-.277.086-.475.2-.609l.067-.067a.63.63 0 0 1 .292-.145h.05c.18 0 1.095.055 2.013.115l1.207.08.534.037a.747.747 0 0 0 .052.002c.782 0 1.349-.206 1.759-.585l.005-.005c.553-.52.622-1.225.622-1.76V6.24l-.026-.565A774.97 774.97 0 0 1 9.885 4.4c-.042-.961-.081-1.939-.081-2.13ZM4.995 6.953a251.126 251.126 0 0 1 2.102.137l.508.035c.48-.004.646-.122.715-.185.07-.068.146-.209.147-.649l-.024-.548a791.69 791.69 0 0 1-.095-2.187L4.995 6.953Zm16.122 9.996Zm-5.479-5.323a.75.75 0 0 0 1.014.31 2.04 2.04 0 0 1 .304-.089 1.84 1.84 0 0 1 .544-.039c.215.023.321.06.37.085.033.016.039.026.047.04a.75.75 0 0 0 1.289-.767c-.337-.567-.906-.783-1.552-.85a3.334 3.334 0 0 0-1.002.062c-.27.056-.531.14-.705.234a.75.75 0 0 0-.31 1.014Z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-expand' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='m12 8.337-8.47 8.47a.75.75 0 0 1-1.06-1.06l8.605-8.606a1.29 1.29 0 0 1 1.85 0l8.605 8.605a.75.75 0 1 1-1.06 1.06L12 8.338Z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-external-source-placeholder' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M6.341 3.27a10.5 10.5 0 0 1 5.834-1.77.75.75 0 0 0 0-1.5 12 12 0 1 0 12 12 .75.75 0 0 0-1.5 0A10.5 10.5 0 1 1 6.34 3.27Zm14.145 1.48a.75.75 0 1 0-1.06-1.062L9.925 13.19V7.95a.75.75 0 1 0-1.5 0V15c0 .414.336.75.75.75h7.05a.75.75 0 0 0 0-1.5h-5.24l9.501-9.5Z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-facebook' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M12 1.5C6.201 1.5 1.5 6.201 1.5 12c0 4.943 3.416 9.089 8.016 10.204v-6.108H7.383a.75.75 0 0 1-.75-.75v-3.281a.75.75 0 0 1 .75-.75h2.133V9.393c0-.958.225-2.511 1.38-3.65 1.194-1.177 3.174-1.718 6.254-1.056a.75.75 0 0 1 .592.733v2.754a.75.75 0 0 1-.75.75c-.692 0-1.203.026-1.584.082-.387.057-.578.137-.675.202-.109.073-.237.205-.237 1.029v1.078h2.39a.75.75 0 0 1 .742.866l-.516 3.281a.75.75 0 0 1-.74.634h-1.876v6.106C19.09 21.082 22.5 16.939 22.5 12c0-5.799-4.701-10.5-10.5-10.5zM0 12C0 5.373 5.373 0 12 0s12 5.373 12 12c0 5.995-4.395 10.961-10.138 11.856a.75.75 0 0 1-.866-.74v-7.77a.75.75 0 0 1 .75-.75h1.984l.28-1.781h-2.264a.75.75 0 0 1-.75-.75v-1.828c0-.829.089-1.729.9-2.274.363-.244.807-.37 1.293-.441a9.623 9.623 0 0 1 1.053-.086V6.04c-2.41-.405-3.645.132-4.293.771-.737.728-.933 1.793-.933 2.582v2.672a.75.75 0 0 1-.75.75H8.133v1.78h2.133a.75.75 0 0 1 .75.75v7.772a.75.75 0 0 1-.865.741C4.4 22.968 0 18 0 12z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-file' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M2.895 1.201c0-.473.383-.857.857-.857h8.4c.227 0 .445.09.606.251l8.4 8.4c.16.16.25.379.25.606v13.2a.857.857 0 0 1-.856.857h-16.8a.857.857 0 0 1-.857-.857zm1.714.857v19.886h15.085V10.458h-7.542a.857.857 0 0 1-.858-.857V2.058zm8.4 1.213 5.473 5.473H13.01z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-flickr' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M5.959 7.926c-2.298 0-4.14 1.834-4.14 4.073 0 2.241 1.842 4.075 4.14 4.075 2.302 0 4.145-1.834 4.145-4.075 0-2.238-1.843-4.073-4.145-4.073Zm-5.64 4.073c0-3.086 2.533-5.573 5.64-5.573 3.11 0 5.645 2.486 5.645 5.573 0 3.089-2.535 5.575-5.645 5.575-3.107 0-5.64-2.487-5.64-5.575Zm18.07-4.073c-2.301 0-4.144 1.835-4.144 4.073 0 2.24 1.843 4.075 4.145 4.075 2.299 0 4.141-1.834 4.141-4.075 0-2.239-1.842-4.073-4.141-4.073Zm-5.644 4.073c0-3.087 2.535-5.573 5.645-5.573 3.108 0 5.641 2.487 5.641 5.573 0 3.088-2.533 5.575-5.641 5.575-3.11 0-5.645-2.486-5.645-5.575Z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-gdrive' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M7.736 1.818a.75.75 0 0 1 .647-.37h7.587a.75.75 0 0 1 .655.383l7.233 12.946a.75.75 0 0 1-.003.737l-3.794 6.66a.75.75 0 0 1-.651.378H4.59a.75.75 0 0 1-.651-.378l-3.794-6.66a.75.75 0 0 1 .005-.75zm.64 1.876L1.663 15.148l2.93 5.145 6.655-11.581zm3.736 6.526-2.398 4.173H14.5zm4.116 4.173h5.697L15.53 2.947H9.677zm5.685 1.5H8.852l-2.966 5.16h13.088z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-gphotos' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M12.51 0c-.702 0-1.272.57-1.272 1.273V7.35A6.381 6.381 0 0 0 0 11.489c0 .703.57 1.273 1.273 1.273H7.35A6.381 6.381 0 0 0 11.488 24c.704 0 1.274-.57 1.274-1.273V16.65A6.381 6.381 0 0 0 24 12.51c0-.703-.57-1.273-1.273-1.273H16.65A6.381 6.381 0 0 0 12.511 0Zm.252 11.232V1.53a4.857 4.857 0 0 1 0 9.702Zm-1.53.006H1.53a4.857 4.857 0 0 1 9.702 0Zm1.536 1.524a4.857 4.857 0 0 0 9.702 0h-9.702Zm-6.136 4.857c0-2.598 2.04-4.72 4.606-4.85v9.7a4.857 4.857 0 0 1-4.606-4.85Z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-huddle' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M6.204 2.002c-.252.23-.357.486-.357.67V21.07c0 .15.084.505.313.812.208.28.499.477.929.477.519 0 .796-.174.956-.365.178-.212.286-.535.286-.924v-.013l.117-6.58c.004-1.725 1.419-3.883 3.867-3.883 1.33 0 2.332.581 2.987 1.364.637.762.95 1.717.95 2.526v6.47c0 .392.11.751.305.995.175.22.468.41 1.008.41.52 0 .816-.198 1.002-.437.207-.266.31-.633.31-.969V14.04c0-2.81-1.943-5.108-4.136-5.422a5.971 5.971 0 0 0-3.183.41c-.912.393-1.538.96-1.81 1.489a.75.75 0 0 1-1.417-.344v-7.5c0-.587-.47-1.031-1.242-1.031-.315 0-.638.136-.885.36ZM5.194.892A2.844 2.844 0 0 1 7.09.142c1.328 0 2.742.867 2.742 2.53v5.607a6.358 6.358 0 0 1 1.133-.629 7.47 7.47 0 0 1 3.989-.516c3.056.436 5.425 3.482 5.425 6.906v6.914c0 .602-.177 1.313-.627 1.89-.47.605-1.204 1.016-2.186 1.016-.96 0-1.698-.37-2.179-.973-.46-.575-.633-1.294-.633-1.933v-6.469c0-.456-.19-1.071-.602-1.563-.394-.471-.986-.827-1.836-.827-1.447 0-2.367 1.304-2.367 2.39v.014l-.117 6.58c-.001.64-.177 1.333-.637 1.881-.48.57-1.2.9-2.105.9-.995 0-1.7-.5-2.132-1.081-.41-.552-.61-1.217-.61-1.708V2.672c0-.707.366-1.341.847-1.78Z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-info' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M11 9h2V7h-2m1 13c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8m0-18A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10A10 10 0 0 0 12 2m-1 15h2v-6h-2v6Z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-local' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M3 3.75a1.5 1.5 0 0 0-1.5 1.5v13.5a1.5 1.5 0 0 0 1.5 1.5h18a1.5 1.5 0 0 0 1.5-1.5V9A1.5 1.5 0 0 0 21 7.5h-9a.75.75 0 0 1-.643-.364L9.325 3.75zm-3 1.5a3 3 0 0 1 3-3h6.75a.75.75 0 0 1 .643.364L12.425 6H21a3 3 0 0 1 3 3v9.75a3 3 0 0 1-3 3H3a3 3 0 0 1-3-3z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-microphone' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' clip-rule='evenodd' d='M7.5 4.781a4.5 4.5 0 0 1 9 0v6.469a4.5 4.5 0 1 1-9 0V4.781Zm4.5-3a3 3 0 0 0-3 3v6.469a3 3 0 1 0 6 0V4.781a3 3 0 0 0-3-3Zm-8.156 8.11a.75.75 0 0 1 .75.75 7.406 7.406 0 1 0 14.812 0 .75.75 0 0 1 1.5 0 8.907 8.907 0 0 1-8.156 8.875v2.703h3.258a.75.75 0 1 1 0 1.5H7.992a.75.75 0 0 1 0-1.5h3.258v-2.703a8.907 8.907 0 0 1-8.156-8.875.75.75 0 0 1 .75-.75Z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-microphone-mute' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' clip-rule='evenodd' d='M7.5 4.781a4.5 4.5 0 0 1 9 0V6l3.524-3.524a.75.75 0 1 1 1.061 1.06L5.036 19.585a.75.75 0 0 1-1.06-1.06l1.656-1.657a8.88 8.88 0 0 1-2.538-6.227.75.75 0 0 1 1.5 0c0 2.009.8 3.83 2.1 5.166l1.771-1.772A4.483 4.483 0 0 1 7.5 11.25V4.781Zm2.037 8.182L15 7.5V4.781a3 3 0 1 0-6 0v6.469c0 .637.198 1.227.537 1.713Zm10.62-3.072a.75.75 0 0 1 .75.75 8.907 8.907 0 0 1-8.157 8.875v2.703h3.258a.75.75 0 1 1 0 1.5H7.992a.75.75 0 0 1 0-1.5h3.258v-2.703a8.855 8.855 0 0 1-3.035-.811.75.75 0 1 1 .638-1.358 7.406 7.406 0 0 0 10.553-6.707.75.75 0 0 1 .75-.75ZM15 10.81a.75.75 0 0 1 1.5 0v.439a4.5 4.5 0 0 1-5 4.473.75.75 0 1 1 .166-1.491A3 3 0 0 0 15 11.25v-.44Z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-mobile-photo-camera' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M7.65 2.55a.75.75 0 0 1 .6-.3h7.5a.75.75 0 0 1 .6.3l2.025 2.7H21a3 3 0 0 1 3 3v10.5a3 3 0 0 1-3 3H3a3 3 0 0 1-3-3V8.25a3 3 0 0 1 3-3h2.625zm.975 1.2L6.6 6.45a.75.75 0 0 1-.6.3H3a1.5 1.5 0 0 0-1.5 1.5v10.5a1.5 1.5 0 0 0 1.5 1.5h18a1.5 1.5 0 0 0 1.5-1.5V8.25a1.5 1.5 0 0 0-1.5-1.5h-3a.75.75 0 0 1-.6-.3l-2.025-2.7zm3.375 6a3.375 3.375 0 1 0 0 6.75 3.375 3.375 0 0 0 0-6.75zm-4.875 3.375a4.875 4.875 0 1 1 9.75 0 4.875 4.875 0 0 1-9.75 0z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-mobile-video-camera' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' clip-rule='evenodd' d='M0 6.75a3 3 0 0 1 3-3h12a3 3 0 0 1 3 3v1.078L22.873 5A.75.75 0 0 1 24 5.648v12.704a.75.75 0 0 1-1.123.65L18 16.207v1.043a3 3 0 0 1-3 3H3a3 3 0 0 1-3-3V6.75Zm18 7.728 4.5 2.58V6.95L18 9.562v4.916ZM16.5 6.75a1.5 1.5 0 0 0-1.5-1.5H3a1.5 1.5 0 0 0-1.5 1.5v10.5a1.5 1.5 0 0 0 1.5 1.5h12a1.5 1.5 0 0 0 1.5-1.5V6.75Z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-onedrive' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M13.616 4.147a7.689 7.689 0 0 0-7.642 3.285A6.299 6.299 0 0 0 1.455 17.3c.684.894 2.473 2.658 5.17 2.658h12.141c.95 0 1.882-.256 2.697-.743.815-.486 1.514-1.247 1.964-2.083a5.26 5.26 0 0 0-3.713-7.612 7.69 7.69 0 0 0-6.098-5.373ZM3.34 17.15c.674.63 1.761 1.308 3.284 1.308h12.142a3.76 3.76 0 0 0 2.915-1.383l-7.494-4.489L3.34 17.15Zm10.875-6.25 2.47-1.038a5.239 5.239 0 0 1 1.427-.389 6.19 6.19 0 0 0-10.3-1.952 6.338 6.338 0 0 1 2.118.813l4.285 2.567Zm4.55.033c-.512 0-1.019.104-1.489.307l-.006.003-1.414.594 6.521 3.906a3.76 3.76 0 0 0-3.357-4.8l-.254-.01ZM4.097 9.617A4.799 4.799 0 0 1 6.558 8.9c.9 0 1.84.25 2.587.713l3.4 2.037-10.17 4.28a4.799 4.799 0 0 1 1.721-6.312Z'/></symbol><symbol fill='none' viewBox='0 0 10 10' id='uc-icon-pause' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' d='M1 0h2.5v10H1zM6.5 0H9v10H6.5z'/></symbol><symbol fill='none' viewBox='0 0 10 10' id='uc-icon-play' xmlns='http://www.w3.org/2000/svg'><path d='m1 0 9 5-9 5V0Z' fill='currentColor'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-remove-file' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M11.955 3.3A2.969 2.969 0 0 0 8.998 6h5.914a2.97 2.97 0 0 0-2.957-2.7zM16.416 6a4.47 4.47 0 0 0-8.922 0h-2.32a.755.755 0 0 0-.111.008H3.075a.75.75 0 1 0 0 1.5h1.35V19.35a2.85 2.85 0 0 0 2.85 2.85h9.45a2.85 2.85 0 0 0 2.85-2.85V7.508h1.35a.75.75 0 0 0 0-1.5h-1.989A.754.754 0 0 0 18.825 6zM5.925 7.508V19.35a1.35 1.35 0 0 0 1.35 1.35h9.45a1.35 1.35 0 0 0 1.35-1.35V7.508z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-select' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='m7 10 5 5 5-5H7Z'/></symbol><symbol fill='none' viewBox='0 0 20 20' id='uc-icon-square' xmlns='http://www.w3.org/2000/svg'><rect width='20' height='20' rx='4' fill='#fff'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-upload' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M11.501.392a.75.75 0 0 1 .998 0l6.704 5.972a.75.75 0 0 1-.998 1.12l-5.455-4.86v13.439a.75.75 0 0 1-1.5 0V2.625l-5.454 4.86a.75.75 0 1 1-.998-1.12zM.857 16.73a.75.75 0 0 1 .75.75v4.914h20.786v-4.914a.75.75 0 0 1 1.5 0v5.664a.75.75 0 0 1-.75.75H.857a.75.75 0 0 1-.75-.75v-5.664a.75.75 0 0 1 .75-.75z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-upload-error' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M13 13h-2V7h2m0 10h-2v-2h2M12 2A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10A10 10 0 0 0 12 2Z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-url' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M19.11 3.67c-1.71-1.709-4.578-1.682-6.408.148l-2.22 2.22a.75.75 0 0 1-1.062-1.06l2.222-2.221C14.018.381 17.836.276 20.17 2.61l1.22 1.22c2.335 2.334 2.23 6.153-.147 8.529l-2.22 2.22a.75.75 0 0 1-1.062-1.06l2.222-2.221c1.83-1.83 1.856-4.698.147-6.408zm-3.36 4.58a.75.75 0 0 1 0 1.06l-6.439 6.44a.75.75 0 0 1-1.06-1.06l6.439-6.44a.75.75 0 0 1 1.06 0zM6.04 9.42a.75.75 0 0 1 0 1.061l-2.222 2.222c-1.83 1.83-1.856 4.698-.147 6.407l1.22 1.22c1.71 1.71 4.578 1.683 6.408-.147l2.221-2.221a.75.75 0 1 1 1.06 1.06l-2.22 2.222c-2.377 2.376-6.195 2.481-8.53.147l-1.22-1.22c-2.334-2.334-2.228-6.153.148-8.53l2.221-2.22a.75.75 0 0 1 1.06 0z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-video-camera' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' clip-rule='evenodd' d='M0 6.75a3 3 0 0 1 3-3h12a3 3 0 0 1 3 3v1.078L22.873 5A.75.75 0 0 1 24 5.648v12.704a.75.75 0 0 1-1.123.65L18 16.207v1.043a3 3 0 0 1-3 3H3a3 3 0 0 1-3-3V6.75Zm18 7.728 4.5 2.58V6.95L18 9.562v4.916ZM16.5 6.75a1.5 1.5 0 0 0-1.5-1.5H3a1.5 1.5 0 0 0-1.5 1.5v10.5a1.5 1.5 0 0 0 1.5 1.5h12a1.5 1.5 0 0 0 1.5-1.5V6.75Z'/></symbol><symbol viewBox='0 0 20 20' id='uc-icon-video-camera-full' xmlns='http://www.w3.org/2000/svg'><path d='M2 3.333a2 2 0 0 0-2 2v9.334a2 2 0 0 0 2 2h10.938a2 2 0 0 0 2-2v-2.013L20 15.646V4.354l-5.063 3.03v-2.05a2 2 0 0 0-2-2H2Z' fill='currentColor'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-vk' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M6.341 3.27a10.5 10.5 0 0 1 5.834-1.77.75.75 0 0 0 0-1.5 12 12 0 1 0 12 12 .75.75 0 0 0-1.5 0A10.5 10.5 0 1 1 6.34 3.27Zm14.145 1.48a.75.75 0 1 0-1.06-1.062L9.925 13.19V7.95a.75.75 0 1 0-1.5 0V15c0 .414.336.75.75.75h7.05a.75.75 0 0 0 0-1.5h-5.24l9.501-9.5Z'/></symbol></svg>";class ct extends I{constructor(){super(...arguments);u(this,"requireCtxName",!0);u(this,"init$",Gs(this));u(this,"_template",null)}initCallback(){var e;super.initCallback(),(e=this.a11y)==null||e.registerBlock(this)}static set template(e){this._template=qo+e+"<slot></slot>"}static get template(){return this._template}}u(ct,"styleAttrs",["uc-wgt-common"]);const Hi="active",Be="___ACTIVITY_IS_ACTIVE___",ae=class ae extends I{constructor(){super(...arguments);u(this,"historyTracked",!1);u(this,"init$",js(this));u(this,"_debouncedHistoryFlush",H(this._historyFlush.bind(this),10))}_deactivate(){var t;let e=ae._activityCallbacks.get(this);this[Be]=!1,this.removeAttribute(Hi),(t=e==null?void 0:e.deactivateCallback)==null||t.call(e)}_activate(){var t;let e=ae._activityCallbacks.get(this);this.$["*historyBack"]=this.historyBack.bind(this),this[Be]=!0,this.setAttribute(Hi,""),(t=e==null?void 0:e.activateCallback)==null||t.call(e),this._debouncedHistoryFlush(),this.emit(k.ACTIVITY_CHANGE,{activity:this.activityType})}initCallback(){super.initCallback(),this.activityType&&(this.hasAttribute("activity")||this.setAttribute("activity",this.activityType),this.sub("*currentActivity",e=>{try{this.activityType!==e&&this[Be]?this._deactivate():this.activityType===e&&!this[Be]&&this._activate()}catch(t){console.error(`Error in activity "${this.activityType}". `,t),this.$["*currentActivity"]=this.$["*history"][this.$["*history"].length-1]??null}e||(this.$["*history"]=[])}))}_historyFlush(){let e=this.$["*history"];e&&(e.length>10&&(e=e.slice(e.length-11,e.length-1)),this.historyTracked&&e[e.length-1]!==this.activityType&&e.push(this.activityType),this.$["*history"]=e)}_isActivityRegistered(){return this.activityType&&ae._activityCallbacks.has(this)}get isActivityActive(){return this[Be]}get couldOpenActivity(){return!0}registerActivity(e,t={}){const{onActivate:r,onDeactivate:n}=t;ae._activityCallbacks.set(this,{activateCallback:r,deactivateCallback:n})}unregisterActivity(){this.isActivityActive&&this._deactivate(),ae._activityCallbacks.delete(this)}destroyCallback(){super.destroyCallback(),this._isActivityRegistered()&&this.unregisterActivity();const e=this.$["*currentActivity"];!![...this.blocksRegistry].find(r=>r instanceof ae&&r.activityType===e)||(this.$["*currentActivity"]=null,this.modalManager.closeAll())}get activityKey(){return this.ctxName+this.activityType}get activityParams(){return this.$["*currentActivityParams"]}get initActivity(){return this.getCssData("--cfg-init-activity")}get doneActivity(){return this.getCssData("--cfg-done-activity")}historyBack(){let e=this.$["*history"];if(e){let t=e.pop();for(;t===this.activityType;)t=e.pop();let r=!!t;if(t){const n=[...this.blocksRegistry].find(o=>o.activityType===t);r=(n==null?void 0:n.couldOpenActivity)??!1}t=r?t:void 0,t&&this.modalManager.open(t),this.$["*currentActivity"]=t,this.$["*history"]=e,t||this.modalManager.closeAll()}}};u(ae,"_activityCallbacks",new Map);let g=ae;g.activities=Object.freeze({START_FROM:"start-from",CAMERA:"camera",DRAW:"draw",UPLOAD_LIST:"upload-list",URL:"url",CLOUD_IMG_EDIT:"cloud-image-edit",EXTERNAL:"external"});const Xo=20,ui=24,qe=34,Xs=3,te=Xs/2,ye=1,ft=100/3,E=1,ji=24,Zo=6;function Ce(s,i){for(let e in i)s.setAttributeNS(null,e,i[e].toString())}function G(s,i={}){let e=document.createElementNS("http://www.w3.org/2000/svg",s);return Ce(e,i),e}function Ko(s,i,e){let{x:t,y:r,width:n,height:o}=s,a=i.includes("w")?0:1,l=i.includes("n")?0:1,c=[-1,1][a],d=[-1,1][l],h=[t+a*n+te*c,r+l*o+te*d-ui*e*d],f=[t+a*n+te*c,r+l*o+te*d],m=[t+a*n-ui*e*c+te*c,r+l*o+te*d];return{d:`M ${h[0]} ${h[1]} L ${f[0]} ${f[1]} L ${m[0]} ${m[1]}`,center:f}}function Yo(s,i,e){let{x:t,y:r,width:n,height:o}=s,a=["n","s"].includes(i)?.5:{w:0,e:1}[i],l=["w","e"].includes(i)?.5:{n:0,s:1}[i],c=[-1,1][a],d=[-1,1][l],h,f;["n","s"].includes(i)?(h=[t+a*n-qe*e/2,r+l*o+te*d],f=[t+a*n+qe*e/2,r+l*o+te*d]):(h=[t+a*n+te*c,r+l*o-qe*e/2],f=[t+a*n+te*c,r+l*o+qe*e/2]);let m=`M ${h[0]} ${h[1]} L ${f[0]} ${f[1]}`,p=[f[0]-(f[0]-h[0])/2,f[1]-(f[1]-h[1])/2];return{d:m,center:p}}function Jo(s){return s===""?"move":["e","w"].includes(s)?"ew-resize":["n","s"].includes(s)?"ns-resize":["nw","se"].includes(s)?"nwse-resize":"nesw-resize"}function Qo({rect:s,delta:[i,e],imageBox:t}){return St({...s,x:s.x+i,y:s.y+e},t)}function St(s,i){let{x:e}=s,{y:t}=s;return s.x<i.x?e=i.x:s.x+s.width>i.x+i.width&&(e=i.x+i.width-s.width),s.y<i.y?t=i.y:s.y+s.height>i.y+i.height&&(t=i.y+i.height-s.height),{...s,x:e,y:t}}function ea({rect:s,delta:i,aspectRatio:e,imageBox:t}){const[,r]=i;let{y:n,width:o,height:a}=s;n+=r,a-=r,e&&(o=a*e);let l=s.x+s.width/2-o/2;return n<=t.y&&(n=t.y,a=s.y+s.height-n,e&&(o=a*e,l=s.x+s.width/2-o/2)),l<=t.x&&(l=t.x,n=s.y+s.height-a),l+o>=t.x+t.width&&(l=Math.max(t.x,t.x+t.width-o),o=t.x+t.width-l,e&&(a=o/e),n=s.y+s.height-a),a<E&&(a=E,e&&(o=a*e,l=s.x+s.width/2-o/2),n=s.y+s.height-a),o<E&&(o=E,e&&(a=o/e,l=s.x+s.width/2-o/2),n=s.y+s.height-a),{x:l,y:n,width:o,height:a}}function ta({rect:s,delta:i,aspectRatio:e,imageBox:t}){const[r]=i;let{x:n,width:o,height:a}=s;n+=r,o-=r,e&&(a=o/e);let l=s.y+s.height/2-a/2;return n<=t.x&&(n=t.x,o=s.x+s.width-n,e&&(a=o/e,l=s.y+s.height/2-a/2)),l<=t.y&&(l=t.y,n=s.x+s.width-o),l+a>=t.y+t.height&&(l=Math.max(t.y,t.y+t.height-a),a=t.y+t.height-l,e&&(o=a*e),n=s.x+s.width-o),a<E&&(a=E,e&&(o=a*e),l=s.y+s.height/2-a/2,n=s.x+s.width-o),o<E&&(o=E,e&&(a=o/e),l=s.y+s.height/2-a/2,n=s.x+s.width-o),{x:n,y:l,width:o,height:a}}function ia({rect:s,delta:i,aspectRatio:e,imageBox:t}){const[,r]=i;let{y:n,width:o,height:a}=s;a+=r,e&&(o=a*e);let l=s.x+s.width/2-o/2;return n+a>=t.y+t.height&&(a=t.y+t.height-n,e&&(o=a*e),l=s.x+s.width/2-o/2),l<=t.x&&(l=t.x,n=s.y),l+o>=t.x+t.width&&(l=Math.max(t.x,t.x+t.width-o),o=t.x+t.width-l,e&&(a=o/e),n=s.y),a<E&&(a=E,e&&(o=a*e),l=s.x+s.width/2-o/2),o<E&&(o=E,e&&(a=o/e),l=s.x+s.width/2-o/2),{x:l,y:n,width:o,height:a}}function sa({rect:s,delta:i,aspectRatio:e,imageBox:t}){const[r]=i;let{x:n,width:o,height:a}=s;o+=r,e&&(a=o/e);let l=s.y+s.height/2-a/2;return n+o>=t.x+t.width&&(o=t.x+t.width-n,e&&(a=o/e),l=s.y+s.height/2-a/2),l<=t.y&&(l=t.y,n=s.x),l+a>=t.y+t.height&&(l=Math.max(t.y,t.y+t.height-a),a=t.y+t.height-l,e&&(o=a*e),n=s.x),a<E&&(a=E,e&&(o=a*e),l=s.y+s.height/2-a/2),o<E&&(o=E,e&&(a=o/e),l=s.y+s.height/2-a/2),{x:n,y:l,width:o,height:a}}function ra({rect:s,delta:i,aspectRatio:e,imageBox:t}){let[r,n]=i,{x:o,y:a,width:l,height:c}=s;return o+r<t.x&&(r=t.x-o),a+n<t.y&&(n=t.y-a),o+=r,l-=r,a+=n,c-=n,e&&Math.abs(l/c)>e?(n=l/e-c,c+=n,a-=n,a<=t.y&&(c=c-(t.y-a),l=c*e,o=s.x+s.width-l,a=t.y)):e&&(r=c*e-l,l=l+r,o-=r,o<=t.x&&(l=l-(t.x-o),c=l/e,o=t.x,a=s.y+s.height-c)),c<E&&(c=E,e&&(l=c*e),o=s.x+s.width-l,a=s.y+s.height-c),l<E&&(l=E,e&&(c=l/e),o=s.x+s.width-l,a=s.y+s.height-c),{x:o,y:a,width:l,height:c}}function na({rect:s,delta:i,aspectRatio:e,imageBox:t}){let[r,n]=i,{x:o,y:a,width:l,height:c}=s;return o+l+r>t.x+t.width&&(r=t.x+t.width-o-l),a+n<t.y&&(n=t.y-a),l+=r,a+=n,c-=n,e&&Math.abs(l/c)>e?(n=l/e-c,c+=n,a-=n,a<=t.y&&(c=c-(t.y-a),l=c*e,o=s.x,a=t.y)):e&&(r=c*e-l,l+=r,o+l>=t.x+t.width&&(l=t.x+t.width-o,c=l/e,o=t.x+t.width-l,a=s.y+s.height-c)),c<E&&(c=E,e&&(l=c*e),a=s.y+s.height-c),l<E&&(l=E,e&&(c=l/e),a=s.y+s.height-c),{x:o,y:a,width:l,height:c}}function oa({rect:s,delta:i,aspectRatio:e,imageBox:t}){let[r,n]=i,{x:o,y:a,width:l,height:c}=s;return o+r<t.x&&(r=t.x-o),a+c+n>t.y+t.height&&(n=t.y+t.height-a-c),o+=r,l-=r,c+=n,e&&Math.abs(l/c)>e?(n=l/e-c,c+=n,a+c>=t.y+t.height&&(c=t.y+t.height-a,l=c*e,o=s.x+s.width-l,a=t.y+t.height-c)):e&&(r=c*e-l,l+=r,o-=r,o<=t.x&&(l=l-(t.x-o),c=l/e,o=t.x,a=s.y)),c<E&&(c=E,e&&(l=c*e),o=s.x+s.width-l),l<E&&(l=E,e&&(c=l/e),o=s.x+s.width-l),{x:o,y:a,width:l,height:c}}function aa({rect:s,delta:i,aspectRatio:e,imageBox:t}){let[r,n]=i,{x:o,y:a,width:l,height:c}=s;return o+l+r>t.x+t.width&&(r=t.x+t.width-o-l),a+c+n>t.y+t.height&&(n=t.y+t.height-a-c),l+=r,c+=n,e&&Math.abs(l/c)>e?(n=l/e-c,c+=n,a+c>=t.y+t.height&&(c=t.y+t.height-a,l=c*e,o=s.x,a=t.y+t.height-c)):e&&(r=c*e-l,l+=r,o+l>=t.x+t.width&&(l=t.x+t.width-o,c=l/e,o=t.x+t.width-l,a=s.y)),c<E&&(c=E,e&&(l=c*e)),l<E&&(l=E,e&&(c=l/e)),{x:o,y:a,width:l,height:c}}function la({direction:s,...i}){switch(s){case"n":return ea(i);case"w":return ta(i);case"s":return ia(i);case"e":return sa(i);case"nw":return ra(i);case"ne":return na(i);case"sw":return oa(i);case"se":return aa(i);default:return i.rect}}function ca(s,[i,e]){return s.x<=i&&i<=s.x+s.width&&s.y<=e&&e<=s.y+s.height}function ua(s,i){return s.x>=i.x&&s.y>=i.y&&s.x+s.width<=i.x+i.width&&s.y+s.height<=i.y+i.height}function da(s,i){return Math.abs(s.width/s.height-i)<.1}function He({width:s,height:i},e){let t=e/90%2!==0;return{width:t?i:s,height:t?s:i}}function ha(s,i,e){const t=s/i;let r,n;t>e?(r=Math.round(i*e),n=i):(r=s,n=Math.round(s/e));const o=Math.round((s-r)/2),a=Math.round((i-n)/2);return o+r>s&&(r=s-o),a+n>i&&(n=i-a),{x:o,y:a,width:r,height:n}}function Ct(s){return{x:Math.round(s.x),y:Math.round(s.y),width:Math.round(s.width),height:Math.round(s.height)}}function $e(s,i,e){return Math.min(Math.max(s,i),e)}const Zs=s=>{if(!s)return[];const[i,e]=s.split(":").map(Number);if(!Number.isFinite(i)||!Number.isFinite(e)){console.error(`Invalid crop preset: ${s}`);return}return[{type:"aspect-ratio",width:i,height:e}]},zt="blocks",Bt="1.16.2";function fa(s){return Ms({...s,libraryName:zt,libraryVersion:Bt})}const Gi=s=>Math.floor(s/1e3),pa=(s,{threshold:i})=>{const{secureExpire:e}=s,t=Gi(Date.now()),r=Number(e),n=Gi(i);return t+n>=r};class ma{constructor(i){u(this,"_block");u(this,"_secureToken",null);this._block=i}_debugPrint(...i){this._block.debugPrint("[secure-uploads]",...i)}async getSecureToken(){const{secureSignature:i,secureExpire:e,secureUploadsSignatureResolver:t}=this._block.cfg;if((i||e)&&t&&console.warn("Both secureSignature/secureExpire and secureUploadsSignatureResolver are set. secureUploadsSignatureResolver will be used."),t){if(!this._secureToken||pa(this._secureToken,{threshold:this._block.cfg.secureUploadsExpireThreshold})){this._secureToken?this._debugPrint("Secure signature is expired. Resolving a new one..."):this._debugPrint("Secure signature is not set yet.");try{const r=await t();r?!r.secureSignature||!r.secureExpire?console.error("Secure signature resolver returned an invalid result:",r):(this._debugPrint("Secure signature resolved:",r),this._debugPrint("Secure signature will expire in",new Date(Number(r.secureExpire)*1e3).toISOString()),this._secureToken=r):(this._debugPrint("Secure signature resolver returned nothing."),this._secureToken=null)}catch(r){console.error("Secure signature resolving failed. Falling back to the previous one.",r)}}return this._secureToken}return i&&e?(this._debugPrint("Secure signature and expire are set. Using them...",{secureSignature:i,secureExpire:e}),{secureSignature:i,secureExpire:e}):null}}const Wi="[Typed State] Wrong property name: ",ga="[Typed State] Wrong property type: ";class ba{constructor(i,e){this.__typedSchema=i,this.__ctxId=e||ot.generate(),this.__schema=Object.keys(i).reduce((t,r)=>(t[r]=i[r].value,t),{}),this.__data=x.registerCtx(this.__schema,this.__ctxId)}get uid(){return this.__ctxId}setValue(i,e){if(!this.__typedSchema.hasOwnProperty(i)){console.warn(Wi+i);return}let t=this.__typedSchema[i],r=(e==null?void 0:e.constructor)===t.type,n=e instanceof t.type,o=t.nullable&&e===null;if(r||n||o){this.__data.pub(i,e);return}console.warn(ga+i)}setMultipleValues(i){for(let[e,t]of Object.entries(i))this.setValue(e,t)}getValue(i){return this.__typedSchema.hasOwnProperty(i)||console.warn(Wi+i),this.__data.read(i)}subscribe(i,e){return this.__data.sub(i,e)}remove(){x.deleteCtx(this.__ctxId)}}class _a{constructor(i){this.__typedSchema=i.typedSchema,this.__ctxId=i.ctxName||ot.generate(),this.__data=x.registerCtx({},this.__ctxId),this.__watchList=i.watchList||[],this.__subsMap=Object.create(null),this.__propertyObservers=new Set,this.__collectionObservers=new Set,this.__items=new Set,this.__removed=new Set,this.__added=new Set;let e=Object.create(null);this.__notifyObservers=(t,r)=>{this.__observeTimeout&&window.clearTimeout(this.__observeTimeout),e[t]||(e[t]=new Set),e[t].add(r),this.__observeTimeout=window.setTimeout(()=>{Object.keys(e).length!==0&&(this.__propertyObservers.forEach(n=>{n({...e})}),e=Object.create(null))})}}notify(){this.__notifyTimeout&&window.clearTimeout(this.__notifyTimeout),this.__notifyTimeout=window.setTimeout(()=>{let i=new Set(this.__added),e=new Set(this.__removed);this.__added.clear(),this.__removed.clear();for(const t of this.__collectionObservers)t==null||t([...this.__items],i,e)})}observeCollection(i){return this.__collectionObservers.add(i),this.__items.size>0&&this.notify(),()=>{this.unobserveCollection(i)}}unobserveCollection(i){var e;(e=this.__collectionObservers)==null||e.delete(i)}add(i){let e=new ba(this.__typedSchema);for(let[t,r]of Object.entries(i))e.setValue(t,r);return this.__items.add(e.uid),this.notify(),this.__data.add(e.uid,e),this.__added.add(e),this.__watchList.forEach(t=>{this.__subsMap[e.uid]||(this.__subsMap[e.uid]=[]),this.__subsMap[e.uid].push(e.subscribe(t,()=>{this.__notifyObservers(t,e.uid)}))}),e.uid}read(i){return this.__data.read(i)}readProp(i,e){let t=this.read(i);return t?t.getValue(e):(console.warn(`Item with id ${i} not found`),null)}publishProp(i,e,t){let r=this.read(i);if(!r){console.warn(`Item with id ${i} not found`);return}r.setValue(e,t)}remove(i){let e=this.read(i);e&&this.__removed.add(e),this.__items.delete(i),this.notify(),this.__data.pub(i,null),delete this.__subsMap[i]}clearAll(){this.__items.forEach(i=>{this.remove(i)})}observeProperties(i){return this.__propertyObservers.add(i),()=>{this.unobserveProperties(i)}}unobserveProperties(i){var e;(e=this.__propertyObservers)==null||e.delete(i)}findItems(i){let e=[];return this.__items.forEach(t=>{let r=this.read(t);r&&i(r)&&e.push(t)}),e}items(){return[...this.__items]}get size(){return this.__items.size}destroy(){x.deleteCtx(this.__ctxId),this.__propertyObservers=new Set,this.__collectionObservers=new Set;for(let i in this.__subsMap)this.__subsMap[i].forEach(e=>{e.remove()}),delete this.__subsMap[i]}}const T=Object.freeze({PHOTO:"photo",VIDEO:"video"}),K=Object.freeze({IDLE:"idle",SHOT:"shot",PLAY:"play",PAUSE:"pause",RESUME:"resume",STOP:"stop",RETAKE:"retake",ACCEPT:"accept"}),qi=s=>({isVideoRecordingEnabled:be(s.cameraModes).includes(T.VIDEO),isPhotoEnabled:be(s.cameraModes).includes(T.PHOTO)}),Ht=Object.freeze({FACEBOOK:"facebook",DROPBOX:"dropbox",GDRIVE:"gdrive",GPHOTOS:"gphotos",FLICKR:"flickr",VK:"vk",EVERNOTE:"evernote",BOX:"box",ONEDRIVE:"onedrive",HUDDLE:"huddle"}),Ks=Object.freeze({MOBILE_VIDEO_CAMERA:"mobile-video-camera",MOBILE_PHOTO_CAMERA:"mobile-photo-camera"}),U=Object.freeze({LOCAL:"local",DROP_AREA:"drop-area",CAMERA:"camera",EXTERNAL:"external",API:"js-api",URL:"url",DRAW:"draw",...Ks,...Ht}),va=()=>{const s=navigator.userAgent;return/Macintosh|Windows/.test(s)&&/Version\/[\d\.]+.*Safari/.test(s)&&!/Chrome|Chromium|Edg|OPR/.test(s)},ya=()=>"capture"in document.createElement("input"),wa=()=>({safariDesktop:va()}),Ca=()=>({htmlMediaCapture:ya()}),Ea=wa(),It=Ca(),$t="image/*",Xi="video/*",Aa=["image/heif","image/heif-sequence","image/heic","image/heic-sequence","image/avif","image/avif-sequence",".heif",".heifs",".heic",".heics",".avif",".avifs"],Ta=()=>Ea.safariDesktop?[$t]:[$t,...Aa],Ei=Ta(),Ys=s=>s?s.filter(i=>typeof i=="string").map(i=>le(i)).flat():[],Js=(s,i)=>i.some(e=>e.endsWith("*")?(e=e.replace("*",""),s.startsWith(e)):s===e),xa=(s,i)=>i.some(e=>e.startsWith(".")?s.toLowerCase().endsWith(e.toLowerCase()):!1),Sa=s=>{let i=s==null?void 0:s.type;return i?Js(i,Ei):!1},Ia=/[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}/i,$a=new RegExp(`^/?(${Ia.source})(?:/(-/(?:[^/]+/)+)?([^/]*))?$`,"i"),ka=({url:s,cdnBase:i})=>{const e=new URL(i),t=new URL(s);if(e.host!==t.host)return null;const[,r,n,o]=$a.exec(t.pathname);return{uuid:r,cdnUrlModifiers:n||"",filename:o||null}},Oa=s=>{const i=new Map;return(...e)=>{const t=JSON.stringify(e);if(i.has(t))return i.get(t);const r=s(...e);return i.set(t,r),r}},Zi=new Set;function Qs(s){Zi.has(s)||(Zi.add(s),console.warn(s))}function Ma(s){let i=!1;return setTimeout(()=>{i=!0},0),t=>(...r)=>(i&&Qs(s),t(...r))}function La(s){const i={progress:()=>s.$["*commonProgress"],errors:()=>s.$["*collectionErrors"],group:()=>s.$["*groupInfo"],totalCount:()=>s.uploadCollection.size,failedCount:()=>e.failedEntries.length,successCount:()=>e.successEntries.length,uploadingCount:()=>e.uploadingEntries.length,status:()=>e.isFailed?"failed":e.isUploading?"uploading":e.isSuccess?"success":"idle",isSuccess:()=>e.allEntries.length>0&&e.errors.length===0&&e.successEntries.length===e.allEntries.length,isUploading:()=>e.allEntries.some(r=>r.status==="uploading"),isFailed:()=>e.errors.length>0||e.failedEntries.length>0,allEntries:()=>s.getOutputData(),successEntries:()=>e.allEntries.filter(r=>r.status==="success"),failedEntries:()=>e.allEntries.filter(r=>r.status==="failed"),uploadingEntries:()=>e.allEntries.filter(r=>r.status==="uploading"),idleEntries:()=>e.allEntries.filter(r=>r.status==="idle")},e={},t=Ma("You're trying to access the OutputCollectionState asynchronously. In this case, the data you retrieve will be newer than it was when the OutputCollectionState was created or when the event was dispatched. If you want to retain the state at a specific moment in time, you should use the spread operator like this: `{...outputCollectionState}` or `{...e.detail}`");for(const[r,n]of Object.entries(i)){const o=r,l=Oa(t(n));Object.defineProperty(e,o,{get:l,enumerable:!0})}return e}class Pa{constructor(i){u(this,"_ctx");u(this,"addFileFromUrl",(i,{silent:e,fileName:t,source:r}={})=>{const n=this._uploadCollection.add({externalUrl:i,fileName:t??null,silent:e??!1,source:r??U.API});return this.getOutputItem(n)});u(this,"addFileFromUuid",(i,{silent:e,fileName:t,source:r}={})=>{const n=this._uploadCollection.add({uuid:i,fileName:t??null,silent:e??!1,source:r??U.API});return this.getOutputItem(n)});u(this,"addFileFromCdnUrl",(i,{silent:e,fileName:t,source:r}={})=>{const n=ka({url:i,cdnBase:this.cfg.cdnCname});if(!n)throw new Error("Invalid CDN URL");const o=this._uploadCollection.add({uuid:n.uuid,cdnUrl:i,cdnUrlModifiers:n.cdnUrlModifiers,fileName:t??n.filename??null,silent:e??!1,source:r??U.API});return this.getOutputItem(o)});u(this,"addFileFromObject",(i,{silent:e,fileName:t,source:r,fullPath:n}={})=>{const o=this._uploadCollection.add({file:i,isImage:Sa(i),mimeType:i.type,fileName:t??i.name,fileSize:i.size,silent:e??!1,source:r??U.API,fullPath:n??null});return this.getOutputItem(o)});u(this,"removeFileByInternalId",i=>{if(!this._uploadCollection.read(i))throw new Error(`File with internalId ${i} not found`);this._uploadCollection.remove(i)});u(this,"uploadAll",()=>{const i=this._uploadCollection.items().filter(e=>{const t=this._uploadCollection.read(e);return t?!t.getValue("isRemoved")&&!t.getValue("isUploading")&&!t.getValue("fileInfo"):!1});i.length!==0&&(this._ctx.$["*uploadTrigger"]=new Set(i),this._ctx.emit(k.COMMON_UPLOAD_START,this.getOutputCollectionState()))});u(this,"openSystemDialog",(i={})=>{const e=it(Ys([this.cfg.accept??"",...this.cfg.imgOnly?Ei:[]])),t="uploadcare-file-input",r=document.createElement("input");if(r.setAttribute(t,""),mi(r,{opacity:0,height:0,width:0,visibility:"hidden"}),r.type="file",r.multiple=this.cfg.multiple,i.captureCamera){r.capture=this.cfg.cameraCapture;const{isPhotoEnabled:n,isVideoRecordingEnabled:o}=qi(this.cfg);i.modeCamera===T.PHOTO&&n?r.accept=$t:i.modeCamera===T.VIDEO&&o?r.accept=Xi:r.accept=[$t,o&&Xi].filter(Boolean).join(",")}else r.accept=e;r.addEventListener("change",()=>{r.files&&([...r.files].forEach(n=>this.addFileFromObject(n,{source:i.captureCamera?U.CAMERA:U.LOCAL})),this._ctx.modalManager.open(g.activities.UPLOAD_LIST),this._ctx.$["*currentActivity"]=g.activities.UPLOAD_LIST,r.remove())},{once:!0}),document.querySelectorAll(`[${t}]`).forEach(n=>n.remove()),document.body.appendChild(r),r.dispatchEvent(new MouseEvent("click"))});u(this,"getOutputItem",i=>{const e=x.getCtx(i).store,t=e.fileInfo;let r=e.isRemoved?"removed":e.errors.length>0?"failed":e.fileInfo?"success":e.isUploading?"uploading":"idle";return{uuid:(t==null?void 0:t.uuid)??e.uuid??null,internalId:i,name:(t==null?void 0:t.originalFilename)??e.fileName,size:(t==null?void 0:t.size)??e.fileSize,isImage:(t==null?void 0:t.isImage)??e.isImage,mimeType:(t==null?void 0:t.mimeType)??e.mimeType,file:e.file,externalUrl:e.externalUrl,cdnUrlModifiers:e.cdnUrlModifiers,cdnUrl:e.cdnUrl??(t==null?void 0:t.cdnUrl)??null,fullPath:e.fullPath,uploadProgress:e.uploadProgress,fileInfo:t??null,metadata:e.metadata??(t==null?void 0:t.metadata)??null,isSuccess:r==="success",isUploading:r==="uploading",isFailed:r==="failed",isRemoved:r==="removed",errors:e.errors,status:r,source:e==null?void 0:e.source}});u(this,"getOutputCollectionState",()=>La(this._ctx));u(this,"initFlow",(i=!1)=>{var e,t,r,n;if(this._uploadCollection.size>0&&!i)(e=this._ctx.modalManager)==null||e.open(g.activities.UPLOAD_LIST),this._ctx.set$({"*currentActivity":g.activities.UPLOAD_LIST});else if(((t=this._sourceList)==null?void 0:t.length)===1){const o=this._sourceList[0];if(o==="local"){this._ctx.$["*currentActivity"]=g.activities.UPLOAD_LIST,this.openSystemDialog();return}if(o==="camera"&&It.htmlMediaCapture){const{isPhotoEnabled:d,isVideoRecordingEnabled:h}=qi(this.cfg);if(d&&h){this._ctx.set$({"*currentActivity":g.activities.START_FROM});return}else if(d||h){this.openSystemDialog({captureCamera:!0,modeCamera:d?T.PHOTO:T.VIDEO});return}else this.openSystemDialog({captureCamera:!0,modeCamera:T.PHOTO})}const a=this._ctx.$["*blocksRegistry"],l=d=>"type"in d&&d.type===o,c=[...a].find(l);c==null||c.activate(),this._ctx.$["*currentActivity"]&&((r=this._ctx.modalManager)==null||r.open(this._ctx.$["*currentActivity"]))}else(n=this._ctx.modalManager)==null||n.open(g.activities.START_FROM),this._ctx.set$({"*currentActivity":g.activities.START_FROM})});u(this,"doneFlow",()=>{this._ctx.set$({"*currentActivity":this._ctx.doneActivity,"*history":this._ctx.doneActivity?[this._ctx.doneActivity]:[]}),this._ctx.$["*currentActivity"]||this._ctx.modalManager.closeAll()});u(this,"setCurrentActivity",(i,e=void 0)=>{if(this._ctx.hasBlockInCtx(t=>t.activityType===i)){this._ctx.set$({"*currentActivityParams":e??{},"*currentActivity":i});return}console.warn(`Activity type "${i}" not found in the context`)});u(this,"getCurrentActivity",()=>this._ctx.$["*currentActivity"]);u(this,"setModalState",i=>{var e,t;if(i&&!this._ctx.$["*currentActivity"]){console.warn(`Can't open modal without current activity. Please use "setCurrentActivity" method first.`);return}i?(e=this._ctx.modalManager)==null||e.open(this._ctx.$["*currentActivity"]):((t=this._ctx.modalManager)==null||t.close(this._ctx.$["*currentActivity"]),this._ctx.$["*currentActivity"]=null)});this._ctx=i}get _uploadCollection(){return this._ctx.uploadCollection}get cfg(){return this._ctx.cfg}get l10n(){return this._ctx.l10n.bind(this._ctx)}removeAllFiles(){this._uploadCollection.clearAll()}get _sourceList(){let i=[];return this.cfg.sourceList&&(i=le(this.cfg.sourceList)),i}}const Ua=(s,i)=>{const e=i.cfg.imgOnly,t=s.isImage;if(!(!e||t)&&!(!s.fileInfo&&s.externalUrl)&&!(!s.fileInfo&&!s.mimeType))return{type:"NOT_AN_IMAGE",message:i.l10n("images-only-accepted"),payload:{entry:s}}},Ra=(s,i)=>{const e=i.cfg.imgOnly,t=i.cfg.accept,r=Ys([...e?Ei:[],t]);if(!r.length)return;const n=s.mimeType,o=s.name;if(!n||!o)return;const a=Js(n,r),l=xa(o,r);if(!a&&!l)return{type:"FORBIDDEN_FILE_TYPE",message:i.l10n("file-type-not-allowed"),payload:{entry:s}}},ee=1e3,we=Object.freeze({AUTO:"auto",BYTE:"byte",KB:"kb",MB:"mb",GB:"gb",TB:"tb",PB:"pb"}),je=s=>Math.ceil(s*100)/100,Da=(s,i=we.AUTO)=>{const e=i===we.AUTO;if(i===we.BYTE||e&&s<ee**1){const t=ks("en-US",s),r={one:"byte",other:"bytes"}[t];return`${s} ${r}`}return i===we.KB||e&&s<ee**2?`${je(s/ee**1)} KB`:i===we.MB||e&&s<ee**3?`${je(s/ee**2)} MB`:i===we.GB||e&&s<ee**4?`${je(s/ee**3)} GB`:i===we.TB||e&&s<ee**5?`${je(s/ee**4)} TB`:`${je(s/ee**5)} PB`},Fa=(s,i)=>{const e=i.cfg.maxLocalFileSizeBytes,t=s.size;if(e&&t&&t>e)return{type:"FILE_SIZE_EXCEEDED",message:i.l10n("files-max-size-limit-error",{maxFileSize:Da(e)}),payload:{entry:s}}},Va=(s,i)=>{const{internalId:e}=s,t=i._uploadCollection.read(e),r=t==null?void 0:t.getValue("uploadError");if(!r)return;if(r instanceof N)return{type:"UPLOAD_ERROR",message:r.message,payload:{entry:s,error:r}};if(r instanceof lt)return{type:"NETWORK_ERROR",message:r.message,payload:{entry:s,error:r}};const n=r instanceof Error?r:new Error("Unknown error",{cause:r});return{type:"UNKNOWN_ERROR",message:n.message,payload:{entry:s,error:n}}},Na=(s,i)=>{if(s.failedCount>0)return{type:"SOME_FILES_HAS_ERRORS",message:i.l10n("some-files-were-not-uploaded")}},za=(s,i)=>{const e=s.totalCount,t=i.cfg.multiple?i.cfg.multipleMin:0,r=i.cfg.multiple?i.cfg.multipleMax:1;if(t&&e<t)return{type:"TOO_FEW_FILES",message:i.l10n("files-count-limit-error-too-few",{min:t,max:r,total:e}),payload:{total:e,min:t,max:r}};if(r&&e>r)return{type:"TOO_MANY_FILES",message:i.l10n("files-count-limit-error-too-many",{min:t,max:r,total:e}),payload:{total:e,min:t,max:r}}},pt={file:"File validator execution has failed",collection:"Collection validator execution has failed",message:"Missing message. We recommend adding message: value."};class Ba{constructor(i){u(this,"_blockInstance");u(this,"_fileValidators",[Ua,Ra,Fa,Va]);u(this,"_collectionValidators",[za,Na]);this._blockInstance=i,this._uploadCollection=this._blockInstance.uploadCollection;const e=()=>{this.runFileValidators(),this.runCollectionValidators()};this._blockInstance.subConfigValue("maxLocalFileSizeBytes",e),this._blockInstance.subConfigValue("multipleMin",e),this._blockInstance.subConfigValue("multipleMax",e),this._blockInstance.subConfigValue("multiple",e),this._blockInstance.subConfigValue("imgOnly",e),this._blockInstance.subConfigValue("accept",e)}runFileValidators(i){const e=i??this._uploadCollection.items();for(const t of e){const r=this._uploadCollection.read(t);r&&this._runFileValidatorsForEntry(r)}}runCollectionValidators(){const i=this._blockInstance.api.getOutputCollectionState(),e=[];for(const t of[...this._collectionValidators,...this._addCustomTypeToValidators(this._blockInstance.cfg.collectionValidators)])try{const r=t(i,this._blockInstance.api);if(!r)continue;r&&(e.push(r),r.message||console.warn(pt.message))}catch(r){console.warn(pt.collection,r)}this._blockInstance.$["*collectionErrors"]=e,e.length>0&&this._blockInstance.emit(k.COMMON_UPLOAD_FAILED,()=>this._blockInstance.api.getOutputCollectionState(),{debounce:!0})}_runFileValidatorsForEntry(i){const e=this._blockInstance.api.getOutputItem(i.uid),t=[];for(const r of[...this._fileValidators,...this._addCustomTypeToValidators(this._blockInstance.cfg.fileValidators)])try{const n=r(e,this._blockInstance.api);if(!n)continue;n&&(t.push(n),n.message||console.warn(pt.message))}catch(n){console.warn(pt.file,n)}i.setValue("errors",t)}_addCustomTypeToValidators(i){return i.map(e=>(...t)=>{const r=e(...t);return r?{...r,type:"CUSTOM_ERROR"}:void 0})}}const Ha=Object.freeze({file:Object.freeze({type:File,value:null,nullable:!0}),externalUrl:Object.freeze({type:String,value:null,nullable:!0}),fileName:Object.freeze({type:String,value:null,nullable:!0}),fileSize:Object.freeze({type:Number,value:null,nullable:!0}),lastModified:Object.freeze({type:Number,value:Date.now()}),uploadProgress:Object.freeze({type:Number,value:0}),uuid:Object.freeze({type:String,value:null,nullable:!0}),isImage:Object.freeze({type:Boolean,value:!1}),mimeType:Object.freeze({type:String,value:null,nullable:!0}),ctxName:Object.freeze({type:String,value:null,nullable:!0}),cdnUrl:Object.freeze({type:String,value:null,nullable:!0}),cdnUrlModifiers:Object.freeze({type:String,value:null,nullable:!0}),fileInfo:Object.freeze({type:Fe,value:null,nullable:!0}),isUploading:Object.freeze({type:Boolean,value:!1}),abortController:Object.freeze({type:AbortController,value:null,nullable:!0}),thumbUrl:Object.freeze({type:String,value:null,nullable:!0}),silent:Object.freeze({type:Boolean,value:!1}),source:Object.freeze({type:String,value:null,nullable:!0}),fullPath:Object.freeze({type:String,value:null,nullable:!0}),metadata:Object.freeze({type:Object,value:null,nullable:!0}),errors:Object.freeze({type:Array,value:[]}),uploadError:Object.freeze({type:Error,value:null,nullable:!0}),isRemoved:Object.freeze({type:Boolean,value:!1}),isQueued:Object.freeze({type:Boolean,value:!1})});class R extends g{constructor(){super(...arguments);u(this,"couldBeCtxOwner",!1);u(this,"isCtxOwner",!1);u(this,"init$",Gs(this));u(this,"_flushOutputItems",H(async()=>{if(this.getOutputData().length!==this.uploadCollection.size)return;const t=this.api.getOutputCollectionState();this.$["*collectionState"]=t,this.emit(k.CHANGE,()=>this.api.getOutputCollectionState(),{debounce:!0}),this.cfg.groupOutput&&t.totalCount>0&&t.status==="success"&&this._createGroup(t)},300));u(this,"_handleCollectionUpdate",(e,t,r)=>{var n;(t.size||r.size)&&(this.$["*groupInfo"]=null),this.validationManager.runFileValidators(),this.validationManager.runCollectionValidators();for(const o of t)o.getValue("silent")||this.emit(k.FILE_ADDED,this.api.getOutputItem(o.uid));for(const o of r){this.$["*uploadTrigger"].delete(o.uid),(n=o.getValue("abortController"))==null||n.abort(),o.setMultipleValues({isRemoved:!0,abortController:null,isUploading:!1,uploadProgress:0});const a=o==null?void 0:o.getValue("thumbUrl");a&&URL.revokeObjectURL(a),this.emit(k.FILE_REMOVED,this.api.getOutputItem(o.uid))}this.$["*uploadList"]=e.map(o=>({uid:o})),this._flushCommonUploadProgress(),this._flushOutputItems()});u(this,"_handleCollectionPropertiesUpdate",e=>{this._flushOutputItems();const t=this.uploadCollection,r=[...new Set(Object.entries(e).filter(([n])=>["uploadError","fileInfo"].includes(n)).map(([,n])=>[...n]).flat())];if(r.length>0&&setTimeout(()=>{this.validationManager.runFileValidators(r)}),e.uploadProgress){for(const n of e.uploadProgress){const{isUploading:o,silent:a}=x.getCtx(n).store;o&&!a&&this.emit(k.FILE_UPLOAD_PROGRESS,this.api.getOutputItem(n))}this._flushCommonUploadProgress()}if(e.isUploading)for(const n of e.isUploading){const{isUploading:o,silent:a}=x.getCtx(n).store;o&&!a&&this.emit(k.FILE_UPLOAD_START,this.api.getOutputItem(n))}if(e.fileInfo){for(const n of e.fileInfo){const{fileInfo:o,silent:a}=x.getCtx(n).store;o&&!a&&this.emit(k.FILE_UPLOAD_SUCCESS,this.api.getOutputItem(n))}this.cfg.cropPreset&&this.setInitialCrop(),this.cfg.cloudImageEditorAutoOpen&&this.openCloudImageEditor()}if(e.errors){for(const a of e.errors){const{errors:l}=x.getCtx(a).store;l.length>0&&(this.emit(k.FILE_UPLOAD_FAILED,this.api.getOutputItem(a)),this.emit(k.COMMON_UPLOAD_FAILED,()=>this.api.getOutputCollectionState(),{debounce:!0}))}const n=t.findItems(a=>!!a.getValue("fileInfo")),o=t.findItems(a=>a.getValue("errors").length>0);t.size>0&&o.length===0&&t.size===n.length&&this.$["*collectionErrors"].length===0&&this.emit(k.COMMON_UPLOAD_SUCCESS,this.api.getOutputCollectionState())}e.cdnUrl&&([...e.cdnUrl].filter(o=>{var a;return!!((a=this.uploadCollection.read(o))!=null&&a.getValue("cdnUrl"))}).forEach(o=>{this.emit(k.FILE_URL_CHANGED,this.api.getOutputItem(o))}),this.$["*groupInfo"]=null)});u(this,"_flushCommonUploadProgress",()=>{let e=0;const r=[...this.$["*uploadTrigger"]].filter(o=>!!this.uploadCollection.read(o));r.forEach(o=>{const a=this.uploadCollection.readProp(o,"uploadProgress");typeof a=="number"&&(e+=a)});const n=r.length?Math.round(e/r.length):0;this.$["*commonProgress"]!==n&&(this.$["*commonProgress"]=n,this.emit(k.COMMON_UPLOAD_PROGRESS,this.api.getOutputCollectionState()))})}get hasCtxOwner(){return this.hasBlockInCtx(e=>e instanceof R?e.isCtxOwner&&e.isConnected&&e!==this:!1)}initCallback(){if(super.initCallback(),!this.has("*uploadCollection")){let e=new _a({typedSchema:Ha,watchList:["uploadProgress","uploadError","fileInfo","errors","cdnUrl","isUploading"]});this.add("*uploadCollection",e)}this.has("*publicApi")||this.add("*publicApi",new Pa(this)),this.has("*validationManager")||this.add("*validationManager",new Ba(this)),!this.hasCtxOwner&&this.couldBeCtxOwner&&this.initCtxOwner()}get validationManager(){if(!this.has("*validationManager"))throw new Error("Unexpected error: ValidationManager is not initialized");return this.$["*validationManager"]}get api(){if(!this.has("*publicApi"))throw new Error("Unexpected error: UploaderPublicApi is not initialized");return this.$["*publicApi"]}getAPI(){return this.api}get uploadCollection(){if(!this.has("*uploadCollection"))throw new Error("Unexpected error: TypedCollection is not initialized");return this.$["*uploadCollection"]}destroyCtxCallback(){var e,t;(e=this._unobserveCollectionProperties)==null||e.call(this),(t=this._unobserveCollection)==null||t.call(this),this.uploadCollection.destroy(),this.$["*uploadCollection"]=null,super.destroyCtxCallback()}initCtxOwner(){this.isCtxOwner=!0,this._unobserveCollection=this.uploadCollection.observeCollection(this._handleCollectionUpdate),this._unobserveCollectionProperties=this.uploadCollection.observeProperties(this._handleCollectionPropertiesUpdate),this.subConfigValue("maxConcurrentRequests",e=>{this.$["*uploadQueue"].concurrency=Number(e)||1}),this.$["*secureUploadsManager"]||(this.$["*secureUploadsManager"]=new ma(this))}async _createGroup(e){const t=await this.getUploadClientOptions(),r=e.allEntries.map(l=>l.uuid+(l.cdnUrlModifiers?`/${l.cdnUrlModifiers}`:"")),n=new AbortController,o=await So(r,{...t,signal:n.signal});if(this.$["*collectionState"]!==e){n.abort();return}this.$["*groupInfo"]=o;const a=this.api.getOutputCollectionState();this.emit(k.GROUP_CREATED,a),this.emit(k.CHANGE,()=>this.api.getOutputCollectionState(),{debounce:!0}),this.$["*collectionState"]=a}openCloudImageEditor(){const[e]=this.uploadCollection.findItems(t=>!!t.getValue("fileInfo")&&t.getValue("isImage")).map(t=>this.uploadCollection.read(t));e&&this.uploadCollection.size===1&&this.cfg.useCloudImageEditor&&this.hasBlockInCtx(t=>t.activityType===g.activities.CLOUD_IMG_EDIT)&&(this.$["*currentActivityParams"]={internalId:e.uid},this.$["*currentActivity"]=g.activities.CLOUD_IMG_EDIT,this.modalManager.open(g.activities.CLOUD_IMG_EDIT))}setInitialCrop(){const e=Zs(this.cfg.cropPreset);if(e){const[t]=e,r=this.uploadCollection.findItems(n=>{var o;return!!n.getValue("fileInfo")&&n.getValue("isImage")&&!((o=n.getValue("cdnUrlModifiers"))!=null&&o.includes("/crop/"))}).map(n=>this.uploadCollection.read(n)).filter(Boolean);for(const n of r){const o=n.getValue("fileInfo");if(!o||!o.imageInfo){console.warn("Failed to get image info for entry",n.uid);continue}const{width:a,height:l}=o.imageInfo,c=t.width/t.height,d=ha(a,l,c),h=ge(`crop/${d.width}x${d.height}/${d.x},${d.y}`,"preview"),f=n.getValue("cdnUrl");if(!f){console.warn("Failed to get cdnUrl for entry",n.uid);continue}n.setMultipleValues({cdnUrlModifiers:h,cdnUrl:X(f,h)}),this.uploadCollection.size===1&&this.cfg.useCloudImageEditor&&this.hasBlockInCtx(m=>m.activityType===g.activities.CLOUD_IMG_EDIT)&&(this.$["*currentActivityParams"]={internalId:n.uid},this.$["*currentActivity"]=g.activities.CLOUD_IMG_EDIT,this.modalManager.open(g.activities.CLOUD_IMG_EDIT))}}}async getMetadataFor(e){const t=this.cfg.metadata||void 0;if(typeof t=="function"){const r=this.api.getOutputItem(e);return await t(r)}return t}async getUploadClientOptions(){const t=await this.$["*secureUploadsManager"].getSecureToken().catch(()=>null);return{store:this.cfg.store,publicKey:this.cfg.pubkey,baseCDN:this.cfg.cdnCname,baseURL:this.cfg.baseUrl,userAgent:fa,integration:this.cfg.userAgentIntegration,secureSignature:t==null?void 0:t.secureSignature,secureExpire:t==null?void 0:t.secureExpire,retryThrottledRequestMaxTimes:this.cfg.retryThrottledRequestMaxTimes,multipartMinFileSize:this.cfg.multipartMinFileSize,multipartChunkSize:this.cfg.multipartChunkSize,maxConcurrentRequests:this.cfg.multipartMaxConcurrentRequests,multipartMaxAttempts:this.cfg.multipartMaxAttempts,checkForUrlDuplicates:!!this.cfg.checkForUrlDuplicates,saveUrlForRecurrentUploads:!!this.cfg.saveUrlForRecurrentUploads}}getOutputData(){return this.uploadCollection.items().map(r=>this.api.getOutputItem(r))}}R.extSrcList=Object.freeze({...Ht});R.sourceTypes=Object.freeze({...U});const jt=s=>{var i;return(i=s.match(/[A-Z]{2,}(?=[A-Z][a-z]+[0-9]*|\b)|[A-Z]?[a-z]+[0-9]*|[A-Z]|[0-9]+/g))==null?void 0:i.map(e=>e.toLowerCase()).join("-")},$=s=>String(s),W=s=>{const i=Number(s);if(Number.isNaN(i))throw new Error(`Invalid number: "${s}"`);return i},S=s=>{if(typeof s>"u"||s===null)return!1;if(typeof s=="boolean")return s;if(s==="true"||s==="")return!0;if(s==="false")return!1;throw new Error(`Invalid boolean: "${s}"`)},ja=s=>s==="auto"?s:S(s),Ga=s=>{const i=$(s);if(i!=="user"&&i!=="environment"&&i!=="")throw new Error(`Invalid value: "${i}"`);return i},Wa=s=>{const i=$(s);if(!Object.values(T).includes(i))throw new Error(`Invalid value: "${i}"`);return i},qa=s=>{const i=$(s),e=be(i);if(e.some(t=>!Object.values(T).includes(t)))throw new Error(`Invalid value: "${JSON.stringify(e)}"`);return i},Xa=s=>{if(typeof s=="object"&&!Array.isArray(s)||typeof s=="function")return s;throw new Error("Invalid metadata value. Must be an object or function.")},Ki=s=>{if(typeof s=="object")return s;throw new Error("Invalid value. Must be an object.")},Qt=s=>{if(typeof s=="function")return s;throw new Error("Invalid value. Must be a function.")},Yi=s=>{if(Array.isArray(s))return s;throw new Error("Must be an array.")},Za=s=>{const i=$(s);if(["grid","list"].includes(i))return i;throw new Error(`Invalid value: "${i}"`)},Ka={pubkey:$,multiple:S,multipleMin:W,multipleMax:W,confirmUpload:S,imgOnly:S,accept:$,externalSourcesPreferredTypes:$,externalSourcesEmbedCss:$,store:ja,cameraMirror:S,cameraCapture:Ga,sourceList:$,maxLocalFileSizeBytes:W,thumbSize:W,showEmptyList:S,useLocalImageEditor:S,useCloudImageEditor:S,cloudImageEditorTabs:$,removeCopyright:S,cropPreset:$,imageShrink:$,modalScrollLock:S,modalBackdropStrokes:S,sourceListWrap:S,remoteTabSessionKey:$,cdnCname:$,baseUrl:$,socialBaseUrl:$,secureSignature:$,secureExpire:$,secureDeliveryProxy:$,retryThrottledRequestMaxTimes:W,multipartMinFileSize:W,multipartChunkSize:W,maxConcurrentRequests:W,multipartMaxConcurrentRequests:W,multipartMaxAttempts:W,checkForUrlDuplicates:S,saveUrlForRecurrentUploads:S,groupOutput:S,userAgentIntegration:$,debug:S,localeName:$,metadata:Xa,secureUploadsExpireThreshold:W,localeDefinitionOverride:Ki,secureUploadsSignatureResolver:Qt,secureDeliveryProxyUrlResolver:Qt,iconHrefResolver:Qt,fileValidators:Yi,collectionValidators:Yi,cameraModes:qa,defaultCameraMode:Wa,enableAudioRecording:S,enableVideoRecording:S,mediaRecorderOptions:Ki,maxVideoRecordingDuration:W,filesViewMode:Za,gridShowFileNames:S,cloudImageEditorAutoOpen:S,cloudImageEditorMaskHref:$},Ya=(s,i)=>{if(!(typeof i>"u"||i===null))try{return Ka[s](i)}catch(e){return console.error(`Invalid value for config key "${s}".`,e),pe[s]}},Ja=[{test:s=>s.accept&&!!s.imgOnly,message:"There could be a mistake.\nBoth `accept` and `imgOnly` parameters are set.\nThe value of `accept` will be concatenated with the internal image mime types list."},{test:s=>s.enableVideoRecording!==null,message:"The `enableVideoRecording` parameter is deprecated and will be removed in the next major release.\nPlease use the `cameraModes` parameter instead."},{test:s=>s.defaultCameraMode!==null,message:"The `defaultCameraMode` parameter is deprecated and will be removed in the next major release.\nPlease use the `cameraModes` parameter instead."}],Qa=H(s=>{for(const{test:i,message:e}of Ja)i(s)&&Qs(e)},0),el=({key:s,value:i,setValue:e,getValue:t})=>{if(s==="enableVideoRecording"&&i!==null){let r=be(t("cameraModes"));i&&!r.includes("video")?r=r.concat("video"):i||(r=r.filter(n=>n!=="video")),e("cameraModes",it(r))}if(s==="defaultCameraMode"&&i!==null){let r=be(t("cameraModes"));r=r.sort((n,o)=>n===i?-1:o===i?1:0),e("cameraModes",it(r))}},Ai=[...new Set(["debug",...Object.keys(pe)])],tl=["metadata","localeDefinitionOverride","secureUploadsSignatureResolver","secureDeliveryProxyUrlResolver","iconHrefResolver","fileValidators","collectionValidators","mediaRecorderOptions"],il=s=>tl.includes(s),Le=Ai.filter(s=>!il(s)),sl={...Object.fromEntries(Le.map(s=>[jt(s),s])),...Object.fromEntries(Le.map(s=>[s.toLowerCase(),s]))},rl={...Object.fromEntries(Le.map(s=>[jt(s),B(s)])),...Object.fromEntries(Le.map(s=>[s.toLowerCase(),B(s)]))},Ji=s=>"__"+s;class Ti extends I{constructor(){super();u(this,"requireCtxName",!0);this.init$={...this.init$,...Object.fromEntries(Object.entries(pe).map(([e,t])=>[B(e),t]))}}_flushValueToAttribute(e,t){if(Le.includes(e)){const r=[...new Set([jt(e),e.toLowerCase()])];for(const n of r)typeof t>"u"||t===null?this.removeAttribute(n):this.getAttribute(n)!==t.toString()&&this.setAttribute(n,t.toString())}}_flushValueToState(e,t){this.$[B(e)]!==t&&(typeof t>"u"||t===null?this.$[B(e)]=pe[e]:this.$[B(e)]=t)}_setValue(e,t){const r=this,n=Ya(e,t),o=Ji(e);r[o]!==n&&(this._assertSameValueDifferentReference(e,r[o],n),r[o]=n,this._flushValueToAttribute(e,n),this._flushValueToState(e,n),this.debugPrint(`[uc-config] "${e}"`,n),Qa(this.cfg),el({key:e,value:n??null,setValue:this._setValue.bind(this),getValue:this._getValue.bind(this)}))}_getValue(e){const t=this,r=Ji(e);return t[r]??this.$[B(e)]}_assertSameValueDifferentReference(e,t,r){this.cfg.debug&&r!==t&&typeof r=="object"&&typeof t=="object"&&JSON.stringify(r)===JSON.stringify(t)&&(console.warn(`[uc-config] Option "${e}" value is the same as the previous one but the reference is different`),console.warn("[uc-config] You should avoid changing the reference of the object to prevent unnecessary calculations"),console.warn(`[uc-config] "${e}" previous value:`,t),console.warn(`[uc-config] "${e}" new value:`,r))}initCallback(){super.initCallback();const e=this;for(const t of Le)this.sub(B(t),r=>{this._setValue(t,r)},!1);for(const t of Ai){const r=e[t]??this.$[B(t)];r!==pe[t]&&this._setValue(t,r),Object.defineProperty(this,t,{set:n=>{this._setValue(t,n)},get:()=>this._getValue(t)})}}attributeChangedCallback(e,t,r){if(t===r)return;const n=this,o=sl[e];n[o]=r}}Ti.bindAttributes(rl);for(const s of Ai)Ti.prototype[s]=void 0;const er=Ti;class xi extends I{constructor(){super(),this.init$={...this.init$,name:"",href:""}}initCallback(){super.initCallback(),this.sub("name",i=>{if(!i)return;let e=`#uc-icon-${i}`;this.subConfigValue("iconHrefResolver",t=>{t&&(e=t(i)??e),this.$.href=e})}),this.setAttribute("aria-hidden","true")}}xi.template=`
  <svg ref="svg" xmlns="http://www.w3.org/2000/svg">
    <use set="@href: href;"></use>
  </svg>
`;xi.bindAttributes({name:"name"});const nl=s=>[...new Set(s)],ol=s=>Object.entries(s).filter(([i,e])=>e!==void 0&&e!=="").map(([i,e])=>i==="cdn-operations"||i==="analytics"?e:`${i}/${e}`),al="https://ucarecdn.com",kt=Object.freeze({"dev-mode":{},pubkey:{},uuid:{},src:{},lazy:{default:1},intersection:{},breakpoints:{},"cdn-cname":{default:al},"proxy-cname":{},"secure-delivery-proxy":{},"hi-res-support":{default:1},"ultra-res-support":{},format:{},"cdn-operations":{},progressive:{},quality:{},"is-background-for":{},"is-preview-blur":{default:1}}),Xe="--uc-img-",Qi="unresolved",mt=2,gt=3,es=!window.location.host.trim()||window.location.host.includes(":")||window.location.hostname.includes("localhost"),ts=3e3,is=5e3,ss=Object.freeze({PREVIEW:"PREVIEW",MAIN:"MAIN"}),tr=Object.create(null);var gs;for(let s in kt)tr[Xe+s]=((gs=kt[s])==null?void 0:gs.default)||"";class ll extends at{constructor(){super(...arguments);u(this,"cssInit$",tr)}$$(e){return this.$[Xe+e]}set$$(e){for(let t in e)this.$[Xe+t]=e[t]}sub$$(e,t){this.sub(Xe+e,r=>{r===null||r===""||t(r)})}analyticsParams(){return`-/@clib/${zt}/${Bt}/uc-img/`}initAttributes(e){[...this.attributes].forEach(t=>{kt[t.name]||e.setAttribute(t.name,t.value)})}initIntersection(e,t){let r={root:null,rootMargin:"0px"};this._isnObserver=new IntersectionObserver(n=>{n.forEach(o=>{o.isIntersecting&&(t(),this._isnObserver.unobserve(e))})},r),this._isnObserver.observe(e),this._observed||(this._observed=new Set),this._observed.add(e)}destroyCallback(){super.destroyCallback(),this._isnObserver&&(this._observed.forEach(e=>{this._isnObserver.unobserve(e)}),this._isnObserver=null),x.deleteCtx(this)}static get observedAttributes(){return Object.keys(kt)}attributeChangedCallback(e,t,r){window.setTimeout(()=>{this.$[Xe+e]=r})}}class cl extends ll{constructor(){super(...arguments);u(this,"_img",new Image);u(this,"_imgPreview",new Image)}_fmtAbs(e){return!e.includes("//")&&!es&&(e=new URL(e,document.baseURI).href),e}_validateSize(e){if((e==null?void 0:e.trim())!==""){let t=e.match(/\d+/)[0],r=e.match(/[a-zA-Z]+/)[0];const n=parseInt(t,10);if(Number(n)>is&&this.hasFormatJPG)return is+r;if(Number(n)>ts&&!this.hasFormatJPG)return ts+r}return e}_getCdnModifiers(e,t){const r={format:this.$$("format"),quality:this.$$("quality"),resize:this._validateSize(e),blur:t,"cdn-operations":this.$$("cdn-operations"),analytics:this.analyticsParams()};return ge(...ol(r))}_getUrlBase(e="",t=""){if(this.$$("src").startsWith("data:")||this.$$("src").startsWith("blob:"))return this.$$("src");if(es&&this.$$("src")&&!this.$$("src").includes("//"))return this._proxyUrl(this.$$("src"));let r=this._getCdnModifiers(e,t);if(this.$$("src").startsWith(this.$$("cdn-cname")))return X(this.$$("src"),r);if(this.$$("cdn-cname")&&this.$$("uuid"))return this._proxyUrl(X(tt(this.$$("cdn-cname"),this.$$("uuid")),r));if(this.$$("uuid"))return this._proxyUrl(X(tt(this.$$("cdn-cname"),this.$$("uuid")),r));if(this.$$("proxy-cname"))return this._proxyUrl(X(this.$$("proxy-cname"),r,this._fmtAbs(this.$$("src"))));if(this.$$("pubkey"))return this._proxyUrl(X(`https://${this.$$("pubkey")}.ucr.io/`,r,this._fmtAbs(this.$$("src"))))}_proxyUrl(e){return this.$$("secure-delivery-proxy")?ai(this.$$("secure-delivery-proxy"),{previewUrl:e},{transform:r=>window.encodeURIComponent(r)}):e}_getElSize(e,t=1,r=!0){let n=e.getBoundingClientRect(),o=t*Math.round(n.width),a=r?"":t*Math.round(n.height);return o||a?`${o||""}x${a||""}`:null}_setupEventProxy(e){let t=n=>{n.stopPropagation();let o=new Event(n.type,n);this.dispatchEvent(o)},r=["load","error"];for(let n of r)e.addEventListener(n,t)}get img(){return this.hasPreviewImage||(this._setupConfigForImage({elNode:this._img}),this.appendChild(this._img)),this._img}get currentImg(){return this.hasPreviewImage?{type:ss.PREVIEW,img:this._imgPreview}:{type:ss.MAIN,img:this.img}}get hasPreviewImage(){return this.$$("is-preview-blur")}get bgSelector(){return this.$$("is-background-for")}get breakpoints(){if(this.$$("breakpoints")){const e=le(this.$$("breakpoints"));return nl(e.map(t=>parseInt(t,10)))}else return null}get hasFormatJPG(){return this.$$("format").toLowerCase()==="jpeg"}renderBg(e){let t=new Set;t.add(`url("${this._getUrlBase(this._getElSize(e))}") 1x`),this.$$("hi-res-support")&&t.add(`url("${this._getUrlBase(this._getElSize(e,mt))}") ${mt}x`),this.$$("ultra-res-support")&&t.add(`url("${this._getUrlBase(this._getElSize(e,gt))}") ${gt}x`);let r=`image-set(${[...t].join(", ")})`;e.style.setProperty("background-image",r),e.style.setProperty("background-image","-webkit-"+r)}getSrcset(){let e=new Set;return this.breakpoints?this.breakpoints.forEach(t=>{e.add(this._getUrlBase(t+"x")+` ${this._validateSize(t+"w")}`),this.$$("hi-res-support")&&e.add(this._getUrlBase(t*mt+"x")+` ${this._validateSize(t*mt+"w")}`),this.$$("ultra-res-support")&&e.add(this._getUrlBase(t*gt+"x")+` ${this._validateSize(t*gt+"w")}`)}):(e.add(this._getUrlBase(this._getElSize(this.currentImg.img))+" 1x"),this.$$("hi-res-support")&&e.add(this._getUrlBase(this._getElSize(this.currentImg.img,2))+" 2x"),this.$$("ultra-res-support")&&e.add(this._getUrlBase(this._getElSize(this.currentImg.img,3))+" 3x")),[...e].join()}getSrc(){return this._getUrlBase()}get srcUrlPreview(){return this._getUrlBase("100x","100")}renderBackground(){[...document.querySelectorAll(this.bgSelector)].forEach(e=>{this.$$("intersection")?this.initIntersection(e,()=>{this.renderBg(e)}):this.renderBg(e)})}_appendURL({elNode:e,src:t,srcset:r}){t&&(e.src=t),r&&(e.srcset=r)}_setupConfigForImage({elNode:e}){this._setupEventProxy(e),this.initAttributes(e)}loaderImage({src:e,srcset:t,elNode:r}){return new Promise((n,o)=>{this._setupConfigForImage({elNode:r}),r.setAttribute(Qi,""),r.addEventListener("load",()=>{r.removeAttribute(Qi),n(r)}),r.addEventListener("error",()=>{o(!1)}),this._appendURL({elNode:r,src:e,srcset:t})})}async renderImage(){var e,t;if(this.$$("intersection")){this.hasPreviewImage&&(this._setupConfigForImage({elNode:this._imgPreview}),this.appendChild(this._imgPreview)),this.initIntersection(this.currentImg.img,async()=>{var r;this.hasPreviewImage&&(this._imgPreview.src=this.srcUrlPreview);try{await this.loaderImage({src:this.getSrc(),srcset:this.getSrcset(),elNode:this._img}),this.hasPreviewImage&&await this._imgPreview.remove(),this.appendChild(this._img)}catch{this.hasPreviewImage&&await((r=this._imgPreview)==null?void 0:r.remove()),this.appendChild(this._img)}});return}try{this.hasPreviewImage&&(await this.loaderImage({src:this.srcUrlPreview,elNode:this._imgPreview}),this.appendChild(this._imgPreview)),await this.loaderImage({src:this.getSrc(),srcset:this.getSrcset(),elNode:this._img}),this.hasPreviewImage&&await((e=this._imgPreview)==null?void 0:e.remove()),this.appendChild(this._img)}catch{this.hasPreviewImage&&await((t=this._imgPreview)==null?void 0:t.remove()),this.appendChild(this._img)}}init(){this.bgSelector?this.renderBackground():this.renderImage()}}class ul extends cl{initCallback(){super.initCallback(),this.sub$$("src",()=>{this.init()}),this.sub$$("uuid",()=>{this.init()}),this.sub$$("lazy",i=>{!this.$$("is-background-for")&&!this.$$("is-preview-blur")&&(this.img.loading=i?"lazy":"eager")})}}const Ze=class Ze extends R{constructor(){super();u(this,"couldBeCtxOwner",!0);this.init$={...this.init$,withDropZone:!0,onClick:()=>{this.api.initFlow()},"button-text":""}}initCallback(){super.initCallback(),this.defineAccessor("dropzone",e=>{typeof e>"u"||(this.$.withDropZone=S(e))}),this.subConfigValue("multiple",e=>{this.$["button-text"]=e?"upload-files":"upload-file"})}};u(Ze,"styleAttrs",[...de(Ze,Ze,"styleAttrs"),"uc-simple-btn"]);let st=Ze;st.template=`
  <uc-drop-area set="@disabled: !withDropZone">
    <button type="button" set="onclick: onClick">
      <uc-icon name="upload"></uc-icon>
      <span l10n="button-text"></span>
      <slot></slot>
      <div class="uc-visual-drop-area" l10n="drop-files-here"></div>
    </button>
  </uc-drop-area>
`;st.bindAttributes({dropzone:null});class ir extends g{constructor(){super(...arguments);u(this,"historyTracked",!0);u(this,"activityType",g.activities.START_FROM)}initCallback(){super.initCallback(),this.registerActivity(this.activityType)}}ir.template=' <div class="uc-content"><slot></slot></div> ';function dl(s){return new Promise(i=>{typeof window.FileReader!="function"&&i(!1);try{let e=new FileReader;e.onerror=()=>{i(!0)};let t=r=>{r.type!=="loadend"&&e.abort(),i(!1)};e.onloadend=t,e.onprogress=t,e.readAsDataURL(s)}catch{i(!1)}})}function hl(s,i){return new Promise(e=>{let t=0;const r=[],n=a=>{a||(console.warn("Unexpectedly received empty content entry",{scope:"drag-and-drop"}),e(null)),a.isFile?(t++,a.file(l=>{t--;const c=new File([l],l.name,{type:l.type||i});r.push({type:"file",file:c,fullPath:a.fullPath}),t===0&&e(r)})):a.isDirectory&&o(a.createReader())};let o=a=>{t++,a.readEntries(l=>{t--;for(let c of l)n(c);t===0&&e(r)})};n(s)})}function fl(s){const i=[],e=[];for(let t=0;t<s.items.length;t++){let r=s.items[t];if(r)if(r.kind==="file"){const n=r.type;if(typeof r.webkitGetAsEntry=="function"||typeof r.getAsEntry=="function"){let a=typeof r.webkitGetAsEntry=="function"?r.webkitGetAsEntry():r.getAsEntry();e.push(hl(a,n).then(l=>{l&&i.push(...l)}));continue}const o=r.getAsFile();o&&e.push(dl(o).then(a=>{a||i.push({type:"file",file:o})}))}else r.kind==="string"&&r.type.match("^text/uri-list")&&e.push(new Promise(n=>{r.getAsString(o=>{i.push({type:"url",url:o}),n(void 0)})}))}return Promise.all(e).then(()=>i)}const F={ACTIVE:0,INACTIVE:1,NEAR:2,OVER:3};let rs=["focus"],pl=100,ei=new Map;function ml(s,i){let e=Math.max(Math.min(s[0],i.x+i.width),i.x),t=Math.max(Math.min(s[1],i.y+i.height),i.y);return Math.sqrt((s[0]-e)*(s[0]-e)+(s[1]-t)*(s[1]-t))}function ns(s){let i=0,e=document.body,t=new Set,r=p=>t.add(p),n=F.INACTIVE,o=p=>{s.shouldIgnore()&&p!==F.INACTIVE||(n!==p&&t.forEach(b=>b(p)),n=p)},a=()=>i>0;r(p=>s.onChange(p));let l=()=>{i=0,o(F.INACTIVE)},c=()=>{i+=1,n===F.INACTIVE&&o(F.ACTIVE)},d=()=>{i-=1,a()||o(F.INACTIVE)},h=p=>{p.preventDefault(),i=0,o(F.INACTIVE)},f=p=>{if(s.shouldIgnore())return;a()||(i+=1);let b=[p.x,p.y],v=s.element.getBoundingClientRect(),C=Math.floor(ml(b,v)),_=C<pl,y=p.composedPath().includes(s.element);ei.set(s.element,C);let M=Math.min(...ei.values())===C;y&&M?(p.preventDefault(),o(F.OVER)):o(_&&M?F.NEAR:F.ACTIVE)},m=async p=>{if(s.shouldIgnore())return;p.preventDefault();let b=await fl(p.dataTransfer);s.onItems(b),o(F.INACTIVE)};return e.addEventListener("drop",h),e.addEventListener("dragleave",d),e.addEventListener("dragenter",c),e.addEventListener("dragover",f),s.element.addEventListener("drop",m),rs.forEach(p=>{window.addEventListener(p,l)}),()=>{ei.delete(s.element),e.removeEventListener("drop",h),e.removeEventListener("dragleave",d),e.removeEventListener("dragenter",c),e.removeEventListener("dragover",f),s.element.removeEventListener("drop",m),rs.forEach(p=>{window.removeEventListener(p,l)})}}const sr="uc-drop-area",Ie=`${sr}/registry`,Ke=class Ke extends R{constructor(){super(),this.init$={...this.init$,state:F.INACTIVE,withIcon:!1,isClickable:!1,isFullscreen:!1,isEnabled:!0,isVisible:!0,isInitFlow:!1,text:"",[Ie]:null}}isActive(){if(!this.$.isEnabled)return!1;const i=this.getBoundingClientRect(),e=i.width>0&&i.height>0,t=i.top>=0&&i.left>=0&&i.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&i.right<=(window.innerWidth||document.documentElement.clientWidth),r=window.getComputedStyle(this),n=r.visibility!=="hidden"&&r.display!=="none";return e&&n&&t}initCallback(){super.initCallback(),this.bindL10n("text",()=>this.l10n("drop-files-here")),this.$[Ie]||(this.$[Ie]=new Set),this.$[Ie].add(this),this.defineAccessor("disabled",e=>{this.set$({isEnabled:!S(e)})}),this.defineAccessor("clickable",e=>{this.set$({isClickable:S(e)})}),this.defineAccessor("initflow",e=>{this.set$({isInitFlow:S(e)})}),this.defineAccessor("with-icon",e=>{this.set$({withIcon:S(e)})}),this.defineAccessor("fullscreen",e=>{this.set$({isFullscreen:S(e)})}),this.defineAccessor("text",e=>{typeof e=="string"?this.bindL10n("text",()=>this.l10n(e)||e):this.bindL10n("text",()=>this.l10n("drop-files-here"))}),this._destroyDropzone=ns({element:this,shouldIgnore:()=>this._shouldIgnore(),onChange:e=>{this.$.state=e},onItems:e=>{e.length&&(e.forEach(t=>{t.type==="url"?this.api.addFileFromUrl(t.url,{source:U.DROP_AREA}):t.type==="file"&&this.api.addFileFromObject(t.file,{source:U.DROP_AREA,fullPath:t.fullPath})}),this.uploadCollection.size&&(this.modalManager.open(g.activities.UPLOAD_LIST),this.set$({"*currentActivity":g.activities.UPLOAD_LIST})))}});let i=this.ref["content-wrapper"];i&&(this._destroyContentWrapperDropzone=ns({element:i,onChange:e=>{var r;const t=(r=Object.entries(F).find(([,n])=>n===e))==null?void 0:r[0].toLowerCase();t&&i.setAttribute("drag-state",t)},onItems:()=>{},shouldIgnore:()=>this._shouldIgnore()})),this.sub("state",e=>{var r;const t=(r=Object.entries(F).find(([,n])=>n===e))==null?void 0:r[0].toLowerCase();t&&this.setAttribute("drag-state",t)}),this.subConfigValue("sourceList",e=>{const t=le(e);this.$.isEnabled=t.includes(U.LOCAL),this.$.isVisible=this.$.isEnabled||!this.querySelector("[data-default-slot]")}),this.sub("isVisible",e=>{this.toggleAttribute("hidden",!e)}),this.sub("isClickable",e=>{this.toggleAttribute("clickable",e)}),this.$.isClickable&&(this._onAreaClicked=e=>{if(e.type==="keydown"){if(e.code==="Space"||e.code==="Enter"){if(this.$.isInitFlow){this.api.initFlow();return}this.api.openSystemDialog()}}else if(e.type==="click"){if(this.$.isInitFlow){this.api.initFlow();return}this.api.openSystemDialog()}},this.addEventListener("keydown",this._onAreaClicked),this.addEventListener("click",this._onAreaClicked))}_shouldIgnore(){return!this.$.isEnabled||!this._couldHandleFiles()?!0:this.$.isFullscreen?[...this.$[Ie]].filter(t=>t!==this).filter(t=>t.isActive()).length>0:!1}_couldHandleFiles(){let i=this.cfg.multiple,e=this.cfg.multipleMax,t=this.uploadCollection.size;return!(i&&e&&t>=e||!i&&t>0)}destroyCallback(){var e,t;super.destroyCallback();const i=this.$[Ie];i&&(i.delete(this),i.size===0&&x.deleteCtx(sr)),(e=this._destroyDropzone)==null||e.call(this),(t=this._destroyContentWrapperDropzone)==null||t.call(this),this._onAreaClicked&&(this.removeEventListener("keydown",this._onAreaClicked),this.removeEventListener("click",this._onAreaClicked))}};u(Ke,"styleAttrs",[...de(Ke,Ke,"styleAttrs"),"uc-drop-area"]);let rt=Ke;rt.template=`
  <slot>
    <div data-default-slot hidden></div>
    <div ref="content-wrapper" class="uc-content-wrapper" set="@hidden: !isVisible">
      <div class="uc-icon-container" set="@hidden: !withIcon">
        <uc-icon name="default"></uc-icon>
        <uc-icon name="arrow-down"></uc-icon>
      </div>
      <span class="uc-text">{{text}}</span>
    </div>
  </slot>
`;rt.bindAttributes({"with-icon":null,clickable:null,text:null,fullscreen:null,disabled:null,initflow:null});const gl="src-type-";class Si extends R{constructor(){super();u(this,"couldBeCtxOwner",!0);u(this,"type");u(this,"_registeredTypes",{});this.init$={...this.init$,iconName:"default","src-type":""}}initTypes(){this.registerType({type:U.LOCAL,activate:()=>(this.api.openSystemDialog(),!1)}),this.registerType({type:U.URL,activity:g.activities.URL,textKey:"from-url"}),this.registerType({type:U.CAMERA,activity:g.activities.CAMERA,activate:()=>{const e=It.htmlMediaCapture;return e&&this.api.openSystemDialog({captureCamera:!0}),!e}}),this.registerType({type:"draw",activity:g.activities.DRAW,icon:"edit-draw"});for(let e of Object.values(Ks))this.registerType({type:e,activity:g.activities.CAMERA,activate:()=>{const t=It.htmlMediaCapture;return t&&this.api.openSystemDialog({captureCamera:!0,modeCamera:e==="mobile-photo-camera"?T.PHOTO:T.VIDEO}),!t}});for(let e of Object.values(Ht))this.registerType({type:e,activity:g.activities.EXTERNAL,activityParams:{externalSourceType:e}})}initCallback(){super.initCallback(),this.initTypes(),this.defineAccessor("type",e=>{e&&this.applyType(e)})}registerType(e){this._registeredTypes[e.type]=e}getType(e){return this._registeredTypes[e]}activate(){if(!this.type)return;const e=this._registeredTypes[this.type],{activity:t,activate:r,activityParams:n={}}=e;(r?r():!!t)&&(this.modalManager.open(t),this.set$({"*currentActivityParams":n,"*currentActivity":t}))}applyType(e){const t=this._registeredTypes[e];if(!t){console.warn("Unsupported source type: "+e);return}const{textKey:r=e,icon:n=e}=t;this.$["src-type"]=`${gl}${r}`,this.$.iconName=n,this.onclick=()=>{this.activate()}}}Si.template=`
  <button type="button">
    <uc-icon set="@name: iconName"></uc-icon>
    <div class="uc-txt" l10n="src-type"></div>
  </button>
`;Si.bindAttributes({type:null});class bl extends I{initCallback(){super.initCallback(),this.subConfigValue("sourceList",i=>{let e=le(i),t="";e.forEach(r=>{if(r==="instagram"){console.error("Instagram source was removed because the Instagram Basic Display API hasn't been available since December 4, 2024. Official statement, see here:https://developers.facebook.com/blog/post/2024/09/04/update-on-instagram-basic-display-api/?locale=en_US");return}if(r==="camera"&&It.htmlMediaCapture){this.subConfigValue("cameraModes",n=>{const o=be(n);o.forEach(a=>{t+=`<uc-source-btn role="listitem" type="mobile-${a}-camera"></uc-source-btn>`}),o.length===0&&(t+='<uc-source-btn role="listitem" type="mobile-photo-camera"></uc-source-btn>')});return}t+=`<uc-source-btn role="listitem" type="${r}"></uc-source-btn>`}),this.cfg.sourceListWrap?this.innerHTML=t:this.outerHTML=t})}}const Gt=()=>{const s=[];return{stack:s,promiseReadJpegChunks:e=>new Promise((t,r)=>{let n=2;const o=(c,d)=>{const h=new FileReader;h.addEventListener("load",()=>{d(new DataView(h.result))}),h.addEventListener("error",f=>{r(`Reader error: ${f}`)}),h.readAsArrayBuffer(c)},a=()=>o(e.slice(n,n+128),c=>{let d,h,f;for(d=h=0,f=c.byteLength;f>=0?h<f:h>f;d=f>=0?++h:--h)if(c.getUint8(d)===255){n+=d;break}l()}),l=()=>{const c=n;return o(e.slice(n,n+=4),d=>{if(d.byteLength!==4||d.getUint8(0)!==255){r("Corrupted");return}const h=d.getUint8(1);if(h===218){t(!0);return}const f=d.getUint16(2)-2;return o(e.slice(n,n+=f),m=>{if(m.byteLength!==f){r("Corrupted");return}s.push({startPos:c,length:f,marker:h,view:m}),a()})})};FileReader&&DataView||r("Not Support"),o(e.slice(0,2),c=>{c.getUint16(0)!==65496&&r("Not jpeg"),a()})})}},_l=async s=>{const i=[],{promiseReadJpegChunks:e,stack:t}=Gt();return await e(s),t.forEach(({marker:r,view:n})=>{r===226&&n.getUint32(0)===1229144927&&n.getUint32(4)===1347571526&&n.getUint32(8)===1229735168&&i.push(n)}),i},rr=async(s,i,e)=>{{const t=[],r=[],{promiseReadJpegChunks:n,stack:o}=Gt();await n(s),o.forEach(c=>{if(c.marker===i)return t.push(c.startPos),r.push(c.length)});const a=[s.slice(0,2)];for(const c of e){const d=new DataView(new ArrayBuffer(4));d.setUint16(0,65280+i),d.setUint16(2,c.byteLength+2),a.push(d.buffer),a.push(c)}let l=2;for(let c=0;c<t.length;c++)t[c]>l&&a.push(s.slice(l,t[c])),l=t[c]+r[c]+4;return a.push(s.slice(l,s.size)),new Blob(a,{type:s.type})}},vl=226,nr=(s,i)=>rr(s,vl,i.map(e=>e.buffer)),yl=async s=>{try{return await nr(s,[])}catch(i){throw new Error(`Failed to strip ICC profile: ${i}`)}},wl=(s,i,e)=>new Promise((t,r)=>{const n=o=>{if(!o){r("Failed to convert canvas to blob");return}t(o)};s.toBlob(n,i,e),s.width=s.height=1}),nt=()=>{const s=document.createElement("canvas"),i=s.getContext("2d");return{canvas:s,ctx:i}},Cl=s=>{const{ctx:e,canvas:t}=nt();t.width=t.height=50,e.drawImage(s,0,0,50,50);const r=e.getImageData(0,0,50,50).data;t.width=t.height=1;for(let n=3;n<r.length;n+=4)if(r[n]<254)return!0;return!1},El=async s=>{let i=null;const{promiseReadJpegChunks:e,stack:t}=Gt();return await e(s),t.forEach(({marker:r,view:n})=>{if(!i&&r===225&&n.byteLength>=14&&n.getUint32(0)===1165519206&&n.getUint16(4)===0){i=n;return}}),i},Al="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEASABIAAD/4QA6RXhpZgAATU0AKgAAAAgAAwESAAMAAAABAAYAAAEoAAMAAAABAAIAAAITAAMAAAABAAEAAAAAAAD/2wBDAP//////////////////////////////////////////////////////////////////////////////////////wAALCAABAAIBASIA/8QAJgABAAAAAAAAAAAAAAAAAAAAAxABAAAAAAAAAAAAAAAAAAAAAP/aAAgBAQAAPwBH/9k=";let bt;const Tl=()=>new Promise(s=>{if(bt!==void 0)s(bt);else{const i=new Image;i.addEventListener("load",()=>{bt=i.naturalWidth<i.naturalHeight,i.src="//:0",s(bt)}),i.src=Al}}),xl=(s,i)=>{let e,t,r,n;if(!s||s.byteLength<14||s.getUint32(0)!==1165519206||s.getUint16(4)!==0)return;if(s.getUint16(6)===18761)t=!0;else if(s.getUint16(6)===19789)t=!1;else return;if(s.getUint16(8,t)!==42)return;r=8+s.getUint32(10,t);const o=s.getUint16(r-2,t);for(e=0,n=o;n>=0?e<n:e>n;n>=0?++e:--e){if(s.byteLength<r+10)return;s.getUint16(r,t)===274&&i(r+8,t),r+=12}},Sl=(s,i)=>{xl(s,(e,t)=>s.setUint16(e,i,t))},Il=async(s,i,e)=>(e&&Sl(i,1),rr(s,225,[i.buffer])),$l=(s,i)=>new Promise((e,t)=>{i&&(s.src=i),s.complete?e(s):(s.addEventListener("load",()=>{e(s)}),s.addEventListener("error",()=>{t(new Error("Failed to load image. Probably not an image."))}))}),kl=s=>$l(new Image,s),Ol=[1,3],Ml=[192,193,194,195,197,198,199,201,202,203,205,206,207],os={squareSide:[Math.floor(Math.sqrt(5*1e3*1e3)),4096,8192,11180,10836,11402,14188,16384],dimension:[4096,8192,16384,32767,65535]},Ll=async s=>{let i=!1;const{promiseReadJpegChunks:e,stack:t}=Gt();return await e(s).then(()=>(t.forEach(({marker:r,view:n})=>{if(!i&&Ml.indexOf(r)>=0){const o=n.getUint8(5);Ol.indexOf(o)<0&&(i=!0)}}),i)).catch(()=>i)},or=(s,i)=>{const e={};return(...t)=>{const r=i(t,e);return r in e?e[r]:e[r]=s(...t)}},ar=(s,i)=>{const[e]=s,t=Object.keys(i).map(r=>parseInt(r,10)).sort((r,n)=>r-n);for(let r=0;r<t.length;r++){const n=t[r],o=!!i[n];if(n>e&&o||n<e&&!o)return n}return e},fe={R:55,G:110,B:165,A:255},Pl=`rgba(${fe.R}, ${fe.G}, ${fe.B}, ${fe.A/255})`,lr=(s,i)=>{try{const e=[s-1,i-1,1,1],{canvas:t,ctx:r}=nt();t.width=1,t.height=1;const{canvas:n,ctx:o}=nt();n.width=s,n.height=i,o&&(o.fillStyle=Pl,o.fillRect(...e),r.drawImage(n,s-1,i-1,1,1,0,0,1,1));const a=r&&r.getImageData(0,0,1,1).data;let l=!1;return a&&(l=a[0]===fe.R&&a[1]===fe.G&&a[2]===fe.B&&a[3]===fe.A),n.width=n.height=1,l}catch{return console.error(`Failed to test for max canvas size of ${s}x${i}.`),!1}};function cr(s){return(...i)=>new Promise(e=>{setTimeout(()=>{const t=s(...i);e(t)},0)})}const Ul=cr(or(lr,ar)),Rl=cr(or(lr,ar)),ur=async(s,i)=>{const e=os.squareSide.find(o=>o*o>=s*i),t=os.dimension.find(o=>o>=s&&o>=i);if(!e||!t)throw new Error("Not supported");const[r,n]=await Promise.all([Ul(e,e),Rl(t,1)]);if(r&&n)return!0;throw new Error("Not supported")},dr=async(s,i,e)=>{try{const{ctx:t,canvas:r}=nt();return r.width=i,r.height=e,t.imageSmoothingQuality="high",t.drawImage(s,0,0,i,e),s instanceof HTMLImageElement&&(s.src="//:0"),s instanceof HTMLCanvasElement&&(s.width=s.height=1),r}catch(t){throw new Error("Canvas resize error",{cause:t})}},Dl=({img:s,targetW:i,targetH:e})=>dr(s,i,e),Fl=function({sourceW:s,targetW:i,targetH:e,step:t}){const r=[];let n=i,o=e;do r.push([n,o]),n=Math.round(n/t),o=Math.round(o/t);while(n<s*t);return r.reverse()},Vl=({img:s,sourceW:i,targetW:e,targetH:t,step:r})=>{const n=Fl({sourceW:i,targetW:e,targetH:t,step:r});return n.reduce((o,[a,l],c)=>o.then(d=>ur(a,l).then(()=>dr(d,a,l)).catch(()=>{if(c===n.length-1)throw new Error("Not supported");return d})),Promise.resolve(s))},Nl=()=>/iPad|iPhone|iPod/.test(navigator.platform)?!0:navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform),zl=navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform),ti=.71,Bl=(s,i)=>{if(s.width*ti*s.height*ti<i.size)throw new Error("Not required");const e=s.width,t=s.height,r=e/t,n=Math.floor(Math.sqrt(i.size*r)),o=Math.floor(i.size/Math.sqrt(i.size*r));return ur(n,o).then(()=>{const{ctx:a}=nt();return"imageSmoothingQuality"in a&&!Nl()&&!zl?Dl({img:s,targetW:n,targetH:o}):Vl({img:s,sourceW:e,targetW:n,targetH:o,step:ti})}).catch(()=>Promise.reject("Not supported"))},Hl=async(s,i)=>{try{if(await Ll(s))throw new Error("Should skipped");const t=await Promise.allSettled([El(s),Tl(),_l(s)]),n=!t.some(b=>b.status==="rejected"),[o,a,l]=t,c=await yl(s).catch(()=>s),d=await kl(URL.createObjectURL(c));URL.revokeObjectURL(d.src);const h=await Bl(d,i);let f="image/jpeg",m=(i==null?void 0:i.quality)||.8;!n&&Cl(h)&&(f="image/png",m=void 0);let p=await wl(h,f,m);if(n&&o.status==="fulfilled"&&o.value){const b=o.value,v=a.status==="fulfilled"?a.value:!1;p=await Il(p,b,v)}return n&&l.status==="fulfilled"&&l.value.length>0&&(p=await nr(p,l.value)),p}catch(e){let t;throw e instanceof Error&&(t=e.message),typeof e=="string"&&(t=e),new Error(`Failed to shrink image. ${t?`Message: "${t}".`:""}`,{cause:e})}},as=16384,jl=/^([0-9]+)x([0-9]+)(?:\s+(\d{1,2}|100)%)?$/i,Gl=s=>{const i=jl.exec(s==null?void 0:s.toLocaleLowerCase())||[];if(!i.length)return!1;const e=i[1]*i[2],t=as*as;return e>t?(console.warn(`Shrinked size can not be larger than ${Math.floor(t/1e3/1e3)}MP. You have set ${i[1]}x${i[2]} (${Math.ceil(e/1e3/100)/10}MP).`),!1):{quality:i[3]?i[3]/100:void 0,size:e}},Ii=(s,i)=>{let e,t,r;const n=(...o)=>{e?(clearTimeout(t),t=setTimeout(()=>{Date.now()-r>=i&&(s(...o),r=Date.now())},Math.max(i-(Date.now()-r),0))):(s(...o),r=Date.now(),e=!0)};return Object.defineProperty(n,"cancel",{configurable:!1,writable:!1,enumerable:!1,value:()=>{clearTimeout(t)}}),n};class hr extends R{constructor(){super(...arguments);u(this,"_entrySubs",new Set);u(this,"_entry",null);u(this,"_subEntry",(e,t)=>this._withEntry((r,n,o)=>{let a=r.subscribe(n,l=>{this.isConnected&&o(l)});this._entrySubs.add(a)})(e,t))}_withEntry(e){return(...r)=>{const n=this._entry;if(!n){console.warn("No entry found");return}return e(n,...r)}}_reset(){for(let e of this._entrySubs)e.remove();this._entrySubs=new Set,this._entry=null}disconnectedCallback(){super.disconnectedCallback(),this._entrySubs=new Set}}const z=Object.freeze({FINISHED:Symbol("FINISHED"),FAILED:Symbol("FAILED"),UPLOADING:Symbol("UPLOADING"),IDLE:Symbol("IDLE")});class Ae extends hr{constructor(){super();u(this,"couldBeCtxOwner",!0);u(this,"pauseRender",!0);u(this,"_renderedOnce",!1);u(this,"_calculateState",this._withEntry(e=>{let t=z.IDLE;e.getValue("errors").length>0?t=z.FAILED:e.getValue("isUploading")?t=z.UPLOADING:e.getValue("fileInfo")&&(t=z.FINISHED),this.$.state=t}));u(this,"_debouncedCalculateState",H(this._calculateState.bind(this),100));u(this,"_updateHint",this._withEntry(Ii(e=>{const t=e.getValue("source"),r=e.getValue("externalUrl"),n=e.getValue("errors").length===0,o=this.$.progressValue===0,a=this.$.state===z.UPLOADING,l=e.getValue("isQueued");if(!n||!a||!o){this.$.hint="";return}if(l){const c=this.l10n("queued");this.$.hint=c;return}if(r&&t&&t!==U.URL){const c=this.l10n("waiting-for",{source:this.l10n(`src-type-${t}`)});this.$.hint=c;return}this.$.hint=""},100)));u(this,"_handleState",this._withEntry((e,t)=>{var n,o,a,l,c;t===z.FAILED?this.$.badgeIcon="badge-error":t===z.FINISHED&&(this.$.badgeIcon="badge-success"),t===z.UPLOADING&&(this.$.isFocused=!1);const r=e.getValue("fileName");this.set$({isFailed:t===z.FAILED,isUploading:t===z.UPLOADING,isFinished:t===z.FINISHED,progressVisible:t===z.UPLOADING,isEditable:this.cfg.useCloudImageEditor&&((n=this._entry)==null?void 0:n.getValue("isImage"))&&((o=this._entry)==null?void 0:o.getValue("cdnUrl")),errorText:(l=(a=e.getValue("errors"))==null?void 0:a[0])==null?void 0:l.message,ariaLabelStatusFile:r&&this.l10n("a11y-file-item-status",{fileName:r,status:this.l10n(((c=t==null?void 0:t.description)==null?void 0:c.toLocaleLowerCase())??"").toLocaleLowerCase()})}),this._updateHint()}));u(this,"upload",this._withEntry(async e=>{var r,n;if(!this.uploadCollection.read(e.uid)||e.getValue("fileInfo")||e.getValue("isUploading")||e.getValue("errors").length>0)return;const t=this.cfg.multiple?this.cfg.multipleMax:1;if(!(t&&this.uploadCollection.size>t)){this._debouncedCalculateState(),e.setMultipleValues({isUploading:!0,errors:[],isQueued:!0});try{let o=new AbortController;e.setValue("abortController",o);const a=async()=>{e.setValue("isQueued",!1);let c=e.getValue("file");c&&this.cfg.imageShrink&&(c=await this._processShrink(c).catch(()=>c));const d=c||e.getValue("externalUrl")||e.getValue("uuid");if(!d)throw new Error("No file input");const f={...await this.getUploadClientOptions(),fileName:e.getValue("fileName")??void 0,source:e.getValue("source")??void 0,onProgress:m=>{if(m.isComputable){let p=m.value*100;e.setValue("uploadProgress",p)}},signal:o.signal,metadata:await this.getMetadataFor(e.uid)};return this.debugPrint("upload options",d,f),Bs(d,f)};let l=await this.$["*uploadQueue"].add(a);e.setMultipleValues({fileInfo:l,isQueued:!1,isUploading:!1,fileName:l.originalFilename,fileSize:l.size,isImage:l.isImage??!1,mimeType:((n=(r=l.contentInfo)==null?void 0:r.mime)==null?void 0:n.mime)??l.mimeType,uuid:l.uuid,cdnUrl:e.getValue("cdnUrl")??l.cdnUrl,cdnUrlModifiers:e.getValue("cdnUrlModifiers")??"",uploadProgress:100,source:e.getValue("source")??null}),e===this._entry&&this._debouncedCalculateState()}catch(o){o instanceof Te&&o.isCancel?e.setMultipleValues({isUploading:!1,uploadProgress:0}):o instanceof Pt?e.setMultipleValues({isUploading:!1,uploadProgress:0,uploadError:o}):(console.error("Unknown upload error",o),e.setMultipleValues({isUploading:!1,uploadProgress:0,uploadError:new Error("Something went wrong",{cause:o})})),e===this._entry&&this._debouncedCalculateState()}}}));this.init$={...this.init$,uid:"",itemName:"",errorText:"",hint:"",thumbUrl:"",progressValue:0,progressVisible:!1,badgeIcon:"",isFinished:!1,isFailed:!1,isUploading:!1,isFocused:!1,isEditable:!1,showFileNames:!1,state:z.IDLE,ariaLabelStatusFile:"",onEdit:this._withEntry(e=>{this.$["*currentActivityParams"]={internalId:e.uid},this.modalManager.open(g.activities.CLOUD_IMG_EDIT),this.$["*currentActivity"]=g.activities.CLOUD_IMG_EDIT}),onRemove:()=>{this.uploadCollection.remove(this.$.uid)},onUpload:()=>{this.upload()}}}_reset(){super._reset(),this._debouncedCalculateState.cancel()}_observerCallback(e){let[t]=e;this._isIntersecting=t.isIntersecting,this._thumbRect=t.boundingClientRect,t.isIntersecting&&!this._renderedOnce&&(this.render(),this._renderedOnce=!0)}_handleEntryId(e){var r;this._reset();let t=(r=this.uploadCollection)==null?void 0:r.read(e);this._entry=t,t&&(this._subEntry("uploadProgress",n=>{this.$.progressValue=n,this._updateHint()}),this._subEntry("isQueued",()=>{this._updateHint()}),this._subEntry("fileName",n=>{this.$.itemName=n||t.getValue("externalUrl")||this.l10n("file-no-name"),this._debouncedCalculateState()}),this._subEntry("externalUrl",n=>{this.$.itemName=t.getValue("fileName")||n||this.l10n("file-no-name")}),this._subEntry("fileInfo",()=>{this._debouncedCalculateState()}),this._subEntry("errors",()=>this._debouncedCalculateState()),this._subEntry("isUploading",()=>this._debouncedCalculateState()),this._subEntry("fileSize",()=>this._debouncedCalculateState()),this._subEntry("mimeType",()=>this._debouncedCalculateState()),this._subEntry("isImage",()=>this._debouncedCalculateState()))}_updateShowFileNames(e){if(this.cfg.filesViewMode==="list"){this.$.showFileNames=!0;return}this.$.showFileNames=e}initCallback(){super.initCallback(),this.sub("uid",e=>{this._handleEntryId(e)}),this.sub("state",e=>{this._handleState(e)}),this.subConfigValue("useCloudImageEditor",()=>this._debouncedCalculateState()),this.subConfigValue("filesViewMode",e=>{this._updateShowFileNames(this.cfg.gridShowFileNames),this.setAttribute("mode",e)}),this.subConfigValue("gridShowFileNames",e=>{this._updateShowFileNames(e)}),this.onclick=()=>{Ae.activeInstances.forEach(e=>{e===this?e.setAttribute("focused",""):e.removeAttribute("focused")})},this.sub("*uploadTrigger",e=>{this._entry&&!e.has(this._entry.uid)||setTimeout(()=>this.isConnected&&this.upload())}),Ae.activeInstances.add(this)}destroyCallback(){super.destroyCallback(),Ae.activeInstances.delete(this),this._reset()}connectedCallback(){super.connectedCallback(),this._observer=new window.IntersectionObserver(this._observerCallback.bind(this),{threshold:[0,1]}),this._observer.observe(this)}disconnectedCallback(){var e;super.disconnectedCallback(),(e=this._observer)==null||e.disconnect()}_settingsOfShrink(){return Gl(this.cfg.imageShrink)}_processShrink(e){return Hl(e,this._settingsOfShrink())}}Ae.template=`
  <div class="uc-inner" set="@finished: isFinished; @uploading: isUploading; @failed: isFailed; @focused: isFocused">
    <uc-thumb set="uid:uid;badgeIcon:badgeIcon"></uc-thumb>

    <div aria-atomic="true" aria-live="polite" class="uc-file-name-wrapper" set="@aria-label:ariaLabelStatusFile;">
      <span class="uc-file-name" set="@hidden: !showFileNames">{{itemName}}</span>
      <span class="uc-file-error" set="@hidden: !errorText;">{{errorText}}</span>
      <span class="uc-file-hint" set="@hidden: !hint">{{hint}}</span>
    </div>
    <div class="uc-file-actions">
      <button
        type="button"
        l10n="@title:file-item-edit-button;@aria-label:file-item-edit-button"
        class="uc-edit-btn uc-mini-btn"
        set="onclick: onEdit; @hidden: !isEditable"
      >
        <uc-icon name="edit-file"></uc-icon>
      </button>
      <button
        type="button"
        l10n="@title:file-item-remove-button;@aria-label:file-item-remove-button"
        class="uc-remove-btn uc-mini-btn"
        set="onclick: onRemove;"
      >
        <uc-icon name="remove-file"></uc-icon>
      </button>
      <button type="button" class="uc-upload-btn uc-mini-btn" set="onclick: onUpload;">
        <uc-icon name="upload"></uc-icon>
      </button>
    </div>
    <uc-progress-bar
      class="uc-progress-bar"
      set="value: progressValue; visible: progressVisible; @hasFileName: showFileNames;"
    >
    </uc-progress-bar>
  </div>
`;Ae.activeInstances=new Set;let ii=null;const ke=class ke extends I{constructor(){super();u(this,"_handleBackdropClick",()=>{this._closeDialog()});u(this,"_closeDialog",()=>{var e;(e=this.modalManager)==null||e.close(this.id),this.modalManager.hasActiveModals||(document.body.style.overflow="")});u(this,"_handleDialogClose",()=>{this._closeDialog()});u(this,"_handleDialogMouseDown",e=>{this._mouseDownTarget=e.target});u(this,"_handleDialogMouseUp",e=>{e.target===this.ref.dialog&&e.target===this._mouseDownTarget&&this._closeDialog()});this.init$={...this.init$,closeClicked:this._handleDialogClose}}show(){this.ref.dialog.showModal?(this.setAttribute("aria-modal","true"),this.ref.dialog.showModal()):this.ref.dialog.setAttribute("open",""),this.cfg.modalScrollLock&&(document.body.style.overflow="hidden")}hide(){this.ref.dialog.close?(this.setAttribute("aria-modal","false"),this.ref.dialog.close()):this.ref.dialog.removeAttribute("open")}_handleModalOpen({id:e}){e===this.id?(ii=e,this.show()):this.hide(),this.emit(k.MODAL_OPEN,{modalId:e},{debounce:!0})}_handleModalClose({id:e}){e===this.id&&this.hide(),this.emit(k.MODAL_CLOSE,{modalId:e,hasActiveModals:this.modalManager.hasActiveModals},{debounce:!0})}_handleModalCloseAll(){this.hide(),ii===this.id&&this.emit(k.MODAL_CLOSE,{modalId:ii,hasActiveModals:this.modalManager.hasActiveModals},{debounce:!0})}initCallback(){var e;super.initCallback(),(e=this.modalManager)==null||e.registerModal(this.id,this),this.ref.dialog.addEventListener("close",this._handleDialogClose),this.ref.dialog.addEventListener("mousedown",this._handleDialogMouseDown),this.ref.dialog.addEventListener("mouseup",this._handleDialogMouseUp),this.subConfigValue("modalBackdropStrokes",t=>{t?this.setAttribute("strokes",""):this.removeAttribute("strokes")}),this.handleModalOpen=this._handleModalOpen.bind(this),this.handleModalClose=this._handleModalClose.bind(this),this.handleModalCloseAll=this._handleModalCloseAll.bind(this),this.modalManager.subscribe(P.OPEN,this.handleModalOpen),this.modalManager.subscribe(P.CLOSE,this.handleModalClose),this.modalManager.subscribe(P.CLOSE_ALL,this.handleModalCloseAll)}destroyCallback(){super.destroyCallback(),document.body.style.overflow="",this._mouseDownTarget=void 0,this.ref.dialog.removeEventListener("close",this._handleDialogClose),this.ref.dialog.removeEventListener("mousedown",this._handleDialogMouseDown),this.ref.dialog.removeEventListener("mouseup",this._handleDialogMouseUp),this.modalManager.unsubscribe(P.OPEN,this.handleModalOpen),this.modalManager.unsubscribe(P.CLOSE,this.handleModalClose),this.modalManager.unsubscribe(P.CLOSE_ALL,this.handleModalCloseAll)}};u(ke,"styleAttrs",[...de(ke,ke,"styleAttrs"),"uc-modal"]),u(ke,"StateConsumerScope","modal");let Ot=ke;Ot.template=`
  <dialog ref="dialog">
    <slot></slot>
  </dialog>
`;class fr extends R{constructor(){super();u(this,"couldBeCtxOwner",!0);u(this,"historyTracked",!0);u(this,"activityType",g.activities.UPLOAD_LIST);u(this,"_throttledHandleCollectionUpdate",Ii(()=>{this.isConnected&&(this._updateUploadsState(),!this.couldOpenActivity&&this.$["*currentActivity"]===this.activityType&&this.historyBack())},300));this.init$={...this.init$,doneBtnVisible:!1,doneBtnEnabled:!1,uploadBtnVisible:!1,addMoreBtnVisible:!1,addMoreBtnEnabled:!1,headerText:"",commonErrorMessage:"",hasFiles:!1,onAdd:()=>{this.api.initFlow(!0)},onUpload:()=>{this.emit(k.UPLOAD_CLICK),this.api.uploadAll(),this._throttledHandleCollectionUpdate()},onDone:()=>{this.emit(k.DONE_CLICK,this.api.getOutputCollectionState()),this.api.doneFlow()},onCancel:()=>{this.uploadCollection.clearAll()}}}_updateUploadsState(){const e=this.api.getOutputCollectionState(),t={total:e.totalCount,succeed:e.successCount,uploading:e.uploadingCount,failed:e.failedCount},r=!e.errors.some(f=>f.type==="TOO_MANY_FILES"||f.type==="TOO_FEW_FILES"),n=e.errors.some(f=>f.type==="TOO_MANY_FILES"),o=e.totalCount===(this.cfg.multiple?this.cfg.multipleMax:1),a=t.failed===0&&e.errors.length===0;let l=!1,c=!1,d=!1;if(t.total-t.succeed-t.uploading-t.failed>0&&r)l=!0;else{c=!0;const f=this.cfg.groupOutput?!!e.group:!0;d=t.total===t.succeed&&r&&a&&f}this.set$({doneBtnVisible:c,doneBtnEnabled:d,uploadBtnVisible:l,addMoreBtnEnabled:t.total===0||!n&&!o,addMoreBtnVisible:!o||this.cfg.multiple}),this.bindL10n("headerText",()=>this._getHeaderText(t))}_getHeaderText(e){const t=r=>{const n=e[r];return this.l10n(`header-${r}`,{count:n})};return e.uploading>0?t("uploading"):e.failed>0?t("failed"):e.succeed>0?t("succeed"):t("total")}get couldOpenActivity(){return this.cfg.showEmptyList||this.uploadCollection.size>0}initCallback(){super.initCallback(),this.registerActivity(this.activityType),this.subConfigValue("multiple",this._throttledHandleCollectionUpdate),this.subConfigValue("multipleMin",this._throttledHandleCollectionUpdate),this.subConfigValue("multipleMax",this._throttledHandleCollectionUpdate),this.sub("*groupInfo",e=>{e&&this._throttledHandleCollectionUpdate()}),this.subConfigValue("filesViewMode",e=>{this.setAttribute("mode",e)}),this.sub("*currentActivity",e=>{!this.couldOpenActivity&&e===this.activityType&&(this.$["*currentActivity"]=this.initActivity)}),this.uploadCollection.observeProperties(this._throttledHandleCollectionUpdate),this.sub("*uploadList",e=>{this._throttledHandleCollectionUpdate(),this.set$({hasFiles:e.length>0}),this.cfg.confirmUpload||this.api.uploadAll()},!1),this.sub("*collectionErrors",e=>{const t=e.filter(r=>r.type!=="SOME_FILES_HAS_ERRORS")[0];if(!t){this.set$({commonErrorMessage:null});return}this.set$({commonErrorMessage:t.message})})}destroyCallback(){super.destroyCallback(),this.uploadCollection.unobserveProperties(this._throttledHandleCollectionUpdate)}}fr.template=`
  <uc-activity-header>
    <span aria-live="polite" class="uc-header-text">{{headerText}}</span>
    <button
      type="button"
      class="uc-mini-btn uc-close-btn"
      set="onclick: *closeModal"
      l10n="@title:a11y-activity-header-button-close;@aria-label:a11y-activity-header-button-close"
    >
      <uc-icon name="close"></uc-icon>
    </button>
  </uc-activity-header>

  <div class="uc-no-files" set="@hidden: hasFiles">
    <slot name="empty"><span l10n="no-files"></span></slot>
  </div>

  <div class="uc-files">
    <div class="uc-files-wrapper" repeat="*uploadList" repeat-item-tag="uc-file-item"></div>
    <button
      type="button"
      class="uc-add-more-btn uc-secondary-btn"
      set="onclick: onAdd; @disabled: !addMoreBtnEnabled; @hidden: !addMoreBtnVisible"
    >
      <uc-icon name="add"></uc-icon><span l10n="add-more"></span>
    </button>
  </div>

  <div class="uc-common-error" set="@hidden: !commonErrorMessage; textContent: commonErrorMessage;"></div>

  <div class="uc-toolbar">
    <button type="button" class="uc-cancel-btn uc-secondary-btn" set="onclick: onCancel;" l10n="clear"></button>
    <div class="uc-toolbar-spacer"></div>
    <button
      type="button"
      class="uc-add-more-btn uc-secondary-btn"
      set="onclick: onAdd; @disabled: !addMoreBtnEnabled; @hidden: !addMoreBtnVisible"
    >
      <uc-icon name="add"></uc-icon><span l10n="add-more"></span>
    </button>
    <button
      type="button"
      class="uc-upload-btn uc-primary-btn"
      set="@hidden: !uploadBtnVisible; onclick: onUpload;"
      l10n="upload"
    ></button>
    <button
      type="button"
      class="uc-done-btn uc-primary-btn"
      set="@hidden: !doneBtnVisible; onclick: onDone;  @disabled: !doneBtnEnabled"
      l10n="done"
    ></button>
  </div>

  <uc-drop-area ghost></uc-drop-area>
`;class pr extends R{constructor(){super(...arguments);u(this,"couldBeCtxOwner",!0);u(this,"activityType",g.activities.URL);u(this,"init$",{...this.init$,importDisabled:!0,onUpload:e=>{e.preventDefault();let t=this.ref.input.value;this.api.addFileFromUrl(t,{source:U.URL}),this.modalManager.open(g.activities.UPLOAD_LIST),this.$["*currentActivity"]=g.activities.UPLOAD_LIST},onCancel:()=>{this.historyBack()},onInput:e=>{let t=e.target.value;this.set$({importDisabled:!t})}})}initCallback(){super.initCallback(),this.registerActivity(this.activityType,{onActivate:()=>{this.ref.input.value="",this.ref.input.focus()}})}}pr.template=`
  <uc-activity-header>
    <button type="button" class="uc-mini-btn" set="onclick: *historyBack" l10n="@title:back;@aria-label:back">
      <uc-icon name="back"></uc-icon>
    </button>
    <div>
      <uc-icon name="url"></uc-icon>
      <span l10n="caption-from-url"></span>
    </div>
    <button
      type="button"
      class="uc-mini-btn uc-close-btn"
      set="onclick: *closeModal"
      l10n="@title:a11y-activity-header-button-close;@aria-label:a11y-activity-header-button-close"
    >
      <uc-icon name="close"></uc-icon>
    </button>
  </uc-activity-header>
  <form class="uc-content">
    <input placeholder="https://" class="uc-url-input" type="text" ref="input" set="oninput: onInput" />
    <button
      type="submit"
      class="uc-url-upload-btn uc-primary-btn"
      set="onclick: onUpload; @disabled: importDisabled"
      l10n="upload-url"
    ></button>
  </form>
`;const Wl=()=>typeof navigator.permissions<"u",ql={width:{ideal:1920},height:{ideal:1080},frameRate:{ideal:30}},ls=["camera","microphone"];function _t(s){const i=Math.floor(s/60).toString().padStart(2,"0"),e=Math.floor(s%60).toString().padStart(2,"0");return`${i}:${e}`}const cs="image/jpeg",us="video/webm";class mr extends R{constructor(){super();u(this,"couldBeCtxOwner",!0);u(this,"activityType",g.activities.CAMERA);u(this,"_unsubPermissions",null);u(this,"_chunks",[]);u(this,"_mediaRecorder",null);u(this,"_stream",null);u(this,"_selectedAudioId",null);u(this,"_selectedCameraId",null);u(this,"_chooseActionWithCamera",()=>{var e;if(this._activeTab===T.PHOTO&&this._shot(),this._activeTab===T.VIDEO){if(((e=this._mediaRecorder)==null?void 0:e.state)==="recording"){this._stopRecording();return}this._startRecording()}});u(this,"_updateTimer",()=>{const e=Math.floor((performance.now()-this.$._startTime+this.$._elapsedTime)/1e3);if(typeof this.cfg.maxVideoRecordingDuration=="number"&&this.cfg.maxVideoRecordingDuration>0){const t=this.cfg.maxVideoRecordingDuration-e;if(t<=0){this.ref.timer.textContent=_t(t),this._stopRecording();return}this.ref.timer.textContent=_t(t)}else this.ref.timer.textContent=_t(e);this._animationFrameId=requestAnimationFrame(this._updateTimer)});u(this,"_startTimer",()=>{this.$._startTime=performance.now(),this.$._elapsedTime=0,this._updateTimer()});u(this,"_stopTimer",()=>{this._animationFrameId&&cancelAnimationFrame(this._animationFrameId)});u(this,"_startTimeline",()=>{const e=this.ref.video.currentTime,t=this.ref.video.duration;this.ref.line.style.transform=`scaleX(${e/t})`,this.ref.timer.textContent=_t(e),this._animationFrameId=requestAnimationFrame(this._startTimeline)});u(this,"_stopTimeline",()=>{this._animationFrameId&&cancelAnimationFrame(this._animationFrameId)});u(this,"_startRecording",()=>{try{this._chunks=[],this._options={...this.cfg.mediaRecorderOptions};const{mimeType:e}=this.cfg.mediaRecorderOptions||{};e&&MediaRecorder.isTypeSupported(e)?this._options.mimeType=e:MediaRecorder.isTypeSupported(us)?this._options.mimeType=us:this._options.mimeType="video/mp4",this._stream&&(this._mediaRecorder=new MediaRecorder(this._stream,this._options),this._mediaRecorder.start(),this._mediaRecorder.addEventListener("dataavailable",t=>{this._chunks.push(t.data)}),this._startTimer(),this.classList.add("uc-recording"),this._setCameraState(K.PLAY))}catch(e){console.error("Failed to start recording",e)}});u(this,"_stopRecording",()=>{var e,t;(e=this._mediaRecorder)==null||e.addEventListener("stop",()=>{this._previewVideo(),this._stopTimer(),this._setCameraState(K.STOP)}),(t=this._mediaRecorder)==null||t.stop(),this.classList.remove("uc-recording")});u(this,"_toggleRecording",()=>{var e;((e=this._mediaRecorder)==null?void 0:e.state)!=="recording"&&(!this.ref.video.paused&&!this.ref.video.ended&&this.ref.video.readyState>2?this.ref.video.pause():this.ref.video.paused&&this.ref.video.play())});u(this,"_toggleEnableAudio",()=>{var e;(e=this._stream)==null||e.getAudioTracks().forEach(t=>{t.enabled=!t.enabled,this.$.toggleMicrophoneIcon=t.enabled?"microphone":"microphone-mute",this.$.audioSelectDisabled=!t.enabled})});u(this,"_previewVideo",()=>{var e;try{const t=new Blob(this._chunks,{type:(e=this._mediaRecorder)==null?void 0:e.mimeType}),r=URL.createObjectURL(t);this.ref.video.muted=!1,this.ref.video.volume=1,this.$.video=null,this.ref.video.src=r,this.ref.video.addEventListener("play",()=>{this._startTimeline(),this.set$({currentTimelineIcon:"pause"})}),this.ref.video.addEventListener("pause",()=>{this.set$({currentTimelineIcon:"play"}),this._stopTimeline()})}catch(t){console.error("Failed to preview video",t)}});u(this,"_retake",()=>{this._setCameraState(K.RETAKE),this._activeTab===T.VIDEO&&(this.$.video=this._stream,this.ref.video.muted=!0),this.ref.video.play()});u(this,"_accept",()=>{var n,o,a;if(this._setCameraState(K.ACCEPT),this._activeTab===T.PHOTO){(n=this._canvas)==null||n.toBlob(l=>{const c=this._createFile("camera","jpeg",cs,l);this._toSend(c)},cs);return}const e=new Blob(this._chunks,{type:(o=this._mediaRecorder)==null?void 0:o.mimeType}),t=this._guessExtensionByMime((a=this._mediaRecorder)==null?void 0:a.mimeType),r=this._createFile("video",t,`video/${t}`,e);this._toSend(r),this._chunks=[]});u(this,"_handlePhoto",e=>{e===K.SHOT&&this.set$({tabVideoHidden:!0,cameraHidden:!0,tabCameraHidden:!0,cameraActionsHidden:!1,cameraSelectHidden:!0}),(e===K.RETAKE||e===K.ACCEPT)&&this.set$({tabVideoHidden:!this._cameraModes.includes(T.VIDEO),tabCameraHidden:!this._cameraModes.includes(T.PHOTO),cameraHidden:!1,cameraActionsHidden:!0,cameraSelectHidden:this._cameraDevices.length<=1})});u(this,"_handleVideo",e=>{e===K.PLAY&&this.set$({timerHidden:!1,tabCameraHidden:!0,cameraSelectHidden:!0,audioSelectHidden:!0,currentTimelineIcon:"pause",currentIcon:"square",mutableClassButton:"uc-shot-btn uc-camera-action uc-stop-record"}),e===K.STOP&&this.set$({timerHidden:!1,cameraHidden:!0,audioToggleMicrophoneHidden:!0,cameraActionsHidden:!1}),(e===K.RETAKE||e===K.ACCEPT)&&this.set$({timerHidden:!0,tabVideoHidden:!this._cameraModes.includes(T.VIDEO),tabCameraHidden:!this._cameraModes.includes(T.PHOTO),cameraHidden:!1,cameraActionsHidden:!0,audioToggleMicrophoneHidden:!this.cfg.enableAudioRecording,currentIcon:"video-camera-full",mutableClassButton:"uc-shot-btn uc-camera-action",audioSelectHidden:!this.cfg.enableAudioRecording||this._audioDevices.length<=1,cameraSelectHidden:this._cameraDevices.length<=1})});u(this,"_setCameraState",e=>{this._activeTab===T.PHOTO&&(e==="shot"||e==="retake"||e==="accept")&&this._handlePhoto(e),this._activeTab===T.VIDEO&&(e==="play"||e==="stop"||e==="retake"||e==="accept"||e==="pause"||e==="resume")&&this._handleVideo(e)});u(this,"_handleActiveTab",e=>{this.ref.switcher.querySelectorAll("button").forEach(t=>{t.classList.toggle("uc-active",t.getAttribute("data-id")===e)}),e===T.PHOTO&&this.set$({currentIcon:"camera-full",audioSelectHidden:!0,audioToggleMicrophoneHidden:!0}),e===T.VIDEO&&this.set$({currentTimelineIcon:"play",currentIcon:"video-camera-full",audioSelectHidden:!this.cfg.enableAudioRecording||this._audioDevices.length<=1,audioToggleMicrophoneHidden:!this.cfg.enableAudioRecording}),this._activeTab=e});u(this,"_createFile",(e,t,r,n)=>{const o=Date.now(),a=`${e}-${o}.${t}`;return new File([n],a,{lastModified:o,type:r})});u(this,"_toSend",e=>{this.api.addFileFromObject(e,{source:U.CAMERA}),this.set$({"*currentActivity":g.activities.UPLOAD_LIST}),this.modalManager.open(g.activities.UPLOAD_LIST)});u(this,"_setPermissionsState",H(e=>{this.classList.toggle("uc-initialized",e==="granted");const t=this._activeTab===T.VIDEO&&this.cfg.enableAudioRecording,r=this._activeTab===T.PHOTO?"camera-full":"video-camera-full";e==="granted"?this.set$({videoHidden:!1,cameraHidden:!1,tabCameraHidden:!this._cameraModes.includes(T.PHOTO),tabVideoHidden:!this._cameraModes.includes(T.VIDEO),messageHidden:!0,timerHidden:!0,currentIcon:r,audioToggleMicrophoneHidden:!t,audioSelectHidden:!t}):e==="prompt"?(this.$.l10nMessage="camera-permissions-prompt",this.set$({videoHidden:!0,cameraHidden:!0,tabCameraHidden:!0,messageHidden:!1}),this._stopCapture()):(this.$.l10nMessage="camera-permissions-denied",this.set$({videoHidden:!0,messageHidden:!1,tabCameraHidden:!this._cameraModes.includes(T.PHOTO),tabVideoHidden:!this._cameraModes.includes(T.VIDEO),cameraActionsHidden:!0,mutableClassButton:"uc-shot-btn uc-camera-action"}),this._stopCapture())},300));u(this,"_makeStreamInactive",()=>{var r,n;if(!this._stream)return!1;const e=(r=this._stream)==null?void 0:r.getAudioTracks(),t=(n=this._stream)==null?void 0:n.getVideoTracks();e.forEach(o=>o.stop()),t.forEach(o=>o.stop())});u(this,"_stopCapture",()=>{var e;this._capturing&&(this.ref.video.volume=0,(e=this.$.video)==null||e.getTracks()[0].stop(),this.$.video=null,this._makeStreamInactive(),this._stopTimer(),this._capturing=!1)});u(this,"_capture",async()=>{const e={video:ql,audio:this.cfg.enableAudioRecording?{}:!1};this._selectedCameraId&&(e.video={deviceId:{exact:this._selectedCameraId}}),this._selectedAudioId&&this.cfg.enableAudioRecording&&(e.audio={deviceId:{exact:this._selectedAudioId}}),this.ref.video.volume=0;try{this._setPermissionsState("prompt"),this._stream=await navigator.mediaDevices.getUserMedia(e),this._stream.addEventListener("inactive",()=>{this._setPermissionsState("denied")}),this.$.video=this._stream,this._capturing=!0,this._setPermissionsState("granted")}catch(t){this._setPermissionsState("denied"),console.log("Failed to capture camera",t)}});u(this,"_handlePermissionsChange",()=>{this._capture()});u(this,"_permissionAccess",async()=>{try{for(const e of ls)this[`${e}Response`]=await navigator.permissions.query({name:e}),this[`${e}Response`].addEventListener("change",this._handlePermissionsChange)}catch(e){console.log("Failed to use permissions API. Fallback to manual request mode.",e),this._capture()}});u(this,"_getPermission",()=>{});u(this,"_requestDeviceAccess",async()=>{try{await navigator.mediaDevices.getUserMedia({video:!0,audio:this.cfg.enableAudioRecording}),await this._getDevices(),navigator.mediaDevices.addEventListener("devicechange",this._getDevices)}catch(e){console.log("Failed to get user media",e)}});u(this,"_getDevices",async()=>{var e,t;try{const r=await navigator.mediaDevices.enumerateDevices();this._cameraDevices=r.filter(n=>n.kind==="videoinput").map((n,o)=>({text:n.label.trim()||`${this.l10n("caption-camera")} ${o+1}`,value:n.deviceId})),this._audioDevices=this.cfg.enableAudioRecording&&r.filter(n=>n.kind==="audioinput").map(n=>({text:n.label.trim(),value:n.deviceId})),this._cameraDevices.length>1&&this.set$({cameraSelectOptions:this._cameraDevices,cameraSelectHidden:!1}),this._selectedCameraId=(e=this._cameraDevices[0])==null?void 0:e.value,this._audioDevices.length>1&&this.set$({audioSelectOptions:this._audioDevices,audioSelectHidden:!1}),this._selectedAudioId=(t=this._audioDevices[0])==null?void 0:t.value}catch(r){console.log("Failed to get devices",r)}});u(this,"_onActivate",async()=>{await this._permissionAccess(),await this._requestDeviceAccess(),await this._capture(),this._handleCameraModes(this._cameraModes)});u(this,"_onDeactivate",async()=>{this._unsubPermissions&&this._unsubPermissions(),!!window.chrome||this._setPermissionsState("denied"),this._stopCapture()});u(this,"_handleCameraModes",e=>{this.$.tabVideoHidden=!e.includes(T.VIDEO),this.$.tabCameraHidden=!e.includes(T.PHOTO);const t=e[0];(!this._activeTab||!e.includes(this._activeTab))&&this._handleActiveTab(t)});this.init$={...this.init$,video:null,videoTransformCss:null,videoHidden:!0,messageHidden:!0,requestBtnHidden:Wl(),cameraSelectOptions:null,cameraSelectHidden:!0,l10nMessage:"",switcher:null,panels:null,timer:null,timerHidden:!0,cameraHidden:!0,cameraActionsHidden:!0,audioSelectOptions:null,audioSelectHidden:!0,audioSelectDisabled:!0,audioToggleMicrophoneHidden:!0,tabCameraHidden:!0,tabVideoHidden:!0,currentIcon:"camera-full",currentTimelineIcon:"play",toggleMicrophoneIcon:"microphone",_startTime:0,_elapsedTime:0,_animationFrameId:null,mutableClassButton:"uc-shot-btn uc-camera-action",onCameraSelectChange:e=>{this._selectedCameraId=e.target.value,this._capture()},onAudioSelectChange:e=>{this._selectedAudioId=e.target.value,this._capture()},onCancel:()=>{this.historyBack()},onShot:()=>this._shot(),onRequestPermissions:()=>this._capture(),onStartCamera:()=>this._chooseActionWithCamera(),onStartRecording:()=>this._startRecording(),onStopRecording:()=>this._stopRecording(),onToggleRecording:()=>this._toggleRecording(),onToggleAudio:()=>this._toggleEnableAudio(),onRetake:()=>this._retake(),onAccept:()=>this._accept(),onClickTab:e=>{const t=e.currentTarget.getAttribute("data-id");t&&this._handleActiveTab(t)}}}_shot(){if(this._setCameraState("shot"),this._canvas=document.createElement("canvas"),this._ctx=this._canvas.getContext("2d"),!this._ctx)throw new Error("Failed to get canvas context");this._canvas.height=this.ref.video.videoHeight,this._canvas.width=this.ref.video.videoWidth,this.cfg.cameraMirror&&(this._ctx.translate(this._canvas.width,0),this._ctx.scale(-1,1)),this._ctx.drawImage(this.ref.video,0,0),this.ref.video.pause()}_guessExtensionByMime(e){const t={mp4:"mp4",ogg:"ogg",webm:"webm",quicktime:"mov","x-matroska":"mkv"};if(e==="")return"webm";if(e&&(e=e.split("/"),(e==null?void 0:e[0])==="video")){e=e.slice(1).join("/");const r=e==null?void 0:e.split(";")[0];if(t[r])return t[r]}return"avi"}get _cameraModes(){return le(this.cfg.cameraModes)}initCallback(){super.initCallback(),this.registerActivity(this.activityType,{onActivate:this._onActivate,onDeactivate:this._onDeactivate}),this.subConfigValue("cameraMirror",e=>{this.$.videoTransformCss=e?"scaleX(-1)":null}),this.subConfigValue("enableAudioRecording",e=>{this.$.audioToggleMicrophoneHidden=!e,this.$.audioSelectDisabled=!e}),this.subConfigValue("cameraModes",e=>{if(!this.isActivityActive)return;const t=be(e);this._handleCameraModes(t)})}_destroy(){var e,t;for(const r of ls)(e=this[`${r}Response`])==null||e.removeEventListener("change",this._handlePermissionsChange);(t=navigator.mediaDevices)==null||t.removeEventListener("devicechange",this._getDevices)}async destroyCallback(){super.destroyCallback(),this._destroy()}}mr.template=`
  <uc-activity-header>
    <button type="button" class="uc-mini-btn" set="onclick: *historyBack" l10n="@title:back">
      <uc-icon name="back"></uc-icon>
    </button>
    <div set="@hidden: !cameraSelectHidden">
      <uc-icon name="camera"></uc-icon>
      <span l10n="caption-camera"></span>
    </div>
    <uc-select
      class="uc-camera-select"
      set="$.options: cameraSelectOptions; @hidden: cameraSelectHidden; onchange: onCameraSelectChange"
    >
    </uc-select>
    <button
      type="button"
      class="uc-mini-btn uc-close-btn"
      set="onclick: *closeModal"
      l10n="@title:a11y-activity-header-button-close;@aria-label:a11y-activity-header-button-close"
    >
      <uc-icon name="close"></uc-icon>
    </button>
  </uc-activity-header>
  <div class="uc-content">
    <video
      muted
      autoplay
      playsinline
      set="srcObject: video; style.transform: videoTransformCss; @hidden: videoHidden"
      ref="video"
    ></video>
    <div class="uc-message-box" set="@hidden: messageHidden">
      <span l10n="l10nMessage"></span>
      <button
        type="button"
        set="onclick: onRequestPermissions; @hidden: requestBtnHidden"
        l10n="camera-permissions-request"
      ></button>
    </div>
  </div>

  <div class="uc-controls">
    <div ref="switcher" class="uc-switcher" set="@hidden:!timerHidden">
      <button
        data-id="photo"
        type="button"
        class="uc-switch uc-mini-btn"
        set="onclick: onClickTab;  @hidden: tabCameraHidden"
      >
        <uc-icon name="camera"></uc-icon>
      </button>
      <button
        data-id="video"
        type="button"
        class="uc-switch uc-mini-btn"
        set="onclick: onClickTab; @hidden: tabVideoHidden"
      >
        <uc-icon name="video-camera"></uc-icon>
      </button>
    </div>

    <button class="uc-secondary-btn uc-recording-timer" set="@hidden:timerHidden; onclick: onToggleRecording">
      <uc-icon set="@name: currentTimelineIcon"></uc-icon>
      <span ref="timer"> 00:00 </span>
      <span ref="line" class="uc-line"></span>
    </button>

    <div class="uc-camera-actions uc-camera-action" set="@hidden: cameraActionsHidden">
      <button type="button" class="uc-secondary-btn" set="onclick: onRetake">Retake</button>
      <button type="button" class="uc-primary-btn" set="onclick: onAccept">Accept</button>
    </div>

    <button
      type="button"
      class="uc-shot-btn uc-camera-action"
      set="onclick: onStartCamera; @class: mutableClassButton; @hidden: cameraHidden;"
    >
      <uc-icon set="@name: currentIcon"></uc-icon>
    </button>

    <div class="uc-select">
      <button class="uc-mini-btn uc-btn-microphone" set="onclick: onToggleAudio; @hidden: audioToggleMicrophoneHidden;">
        <uc-icon set="@name:toggleMicrophoneIcon"></uc-icon>
      </button>

      <uc-select
        class="uc-audio-select"
        set="$.options: audioSelectOptions; onchange: onAudioSelectChange; @hidden: audioSelectHidden; @disabled: audioSelectDisabled"
      >
      </uc-select>
    </div>
  </div>
`;class gr extends R{constructor(){super(...arguments);u(this,"requireCtxName",!0)}initCallback(){super.initCallback(),this.$["*eventEmitter"].bindTarget(this)}destroyCallback(){super.destroyCallback(),this.$["*eventEmitter"].unbindTarget(this)}}gr.EventType=k;const di=gr;class br extends R{constructor(){super(...arguments);u(this,"init$",{...this.init$,visible:!1,value:0,"*commonProgress":0})}initCallback(){super.initCallback(),this._unobserveCollection=this.uploadCollection.observeProperties(()=>{let e=this.uploadCollection.items().some(t=>this.uploadCollection.read(t).getValue("isUploading"));this.$.visible=e}),this.sub("visible",e=>{e?this.setAttribute("active",""):this.removeAttribute("active")}),this.sub("*commonProgress",e=>{this.$.value=e})}destroyCallback(){var e;super.destroyCallback(),(e=this._unobserveCollection)==null||e.call(this)}}br.template=' <uc-progress-bar set="visible: visible; value: value"></uc-progress-bar> ';class _r extends I{constructor(){super();u(this,"_value",0);u(this,"_prevValue",0);u(this,"_visible",!0);this.init$={...this.init$,width:0,opacity:0}}initCallback(){super.initCallback();const e=()=>{const t=this.ref.fakeProgressLine;if(!this._visible){t.classList.add("uc-fake-progress--hidden");return}this._value>0&&t.classList.add("uc-fake-progress--hidden")};this.ref.fakeProgressLine.addEventListener("animationiteration",e),this.defineAccessor("value",t=>{t!=null&&(this._prevValue=this._value,this._value=t,this._visible&&this.style.setProperty("--l-progress-value",this._value.toString()))}),this.defineAccessor("visible",t=>{this._visible=t,this.classList.toggle("uc-progress-bar--hidden",!t)})}}_r.template=`
  <div ref="fakeProgressLine" class="uc-fake-progress"></div>
  <div ref="realProgressLine" class="uc-progress"></div>
`;const Pe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=";function vr(...s){return s.reduce((i,e)=>{if(typeof e=="string")return i[e]=!0,i;for(let t of Object.keys(e))i[t]=e[t];return i},{})}function Y(...s){let i=vr(...s);return Object.keys(i).reduce((e,t)=>(i[t]&&e.push(t),e),[]).join(" ")}function Xl(s,...i){let e=vr(...i);for(let t of Object.keys(e))s.classList.toggle(t,e[t])}const Zl=s=>{if(!s)return se;const i=be(s).filter(e=>se.includes(e));return i.length===0?se:i};function Kl(s){return{"*originalUrl":null,"*faderEl":null,"*cropperEl":null,"*imgEl":null,"*imgContainerEl":null,"*networkProblems":!1,"*imageSize":null,"*editorTransformations":{},"*cropPresetList":[],"*tabList":se,"*tabId":O.CROP,entry:null,extension:null,editorMode:!1,modalCaption:"",isImage:!1,msg:"",src:Pe,fileType:"",showLoader:!1,uuid:null,cdnUrl:null,cropPreset:"",tabs:it(se),"presence.networkProblems":!1,"presence.modalCaption":!0,"presence.editorToolbar":!1,"presence.viewerToolbar":!0,"*on.retryNetwork":()=>{let i=s.querySelectorAll("img");for(let e of i){let t=e.src;e.src=Pe,e.src=t}s.$["*networkProblems"]=!1},"*on.apply":i=>{if(!i)return;let e=s.$["*originalUrl"],t=ge(Lt(i),"preview"),r=X(e,t),n={originalUrl:e,cdnUrlModifiers:t,cdnUrl:r,transformations:i};s.dispatchEvent(new CustomEvent("apply",{detail:n,bubbles:!0,composed:!0})),s.remove()},"*on.cancel":()=>{s.remove(),s.dispatchEvent(new CustomEvent("cancel",{bubbles:!0,composed:!0}))}}}const Yl="<svg width='0' height='0' style='position:absolute'><symbol viewBox='0 0 20 20' id='uc-icon-brightness' xmlns='http://www.w3.org/2000/svg'><path stroke-linejoin='round' fill='none' stroke='currentColor' stroke-width='1.2' d='M15 10a5 5 0 0 1-5 5m5-5a5 5 0 0 0-5-5m5 5h-5m0 5a5 5 0 0 1 0-10m0 10V5m0 15v-3M2.93 2.929 5.05 5.05M0 10h3m-.07 7.071 2.12-2.121M10 0v3m7.07 14.071-2.12-2.121M20 10h-3m.07-7.071L14.95 5.05m-.626 2.45H10m4.324 5H10'/></symbol><symbol fill='currentColor' viewBox='0 0 20 20' id='uc-icon-closeMax' xmlns='http://www.w3.org/2000/svg'><path fill-rule='evenodd' d='M8.232 10 3.585 5.353l1.768-1.768L10 8.232l4.648-4.647 1.767 1.768L11.768 10l4.647 4.648-1.767 1.767L10 11.768l-4.647 4.647-1.768-1.767L8.232 10Z' clip-rule='evenodd'/></symbol><symbol viewBox='0 0 20 20' id='uc-icon-contrast' xmlns='http://www.w3.org/2000/svg'><path stroke-linejoin='round' fill='none' stroke='currentColor' stroke-width='1.2' d='M2 10a8 8 0 1 0 16 0 8 8 0 1 0-16 0m8-8v16m8-8h-8m7.598 2.5H10m6.24 2.5H10m7.6-7.5H10M16.242 5H10'/></symbol><symbol viewBox='0 0 20 20' id='uc-icon-crop' xmlns='http://www.w3.org/2000/svg'><path stroke-linejoin='round' fill='none' stroke='currentColor' stroke-width='1.2' d='M20 14H7.005C6.45 14 6 13.55 6 12.995V0M0 6h13.067c.515 0 .933.418.933.933V20M14.5.4 13 2l1.5 1.6M13 2h2a3 3 0 0 1 3 3v2M5.5 19.6 7 18l-1.5-1.6M7 18H5a3 3 0 0 1-3-3v-2'/></symbol><symbol fill='currentColor' viewBox='0 0 20 20' id='uc-icon-done' xmlns='http://www.w3.org/2000/svg'><path fill-rule='evenodd' d='m18.057 6.333-9.365 9.125a1.25 1.25 0 0 1-1.768-.023L1.92 10.296l1.791-1.744 4.132 4.243 8.47-8.253 1.744 1.79Z' clip-rule='evenodd'/></symbol><symbol fill='currentColor' viewBox='0 0 25 24' id='uc-icon-edit-file' xmlns='http://www.w3.org/2000/svg'><path fill-rule='evenodd' d='M18.558 2.804a.78.78 0 0 0-.557.235l-.008.007-2.472 2.46 3.847 3.848 2.46-2.473.004-.003a.78.78 0 0 0 0-1.108l-.004-.003-2.712-2.728a.78.78 0 0 0-.558-.235Zm-.248 7.613-3.852-3.852-8.93 8.887-1.516 5.41 5.41-1.515 8.888-8.93Zm-.636-8.934a2.28 2.28 0 0 1 2.512.505l2.702 2.717.002.002a2.278 2.278 0 0 1 0 3.234l-.002.002-12.541 12.602a.75.75 0 0 1-.33.193l-6.884 1.928a.75.75 0 0 1-.925-.924l1.928-6.885a.75.75 0 0 1 .193-.33l12.603-12.54a2.28 2.28 0 0 1 .742-.504Z' clip-rule='evenodd'/></symbol><symbol viewBox='0 0 20 20' id='uc-icon-enhance' xmlns='http://www.w3.org/2000/svg'><path stroke-linejoin='round' fill='none' stroke='currentColor' stroke-width='1.2' d='M19 13h-2m0 0a4 4 0 0 1-4-4m4 4a4 4 0 0 0-4 4m0-8V7m0 2a4 4 0 0 1-4 4m-2 0h2m0 0a4 4 0 0 1 4 4m0 0v2M8 8.5H6.5m0 0a2 2 0 0 1-2-2m2 2a2 2 0 0 0-2 2m0-4V5m0 1.5a2 2 0 0 1-2 2M1 8.5h1.5m0 0a2 2 0 0 1 2 2m0 0V12M12 3h-1m0 0a1 1 0 0 1-1-1m1 1a1 1 0 0 0-1 1m0-2V1m0 1a1 1 0 0 1-1 1M8 3h1m0 0a1 1 0 0 1 1 1m0 0v1'/></symbol><symbol viewBox='0 0 20 20' id='uc-icon-exposure' xmlns='http://www.w3.org/2000/svg'><path stroke-linejoin='round' fill='none' stroke='currentColor' stroke-width='1.2' d='M10 20v-3M2.93 2.929 5.05 5.05M0 10h3m-.07 7.071 2.12-2.121M10 0v3m7.07 14.071-2.12-2.121M20 10h-3m.07-7.071L14.95 5.05M5 10a5 5 0 1 0 10 0 5 5 0 1 0-10 0'/></symbol><symbol viewBox='0 0 20 20' id='uc-icon-filters' xmlns='http://www.w3.org/2000/svg'><path stroke-linejoin='round' fill='none' stroke='currentColor' stroke-width='1.2' d='M4.5 6.5a5.5 5.5 0 1 0 11 0 5.5 5.5 0 1 0-11 0m-3.5 6a5.5 5.5 0 1 0 11 0 5.5 5.5 0 1 0-11 0m7 0a5.5 5.5 0 1 0 11 0 5.5 5.5 0 1 0-11 0'/></symbol><symbol viewBox='0 0 20 20' id='uc-icon-flip' xmlns='http://www.w3.org/2000/svg'><path stroke-linejoin='round' fill='none' stroke='currentColor' stroke-width='1.2' d='M19.6 5 18 3.5 16.4 5m3.2 10L18 16.5 16.4 15M18 3.523v12.954M3.3 8.5h10.654c.301 0 .415-.395.159-.554L3.459 1.286A.3.3 0 0 0 3 1.542V8.2a.3.3 0 0 0 .3.3zm0 3h10.654c.301 0 .415.395.159.554l-10.654 6.66A.3.3 0 0 1 3 18.458v-6.66a.3.3 0 0 1 .3-.3z'/></symbol><symbol viewBox='0 0 20 20' id='uc-icon-gamma' xmlns='http://www.w3.org/2000/svg'><path stroke-linejoin='round' fill='none' stroke='currentColor' stroke-width='1.2' d='M17 3C9 6 2.5 11.5 2.5 17.5m0 0h1m-1 0v-1m14 1h1m-3 0h1m-3 0h1m-3 0h1m-3 0h1m-3 0h1m-3 0h1m-3-14v-1m0 3v-1m0 3v-1m0 3v-1m0 3v-1m0 3v-1m0 3v-1'/></symbol><symbol viewBox='0 0 20 20' id='uc-icon-mirror' xmlns='http://www.w3.org/2000/svg'><path stroke-linejoin='round' fill='none' stroke='currentColor' stroke-width='1.2' d='M5 .4 3.5 2 5 3.6M15 .4 16.5 2 15 3.6M3.52 2h12.957M8.5 16.7V6.046c0-.301-.394-.415-.554-.159L1.287 16.541a.3.3 0 0 0 .255.459H8.2a.3.3 0 0 0 .3-.3zm3 0V6.046c0-.301.395-.415.555-.159l6.659 10.654a.3.3 0 0 1-.255.459H11.8a.3.3 0 0 1-.3-.3z'/></symbol><symbol viewBox='0 0 40 40' id='uc-icon-original' xmlns='http://www.w3.org/2000/svg'><path stroke-linejoin='round' fill='none' stroke='currentColor' stroke-width='1.5' d='M0 40 40 0'/></symbol><symbol viewBox='0 0 20 20' id='uc-icon-rotate' xmlns='http://www.w3.org/2000/svg'><path stroke-linejoin='round' fill='none' stroke='currentColor' stroke-width='1.2' d='M13.5.4 12 2l1.5 1.6M12.023 2H14.4A3.6 3.6 0 0 1 18 5.6V8M4 17h9a1 1 0 0 0 1-1V7a1 1 0 0 0-1-1H4a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1z'/></symbol><symbol viewBox='0 0 20 20' id='uc-icon-sad' xmlns='http://www.w3.org/2000/svg'><path stroke-linejoin='round' fill='none' stroke='currentColor' stroke-width='1.2' d='M2 17c4.418-4 11.582-4 16 0M16.5 5a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm-11 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0z'/></symbol><symbol viewBox='0 0 20 20' id='uc-icon-saturation' xmlns='http://www.w3.org/2000/svg'><defs><linearGradient id='puc-icon-id__a' x1='10.001' y1='1' x2='10.001' y2='19' gradientUnits='userSpaceOnUse'><stop stop-color='#DE15FF'/><stop offset='.203' stop-color='#0029FF'/><stop offset='.479' stop-color='#2AE4F0'/><stop offset='.604' stop-color='#15EF11'/><stop offset='.75' stop-color='#FAE528'/><stop offset='1' stop-color='#EB2A2A'/></linearGradient></defs><circle cx='10.001' cy='10' r='9' transform='rotate(90 10 10)' fill='url(#puc-icon-id__a)'/></symbol><symbol viewBox='0 0 20 20' id='uc-icon-slider' xmlns='http://www.w3.org/2000/svg'><path stroke-linejoin='round' fill='none' stroke='currentColor' stroke-width='1.2' d='M0 10h11m0 0a2 2 0 1 0 4 0m-4 0a2 2 0 1 1 4 0m0 0h5'/></symbol><symbol viewBox='0 0 20 20' id='uc-icon-tuning' xmlns='http://www.w3.org/2000/svg'><path stroke-linejoin='round' fill='none' stroke='currentColor' stroke-width='1.2' d='M8 10h11M1 10h4M1 4.5h11m3 0h4m-18 11h11m3 0h4m-7-11a1.5 1.5 0 1 0 3 0 1.5 1.5 0 1 0-3 0M5 10a1.5 1.5 0 1 0 3 0 1.5 1.5 0 1 0-3 0m7 5.5a1.5 1.5 0 1 0 3 0 1.5 1.5 0 1 0-3 0'/></symbol><symbol viewBox='0 0 20 20' id='uc-icon-vibrance' xmlns='http://www.w3.org/2000/svg'><path d='M2.125 5.64A8.96 8.96 0 0 0 1.001 10a8.96 8.96 0 0 0 1.124 4.36V5.64z' fill='url(#suc-icon-id__a)'/><path d='M2.875 15.499V4.502a9.053 9.053 0 0 1 1.75-1.72v14.437a9.05 9.05 0 0 1-1.75-1.72z' fill='url(#suc-icon-id__b)'/><path d='M5.375 17.722c.548.33 1.134.601 1.75.809V1.469a8.956 8.956 0 0 0-1.75.81v15.443z' fill='url(#suc-icon-id__c)'/><path d='M7.875 1.253v17.495c.564.136 1.15.22 1.75.244V1.008a9 9 0 0 0-1.75.245z' fill='url(#suc-icon-id__d)'/><path d='M10.375 1.008v17.984a9 9 0 0 0 1.75-.244V1.252a9 9 0 0 0-1.75-.244z' fill='url(#suc-icon-id__e)'/><path d='M12.875 1.469V18.53a8.957 8.957 0 0 0 1.75-.808V2.277a8.957 8.957 0 0 0-1.75-.808z' fill='url(#suc-icon-id__f)'/><path d='M15.375 2.78v14.44a9.053 9.053 0 0 0 1.75-1.72v-11a9.054 9.054 0 0 0-1.75-1.72z' fill='url(#suc-icon-id__g)'/><path d='M17.875 5.638v8.724A8.959 8.959 0 0 0 19.001 10a8.96 8.96 0 0 0-1.126-4.362z' fill='url(#suc-icon-id__h)'/><defs><linearGradient id='suc-icon-id__a' x1='19.001' y1='10' x2='1.001' y2='10' gradientUnits='userSpaceOnUse'><stop stop-color='#DE15FF'/><stop offset='.203' stop-color='#0029FF'/><stop offset='.479' stop-color='#2AE4F0'/><stop offset='.604' stop-color='#15EF11'/><stop offset='.75' stop-color='#FAE528'/><stop offset='1' stop-color='#EB2A2A'/></linearGradient><linearGradient id='suc-icon-id__b' x1='19.001' y1='10' x2='1.001' y2='10' gradientUnits='userSpaceOnUse'><stop stop-color='#DE15FF'/><stop offset='.203' stop-color='#0029FF'/><stop offset='.479' stop-color='#2AE4F0'/><stop offset='.604' stop-color='#15EF11'/><stop offset='.75' stop-color='#FAE528'/><stop offset='1' stop-color='#EB2A2A'/></linearGradient><linearGradient id='suc-icon-id__c' x1='19.001' y1='10' x2='1.001' y2='10' gradientUnits='userSpaceOnUse'><stop stop-color='#DE15FF'/><stop offset='.203' stop-color='#0029FF'/><stop offset='.479' stop-color='#2AE4F0'/><stop offset='.604' stop-color='#15EF11'/><stop offset='.75' stop-color='#FAE528'/><stop offset='1' stop-color='#EB2A2A'/></linearGradient><linearGradient id='suc-icon-id__d' x1='19.001' y1='10' x2='1.001' y2='10' gradientUnits='userSpaceOnUse'><stop stop-color='#DE15FF'/><stop offset='.203' stop-color='#0029FF'/><stop offset='.479' stop-color='#2AE4F0'/><stop offset='.604' stop-color='#15EF11'/><stop offset='.75' stop-color='#FAE528'/><stop offset='1' stop-color='#EB2A2A'/></linearGradient><linearGradient id='suc-icon-id__e' x1='19.001' y1='10' x2='1.001' y2='10' gradientUnits='userSpaceOnUse'><stop stop-color='#DE15FF'/><stop offset='.203' stop-color='#0029FF'/><stop offset='.479' stop-color='#2AE4F0'/><stop offset='.604' stop-color='#15EF11'/><stop offset='.75' stop-color='#FAE528'/><stop offset='1' stop-color='#EB2A2A'/></linearGradient><linearGradient id='suc-icon-id__f' x1='19.001' y1='10' x2='1.001' y2='10' gradientUnits='userSpaceOnUse'><stop stop-color='#DE15FF'/><stop offset='.203' stop-color='#0029FF'/><stop offset='.479' stop-color='#2AE4F0'/><stop offset='.604' stop-color='#15EF11'/><stop offset='.75' stop-color='#FAE528'/><stop offset='1' stop-color='#EB2A2A'/></linearGradient><linearGradient id='suc-icon-id__g' x1='19.001' y1='10' x2='1.001' y2='10' gradientUnits='userSpaceOnUse'><stop stop-color='#DE15FF'/><stop offset='.203' stop-color='#0029FF'/><stop offset='.479' stop-color='#2AE4F0'/><stop offset='.604' stop-color='#15EF11'/><stop offset='.75' stop-color='#FAE528'/><stop offset='1' stop-color='#EB2A2A'/></linearGradient><linearGradient id='suc-icon-id__h' x1='19.001' y1='10' x2='1.001' y2='10' gradientUnits='userSpaceOnUse'><stop stop-color='#DE15FF'/><stop offset='.203' stop-color='#0029FF'/><stop offset='.479' stop-color='#2AE4F0'/><stop offset='.604' stop-color='#15EF11'/><stop offset='.75' stop-color='#FAE528'/><stop offset='1' stop-color='#EB2A2A'/></linearGradient></defs></symbol><symbol viewBox='0 0 20 20' id='uc-icon-warmth' xmlns='http://www.w3.org/2000/svg'><path d='m7.5 13.05.429.42.171-.175v-.244h-.6zm5 0h-.6v.245l.172.175.428-.42zM8.1 3.5c0-1.05.85-1.9 1.9-1.9V.4a3.1 3.1 0 0 0-3.1 3.1h1.2zm0 9.55V3.5H6.9v9.55h1.2zm-1 2.45c0-.79.315-1.506.829-2.03l-.858-.84A4.088 4.088 0 0 0 5.9 15.5h1.2zm2.9 2.9a2.9 2.9 0 0 1-2.9-2.9H5.9a4.1 4.1 0 0 0 4.1 4.1v-1.2zm2.9-2.9a2.9 2.9 0 0 1-2.9 2.9v1.2a4.1 4.1 0 0 0 4.1-4.1h-1.2zm-.829-2.03c.514.524.829 1.24.829 2.03h1.2c0-1.117-.447-2.13-1.171-2.87l-.858.84zM11.9 3.5v9.55h1.2V3.5h-1.2zM10 1.6c1.05 0 1.9.85 1.9 1.9h1.2A3.1 3.1 0 0 0 10 .4v1.2z' fill='currentColor'/><path d='M10 14V8' stroke='currentColor' stroke-width='1.2' stroke-linecap='round'/><path d='M14 3h3m-3 3h3m-3 3h3m-8 6.5a1 1 0 1 0 2 0 1 1 0 1 0-2 0' stroke='currentColor' stroke-width='1.2'/></symbol></svg>",Jl=`
  ${Yl}
  <div class="uc-wrapper uc-wrapper_desktop">
    <uc-presence-toggle class="uc-network_problems_splash" set="visible: presence.networkProblems;">
      <div class="uc-network_problems_content">
        <div class="uc-network_problems_icon">
          <uc-icon name="sad"></uc-icon>
        </div>
        <div class="uc-network_problems_text">Network error</div>
      </div>
      <div class="uc-network_problems_footer">
        <uc-btn-ui theme="primary" text="Retry" set="onclick: *on.retryNetwork"></uc-btn-ui>
      </div>
    </uc-presence-toggle>
    <div class="uc-viewport">
      <div class="uc-file_type_outer">
        <div class="uc-file_type">{{fileType}}</div>
      </div>
      <div class="uc-image_container" ref="img-container-el">
        <img src="${Pe}" class="uc-image uc-image_visible_from_editor" ref="img-el" />
        <uc-editor-image-cropper ref="cropper-el"></uc-editor-image-cropper>
        <uc-editor-image-fader ref="fader-el"></uc-editor-image-fader>
      </div>
      <div class="uc-info_pan">{{msg}}</div>
    </div>
    <div class="uc-toolbar">
      <uc-line-loader-ui set="active: showLoader"></uc-line-loader-ui>
      <div class="uc-toolbar_content uc-toolbar_content__editor">
        <uc-editor-toolbar></uc-editor-toolbar>
      </div>
    </div>
  </div>
`;class Ve extends I{constructor(){super();u(this,"ctxOwner",!0);u(this,"_debouncedShowLoader",H(this._showLoader.bind(this),300));this.init$={...this.init$,...Kl(this)}}_showLoader(e){this.$.showLoader=e}_waitForSize(){return new Promise((t,r)=>{const n=setTimeout(()=>{r(new Error("[cloud-image-editor] timeout waiting for non-zero container size"))},3e3),o=new ResizeObserver(([a])=>{a.contentRect.width>0&&a.contentRect.height>0&&(t(),clearTimeout(n),o.disconnect())});o.observe(this)})}initCallback(){super.initCallback(),this.$["*faderEl"]=this.ref["fader-el"],this.$["*cropperEl"]=this.ref["cropper-el"],this.$["*imgContainerEl"]=this.ref["img-container-el"],this.initEditor()}async updateImage(){if(this.isConnected){if(await this._waitForSize(),this.$.cdnUrl){const e=Es(this.$.cdnUrl),t=tt(this.$.cdnUrl,e);if(t===this.$["*originalUrl"])return;this.$["*originalUrl"]=t;const r=un(this.$.cdnUrl),n=mn(r);this.$["*editorTransformations"]=n}else if(this.$.uuid){const e=tt(this.cfg.cdnCname,this.$.uuid);if(e===this.$["*originalUrl"])return;this.$["*originalUrl"]=e,this.$["*editorTransformations"]={}}else throw new Error("No UUID nor CDN URL provided");this.$["*tabId"]===O.CROP?this.$["*cropperEl"].deactivate({reset:!0}):this.$["*faderEl"].deactivate();try{const e=await this.proxyUrl(X(this.$["*originalUrl"],ge("json"))),t=await fetch(e).then(o=>o.json()),{width:r,height:n}=t;this.$["*imageSize"]={width:r,height:n},this.$["*tabId"]===O.CROP?this.$["*cropperEl"].activate(this.$["*imageSize"]):this.$["*faderEl"].activate({url:this.$["*originalUrl"]})}catch(e){e&&console.error("Failed to load image info",e)}}}async initEditor(){try{await this._waitForSize()}catch(e){this.isConnected&&console.error(e.message);return}this.ref["img-el"].addEventListener("load",()=>{this._imgLoading=!1,this._debouncedShowLoader(!1),this.$.src!==Pe&&(this.$["*networkProblems"]=!1)}),this.ref["img-el"].addEventListener("error",()=>{this._imgLoading=!1,this._debouncedShowLoader(!1),this.$["*networkProblems"]=!0}),this.sub("src",e=>{let t=this.ref["img-el"];t.src!==e&&(this._imgLoading=!0,t.src=e||Pe)}),this.sub("cropPreset",e=>{this.$["*cropPresetList"]=Zs(e)}),this.sub("tabs",e=>{this.$["*tabList"]=Zl(e)}),this.sub("*tabId",e=>{this.ref["img-el"].className=Y("uc-image",{"uc-image_hidden_to_cropper":e===O.CROP,"uc-image_hidden_effects":e!==O.CROP})}),this.classList.add("uc-editor_ON"),this.sub("*networkProblems",e=>{this.$["presence.networkProblems"]=e,this.$["presence.modalCaption"]=!e}),this.sub("*editorTransformations",e=>{if(Object.keys(e).length===0)return;let t=this.$["*originalUrl"],r=ge(Lt(e),"preview"),n=X(t,r),o={originalUrl:t,cdnUrlModifiers:r,cdnUrl:n,transformations:e};this.dispatchEvent(new CustomEvent("change",{detail:o,bubbles:!0,composed:!0}))},!1),this.sub("uuid",e=>e&&this.updateImage()),this.sub("cdnUrl",e=>e&&this.updateImage())}}u(Ve,"styleAttrs",["uc-cloud-image-editor"]);Ve.template=Jl;Ve.bindAttributes({uuid:"uuid","cdn-url":"cdnUrl","crop-preset":"cropPreset",tabs:"tabs"});class yr extends I{constructor(){super(),this.init$={...this.init$,dragging:!1},this._handlePointerUp=this._handlePointerUp_.bind(this),this._handlePointerMove=this._handlePointerMove_.bind(this),this._handleSvgPointerMove=this._handleSvgPointerMove_.bind(this)}_shouldThumbBeDisabled(i){let e=this.$["*imageBox"];if(!e)return;if(i===""&&e.height<=E&&e.width<=E)return!0;let t=e.height<=E&&(i.includes("n")||i.includes("s")),r=e.width<=E&&(i.includes("e")||i.includes("w"));return t||r}_createBackdrop(){let i=this.$["*cropBox"];if(!i)return;let{x:e,y:t,width:r,height:n}=i,o=this.ref["svg-el"],a=G("mask",{id:"backdrop-mask"}),l=G("rect",{x:0,y:0,width:"100%",height:"100%",fill:"white"}),c=G("rect",{x:e,y:t,width:r,height:n,fill:"black"});a.appendChild(l),a.appendChild(c);let d=G("rect",{x:0,y:0,width:"100%",height:"100%",fill:"var(--color-image-background)","fill-opacity":.85,mask:"url(#backdrop-mask)"});o.appendChild(d),o.appendChild(a),this._backdropMask=a,this._backdropMaskInner=c}_resizeBackdrop(){this._backdropMask&&(this._backdropMask.style.display="none",window.requestAnimationFrame(()=>{this._backdropMask&&(this._backdropMask.style.display="block")}))}_updateBackdrop(){let i=this.$["*cropBox"];if(!i)return;let{x:e,y:t,width:r,height:n}=i;this._backdropMaskInner&&Ce(this._backdropMaskInner,{x:e,y:t,width:r,height:n})}_updateFrame(){let i=this.$["*cropBox"];if(!(!i||!this._frameGuides||!this._frameThumbs)){for(let e of Object.values(this._frameThumbs)){let{direction:t,pathNode:r,interactionNode:n,groupNode:o}=e,a=t==="",l=t.length===2,{x:c,y:d,width:h,height:f}=i;if(a)Ce(n,{x:c,y:d,width:h,height:f});else{const p=$e(Math.min(h,f)/(ui*2+qe)/2,0,1);let{d:b,center:v}=l?Ko(i,t,p):Yo(i,t,p);const C=Math.max(ji*$e(Math.min(h,f)/ji/3,0,1),Zo);Ce(n,{x:v[0]-C,y:v[1]-C,width:C*2,height:C*2}),Ce(r,{d:b})}let m=this._shouldThumbBeDisabled(t);o.setAttribute("class",Y("uc-thumb",{"uc-thumb--hidden":m,"uc-thumb--visible":!m}))}Ce(this._frameGuides,{x:i.x-ye*.5,y:i.y-ye*.5,width:i.width+ye,height:i.height+ye})}}_createThumb(i,e){let t=G("g");t.classList.add("uc-thumb"),t.setAttribute("with-effects","");let r=G("rect",{fill:"transparent"}),n=G("path",{stroke:"currentColor",fill:"none","stroke-width":Xs});t.appendChild(n),t.appendChild(r),i[e]={direction:e,pathNode:n,interactionNode:r,groupNode:t},e===""&&(t.style.cursor="move"),r.addEventListener("pointerdown",this._handlePointerDown.bind(this,e))}_createThumbs(){const i={};for(let e=0;e<3;e++)for(let t=0;t<3;t++){let r=`${["n","","s"][e]}${["w","","e"][t]}`;r!==""&&this._createThumb(i,r)}return this._createThumb(i,""),i}_createGuides(){let i=G("svg"),e=G("rect",{x:0,y:0,width:"100%",height:"100%",fill:"none",stroke:"currentColor","stroke-width":ye,"stroke-opacity":.5});i.appendChild(e);for(let t=1;t<=2;t++){let r=G("line",{x1:`${ft*t}%`,y1:"0%",x2:`${ft*t}%`,y2:"100%",stroke:"currentColor","stroke-width":ye,"stroke-opacity":.3});i.appendChild(r)}for(let t=1;t<=2;t++){let r=G("line",{x1:"0%",y1:`${ft*t}%`,x2:"100%",y2:`${ft*t}%`,stroke:"currentColor","stroke-width":ye,"stroke-opacity":.3});i.appendChild(r)}return i.classList.add("uc-guides","uc-guides--semi-hidden"),i}_createFrame(){let i=this.ref["svg-el"],e=document.createDocumentFragment(),t=this._createGuides();e.appendChild(t);let r=this._createThumbs();for(let{groupNode:n}of Object.values(r))e.appendChild(n);i.appendChild(e),this._frameThumbs=r,this._frameGuides=t}_handlePointerDown(i,e){if(!this._frameThumbs)return;let t=this._frameThumbs[i];if(this._shouldThumbBeDisabled(i))return;let r=this.$["*cropBox"],{x:n,y:o}=this.ref["svg-el"].getBoundingClientRect(),a=e.x-n,l=e.y-o;this.$.dragging=!0,this._draggingThumb=t,this._dragStartPoint=[a,l],this._dragStartCrop={...r}}_handlePointerUp_(i){this._updateCursor(),this.$.dragging&&(i.stopPropagation(),i.preventDefault(),this.$.dragging=!1)}_handlePointerMove_(i){if(!this.$.dragging||!this._dragStartPoint||!this._draggingThumb)return;i.stopPropagation(),i.preventDefault();let e=this.ref["svg-el"],{x:t,y:r}=e.getBoundingClientRect(),n=i.x-t,o=i.y-r,a=n-this._dragStartPoint[0],l=o-this._dragStartPoint[1],{direction:c}=this._draggingThumb;const d=this._calcCropBox(c,[a,l]);d&&(this.$["*cropBox"]=d)}_calcCropBox(i,e){var c;const[t,r]=e;let n=this.$["*imageBox"],o=this._dragStartCrop??this.$["*cropBox"];const a=(c=this.$["*cropPresetList"])==null?void 0:c[0],l=a?a.width/a.height:void 0;if(i===""?o=Qo({rect:o,delta:[t,r],imageBox:n}):o=la({rect:o,delta:[t,r],direction:i,aspectRatio:l,imageBox:n}),!Object.values(o).every(d=>Number.isFinite(d)&&d>=0)){console.error("CropFrame is trying to create invalid rectangle",{payload:o});return}return St(Ct(o),this.$["*imageBox"])}_handleSvgPointerMove_(i){if(!this._frameThumbs)return;let e=Object.values(this._frameThumbs).find(t=>{if(this._shouldThumbBeDisabled(t.direction))return!1;let n=t.interactionNode.getBoundingClientRect(),o={x:n.x,y:n.y,width:n.width,height:n.height};return ca(o,[i.x,i.y])});this._hoverThumb=e,this._updateCursor()}_updateCursor(){let i=this._hoverThumb;this.ref["svg-el"].style.cursor=i?Jo(i.direction):"initial"}_createMask(i){if(this._frameImage){this._frameImage.setAttribute("href",i);return}let e=this.ref["svg-el"],t=document.createDocumentFragment(),r=G("image",{href:i});r.setAttribute("class","uc-cloud-mask"),t.appendChild(r),e.appendChild(t),this._frameImage=r}_updateMask(){let i=this.$["*cropBox"];if(!i||!this._frameImage)return;let{x:e,y:t,width:r,height:n}=i;Ce(this._frameImage,{x:e,y:t,height:n,width:r})}_render(){this._updateBackdrop(),this._updateFrame(),this._updateMask()}toggleThumbs(i){this._frameThumbs&&Object.values(this._frameThumbs).map(({groupNode:e})=>e).forEach(e=>{e.setAttribute("class",Y("uc-thumb",{"uc-thumb--hidden":!i,"uc-thumb--visible":i}))})}initCallback(){super.initCallback(),this._createBackdrop(),this._createFrame(),this.sub("*imageBox",()=>{this._resizeBackdrop(),window.requestAnimationFrame(()=>{this._render()})}),this.sub("*cropBox",i=>{i&&(this._guidesHidden=i.height<=E||i.width<=E,window.requestAnimationFrame(()=>{this._render()}))}),this.subConfigValue("cloudImageEditorMaskHref",i=>{i&&this._createMask(i)}),this.sub("dragging",i=>{this._frameGuides&&this._frameGuides.setAttribute("class",Y({"uc-guides--hidden":this._guidesHidden,"uc-guides--visible":!this._guidesHidden&&i,"uc-guides--semi-hidden":!this._guidesHidden&&!i}))}),this.ref["svg-el"].addEventListener("pointermove",this._handleSvgPointerMove,!0),document.addEventListener("pointermove",this._handlePointerMove,!0),document.addEventListener("pointerup",this._handlePointerUp,!0)}destroyCallback(){super.destroyCallback(),document.removeEventListener("pointermove",this._handlePointerMove),document.removeEventListener("pointerup",this._handlePointerUp)}}yr.template=' <svg class="uc-svg" ref="svg-el" xmlns="http://www.w3.org/2000/svg"></svg> ';class Wt extends I{constructor(){super(...arguments);u(this,"init$",{...this.init$,active:!1,title:"",icon:"","on.click":null,"title-prop":""})}initCallback(){super.initCallback(),this._titleEl=this.ref["title-el"],this._iconEl=this.ref["icon-el"],this.sub("title",e=>{this._titleEl&&(this._titleEl.style.display=e?"block":"none")}),this.sub("active",e=>{this.className=Y({"uc-active":e,"uc-not_active":!e})}),this.sub("on.click",e=>{this.onclick=e})}}Wt.template=`
  <button role="option" type="button" set="@aria-label:title-prop;" l10n="@title:title-prop;">
    <uc-icon set="@name: icon;"></uc-icon>
    <div class="uc-title" ref="title-el">{{title}}</div>
  </button>
`;function Ql(s){let i=s+90;return i=i>=360?0:i,i}function ec(s,i){return s==="rotate"?Ql(i):["mirror","flip"].includes(s)?!i:null}class wr extends Wt{initCallback(){super.initCallback(),this.defineAccessor("operation",i=>{i&&(this._operation=i,this.$.icon=i,this.bindL10n("title-prop",()=>this.l10n("a11y-cloud-editor-apply-crop",{name:this.l10n(i).toLowerCase()})))}),this.$["on.click"]=()=>{let i=this.$["*cropperEl"].getValue(this._operation),e=ec(this._operation,i);this.$["*cropperEl"].setValue(this._operation,e)}}}const Ge={FILTER:"filter",COLOR_OPERATION:"color_operation"},me="original";class Cr extends I{constructor(){super(...arguments);u(this,"init$",{...this.init$,disabled:!1,min:0,max:100,value:0,defaultValue:0,zero:0,"on.input":e=>{this.$["*faderEl"].set(e),this.$.value=e}})}setOperation(e,t){this._controlType=e==="filter"?Ge.FILTER:Ge.COLOR_OPERATION,this._operation=e,this._iconName=e,this._title=e.toUpperCase(),this._filter=t,this._initializeValues(),this.$["*faderEl"].activate({url:this.$["*originalUrl"],operation:this._operation,value:this._filter===me?void 0:this.$.value,filter:this._filter===me?void 0:this._filter,fromViewer:!1})}_initializeValues(){let{range:e,zero:t}=Me[this._operation],[r,n]=e;this.$.min=r,this.$.max=n,this.$.zero=t;let o=this.$["*editorTransformations"][this._operation];if(this._controlType===Ge.FILTER){let a=n;if(o){let{name:l,amount:c}=o;a=l===this._filter?c:n}this.$.value=a,this.$.defaultValue=a}if(this._controlType===Ge.COLOR_OPERATION){let a=typeof o<"u"?o:t;this.$.value=a,this.$.defaultValue=a}}apply(){let e;this._controlType===Ge.FILTER?this._filter===me?e=null:e={name:this._filter,amount:this.$.value}:e=this.$.value;let t={...this.$["*editorTransformations"],[this._operation]:e};this.$["*editorTransformations"]=t}cancel(){this.$["*faderEl"].deactivate({hide:!1})}initCallback(){super.initCallback(),this.sub("*originalUrl",e=>{this._originalUrl=e}),this.sub("value",e=>{let t=`${this._filter||this._operation} ${e}`;this.$["*operationTooltip"]=t})}}Cr.template=`
  <uc-slider-ui
    ref="slider-el"
    set="disabled: disabled; min: min; max: max; defaultValue: defaultValue; zero: zero; onInput: on.input;"
  ></uc-slider-ui>
`;function qt(s){let i=new Image;return{promise:new Promise((r,n)=>{i.src=s,i.onload=r,i.onerror=n}),image:i,cancel:()=>{i.naturalWidth===0&&(i.src=Pe)}}}function hi(s){let i=[];for(let n of s){let o=qt(n);i.push(o)}let e=i.map(n=>n.image);return{promise:Promise.allSettled(i.map(n=>n.promise)),images:e,cancel:()=>{i.forEach(n=>{n.cancel()})}}}class $i extends Wt{constructor(){super(),this.init$={...this.init$,active:!1,title:"",icon:"",isOriginal:!1,iconSize:"20","on.click":null}}_previewSrc(){let i=parseInt(window.getComputedStyle(this).getPropertyValue("--l-base-min-width"),10),e=window.devicePixelRatio,t=Math.ceil(e*i),r=e>=2?"lightest":"normal",n=100,o={...this.$["*editorTransformations"]};return o[this._operation]=this._filter!==me?{name:this._filter,amount:n}:void 0,X(this._originalUrl,ge($s,Lt(o),`quality/${r}`,`scale_crop/${t}x${t}/center`))}async _observerCallback(i,e){var r;if(i[0].isIntersecting){let n=await this.proxyUrl(this._previewSrc()),o=this.ref["preview-el"],{promise:a,cancel:l}=qt(n);this._cancelPreload=l,a.catch(c=>{this.$["*networkProblems"]=!0,console.error("Failed to load image",{error:c})}).finally(()=>{o.style.backgroundImage=`url(${n})`,o.setAttribute("loaded",""),e.unobserve(this)})}else(r=this._cancelPreload)==null||r.call(this)}initCallback(){super.initCallback(),this.$["on.click"]=()=>{this.$.active?this.$.isOriginal||(this.$["*sliderEl"].setOperation(this._operation,this._filter),this.$["*showSlider"]=!0):(this.$["*sliderEl"].setOperation(this._operation,this._filter),this.$["*sliderEl"].apply()),this.$["*currentFilter"]=this._filter},this.defineAccessor("filter",e=>{this._operation="filter",this._filter=e,this.$.isOriginal=e===me,this.$.icon=this.$.isOriginal?"original":"slider",this.bindL10n("title-prop",()=>this.l10n("a11y-cloud-editor-apply-filter",{name:e.toLowerCase()}))}),this._observer=new window.IntersectionObserver(this._observerCallback.bind(this),{threshold:[0,1]});let i=this.$["*originalUrl"];this._originalUrl=i,this.$.isOriginal?this.ref["icon-el"].classList.add("uc-original-icon"):this._observer.observe(this),this.sub("*currentFilter",e=>{this.$.active=e&&e===this._filter}),this.sub("isOriginal",e=>{this.$.iconSize=e?40:20}),this.sub("active",e=>{if(this.$.isOriginal)return;let t=this.ref["icon-el"];t.style.opacity=e?"1":"0";let r=this.ref["preview-el"];e?r.style.opacity="0":r.style.backgroundImage&&(r.style.opacity="1")}),this.sub("*networkProblems",async e=>{if(!e){let t=await this.proxyUrl(this._previewSrc()),r=this.ref["preview-el"];r.style.backgroundImage&&(r.style.backgroundImage="none",r.style.backgroundImage=`url(${t})`)}})}destroyCallback(){var i,e;super.destroyCallback(),(i=this._observer)==null||i.disconnect(),(e=this._cancelPreload)==null||e.call(this)}}$i.template=`
  <button type="button" role="option" l10n="@title:title-prop;@aria-label:title-prop">
    <div class="uc-preview" ref="preview-el"></div>
    <uc-icon ref="icon-el" set="@name: icon; @size: iconSize;"></uc-icon>
  </button>
`;class Er extends Wt{constructor(){super(...arguments);u(this,"_operation","")}initCallback(){super.initCallback(),this.$["on.click"]=e=>{this.$["*sliderEl"].setOperation(this._operation),this.$["*showSlider"]=!0,this.$["*currentOperation"]=this._operation},this.defineAccessor("operation",e=>{e&&(this._operation=e,this.$.icon=e,this.bindL10n("title-prop",()=>this.l10n("a11y-cloud-editor-apply-tuning",{name:this.l10n(e).toLowerCase()})),this.bindL10n("title",()=>this.l10n(e)))}),this.sub("*editorTransformations",e=>{if(!this._operation)return;let{zero:t}=Me[this._operation],r=e[this._operation],n=typeof r<"u"?r!==t:!1;this.$.active=n})}}function tc(s,i){let e={};for(let t of i){let r=s[t];(s.hasOwnProperty(t)||r!==void 0)&&(e[t]=r)}return e}function ki(s,i,e){let r=window.devicePixelRatio,n=Math.min(Math.ceil(i*r),3e3),o=r>=2?"lightest":"normal";return X(s,ge($s,Lt(e),`quality/${o}`,`stretch/off/-/resize/${n}x`,`@clib/${zt}/${Bt}/uc-cloud-image-editor/`))}function ic(s){return s?[({dimensions:e,coords:t})=>[...e,...t].every(r=>Number.isInteger(r)&&Number.isFinite(r)),({dimensions:e,coords:t})=>e.every(r=>r>0)&&t.every(r=>r>=0)].every(e=>e(s)):!0}class Ar extends I{constructor(){super();u(this,"ctxOwner",!0);this.init$={...this.init$,image:null,"*padding":Xo,"*operations":{rotate:0,mirror:!1,flip:!1},"*imageBox":{x:0,y:0,width:0,height:0},"*cropBox":{x:0,y:0,width:0,height:0}},this._commitDebounced=H(this._commit.bind(this),300),this._handleResizeThrottled=Ii(this._handleResize.bind(this),100),this._imageSize={width:0,height:0}}_handleResize(){!this.isConnected||!this._isActive||(this._initCanvas(),this._syncTransformations(),this._alignImage(),this._alignCrop(),this._draw())}_syncTransformations(){let e=this.$["*editorTransformations"],t=tc(e,Object.keys(this.$["*operations"])),r={...this.$["*operations"],...t};this.$["*operations"]=r}_initCanvas(){let e=this.ref["canvas-el"],t=e.getContext("2d"),r=this.offsetWidth,n=this.offsetHeight,o=window.devicePixelRatio;e.style.width=`${r}px`,e.style.height=`${n}px`,e.width=r*o,e.height=n*o,t==null||t.scale(o,o),this._canvas=e,this._ctx=t}_alignImage(){if(!this._isActive||!this.$.image)return;let e=this.$.image,t=this.$["*padding"],r=this.$["*operations"],{rotate:n}=r,o={width:this.offsetWidth,height:this.offsetHeight},a=He({width:e.naturalWidth,height:e.naturalHeight},n),l;if(a.width>o.width-t*2||a.height>o.height-t*2){let c=a.width/a.height,d=o.width/o.height;if(c>d){let h=o.width-t*2,f=h/c,m=0+t,p=t+(o.height-t*2)/2-f/2;l={x:m,y:p,width:h,height:f}}else{let h=o.height-t*2,f=h*c,m=t+(o.width-t*2)/2-f/2,p=0+t;l={x:m,y:p,width:f,height:h}}}else{let{width:c,height:d}=a,h=t+(o.width-t*2)/2-c/2,f=t+(o.height-t*2)/2-d/2;l={x:h,y:f,width:c,height:d}}this.$["*imageBox"]=Ct(l)}_alignCrop(){var f;let e=this.$["*cropBox"],t=this.$["*imageBox"],r=this.$["*operations"],{rotate:n}=r,o=this.$["*editorTransformations"].crop,{width:a,x:l,y:c}=this.$["*imageBox"];if(o){let{dimensions:[m,p],coords:[b,v]}=o,{width:C}=He(this._imageSize,n),_=a/C;e=St(Ct({x:l+b*_,y:c+v*_,width:m*_,height:p*_}),this.$["*imageBox"])}const d=(f=this.$["*cropPresetList"])==null?void 0:f[0],h=d?d.width/d.height:void 0;if(!ua(e,t)||h&&!da(e,h)){const m=t.width/t.height;let p=t.width,b=t.height;h&&(m>h?p=Math.min(t.height*h,t.width):b=Math.min(t.width/h,t.height)),e={x:t.x+t.width/2-p/2,y:t.y+t.height/2-b/2,width:p,height:b}}this.$["*cropBox"]=St(Ct(e),this.$["*imageBox"])}_drawImage(){let e=this._ctx;if(!e)return;let t=this.$.image,r=this.$["*imageBox"],n=this.$["*operations"],{mirror:o,flip:a,rotate:l}=n,c=He({width:r.width,height:r.height},l);e.save(),e.translate(r.x+r.width/2,r.y+r.height/2),e.rotate(l*Math.PI*-1/180),e.scale(o?-1:1,a?-1:1),e.drawImage(t,-c.width/2,-c.height/2,c.width,c.height),e.restore()}_draw(){if(!this._isActive||!this.$.image||!this._canvas||!this._ctx)return;let e=this._canvas;this._ctx.clearRect(0,0,e.width,e.height),this._drawImage()}_animateIn({fromViewer:e}){this.$.image&&(this.ref["frame-el"].toggleThumbs(!0),this._transitionToImage(),setTimeout(()=>{this.className=Y({"uc-active_from_viewer":e,"uc-active_from_editor":!e,"uc-inactive_to_editor":!1})}))}_getCropDimensions(){let e=this.$["*cropBox"],t=this.$["*imageBox"],r=this.$["*operations"],{rotate:n}=r,{width:o,height:a}=t,{width:l,height:c}=He(this._imageSize,n),{width:d,height:h}=e,f=o/l,m=a/c;return[$e(Math.round(d/f),1,l),$e(Math.round(h/m),1,c)]}_getCropTransformation(){let e=this.$["*cropBox"],t=this.$["*imageBox"],r=this.$["*operations"],{rotate:n}=r,{width:o,height:a,x:l,y:c}=t,{width:d,height:h}=He(this._imageSize,n),{x:f,y:m}=e,p=o/d,b=a/h,v=this._getCropDimensions(),C={dimensions:v,coords:[$e(Math.round((f-l)/p),0,d-v[0]),$e(Math.round((m-c)/b),0,h-v[1])]};if(!ic(C)){console.error("Cropper is trying to create invalid crop object",{payload:C});return}if(!(v[0]===d&&v[1]===h))return C}_commit(){if(!this.isConnected||!this._imageSize)return;let e=this.$["*operations"],{rotate:t,mirror:r,flip:n}=e,o=this._getCropTransformation(),l={...this.$["*editorTransformations"],crop:o,rotate:t,mirror:r,flip:n};this.$["*editorTransformations"]=l}setValue(e,t){this.$["*operations"]={...this.$["*operations"],[e]:t},this._isActive&&(this._alignImage(),this._alignCrop(),this._draw())}getValue(e){return this.$["*operations"][e]}async activate(e,{fromViewer:t}={}){if(!this._isActive){this._isActive=!0,this._imageSize=e,this.removeEventListener("transitionend",this._reset);try{this.$.image=await this._waitForImage(this.$["*originalUrl"],this.$["*editorTransformations"]),this._syncTransformations(),this._animateIn({fromViewer:t})}catch(r){console.error("Failed to activate cropper",{error:r})}this._observer=new ResizeObserver(([r])=>{r.contentRect.width>0&&r.contentRect.height>0&&this._isActive&&this.$.image&&this._handleResizeThrottled()}),this._observer.observe(this)}}deactivate({reset:e=!1}={}){var t;this._isActive&&(!e&&this._commit(),this._isActive=!1,this._transitionToCrop(),this.className=Y({"uc-active_from_viewer":!1,"uc-active_from_editor":!1,"uc-inactive_to_editor":!0}),this.ref["frame-el"].toggleThumbs(!1),this.addEventListener("transitionend",this._reset,{once:!0}),(t=this._observer)==null||t.disconnect())}_transitionToCrop(){let e=this._getCropDimensions(),t=Math.min(this.offsetWidth,e[0])/this.$["*cropBox"].width,r=Math.min(this.offsetHeight,e[1])/this.$["*cropBox"].height,n=Math.min(t,r),o=this.$["*cropBox"].x+this.$["*cropBox"].width/2,a=this.$["*cropBox"].y+this.$["*cropBox"].height/2;this.style.transform=`scale(${n}) translate(${(this.offsetWidth/2-o)/n}px, ${(this.offsetHeight/2-a)/n}px)`,this.style.transformOrigin=`${o}px ${a}px`}_transitionToImage(){let e=this.$["*cropBox"].x+this.$["*cropBox"].width/2,t=this.$["*cropBox"].y+this.$["*cropBox"].height/2;this.style.transform="scale(1)",this.style.transformOrigin=`${e}px ${t}px`}_reset(){this._isActive||(this.$.image=null)}async _waitForImage(e,t){var d;let r=this.offsetWidth;t={...t,crop:void 0,rotate:void 0,flip:void 0,mirror:void 0};let n=await this.proxyUrl(ki(e,r,t)),{promise:o,cancel:a,image:l}=qt(n),c=this._handleImageLoading(n);return l.addEventListener("load",c,{once:!0}),l.addEventListener("error",c,{once:!0}),(d=this._cancelPreload)==null||d.call(this),this._cancelPreload=a,o.then(()=>l).catch(h=>(console.error("Failed to load image",{error:h}),this.$["*networkProblems"]=!0,Promise.resolve(l)))}_handleImageLoading(e){let t="crop",r=this.$["*loadingOperations"];return r.get(t)||r.set(t,new Map),r.get(t).get(e)||(r.set(t,r.get(t).set(e,!0)),this.$["*loadingOperations"]=r),()=>{var n;(n=r==null?void 0:r.get(t))!=null&&n.has(e)&&(r.get(t).delete(e),this.$["*loadingOperations"]=r)}}initCallback(){super.initCallback(),this.sub("*imageBox",()=>{this._draw()}),this.sub("*cropBox",()=>{this.$.image&&this._commitDebounced()}),this.sub("*cropPresetList",()=>{this._alignCrop()}),setTimeout(()=>{this.sub("*networkProblems",e=>{e||this._isActive&&this.activate(this._imageSize,{fromViewer:!1})})},0)}destroyCallback(){var e;super.destroyCallback(),(e=this._observer)==null||e.disconnect()}}Ar.template=`
  <canvas class="uc-canvas" ref="canvas-el"></canvas>
  <uc-crop-frame ref="frame-el"></uc-crop-frame>
`;function ds(s,i,e){let t=Array(e);e--;for(let r=e;r>=0;r--)t[r]=Math.ceil((r*i+(e-r)*s)/e);return t}function sc(s){return s.reduce((i,e,t)=>t<s.length-1?[...i,[e,s[t+1]]]:i,[])}function rc(s,i,e){let t=sc(s).find(([r,n])=>r<=i&&i<=n);return s.map(r=>{let n=Math.abs(t[0]-t[1]),o=Math.abs(i-t[0])/n;return t[0]===r?i>e?1:1-o:t[1]===r?i>=e?o:1:0})}function nc(s,i){return s.map((e,t)=>e<i?s.length-t:t)}function hs(s,i){let e=Me[s].keypointsNumber,{range:t,zero:r}=Me[s];return[...new Set([...ds(t[0],r,e+1),...ds(r,t[1],e+1),r,i])].sort((n,o)=>n-o)}class oc extends I{constructor(){super(),this._isActive=!1,this._hidden=!0,this._addKeypointDebounced=H(this._addKeypoint.bind(this),600),this.classList.add("uc-inactive_to_cropper")}_handleImageLoading(i){let e=this._operation,t=this.$["*loadingOperations"];return t.get(e)||t.set(e,new Map),t.get(e).get(i)||(t.set(e,t.get(e).set(i,!0)),this.$["*loadingOperations"]=t),()=>{var r;(r=t==null?void 0:t.get(e))!=null&&r.has(i)&&(t.get(e).delete(i),this.$["*loadingOperations"]=t)}}_flush(){window.cancelAnimationFrame(this._raf),this._raf=window.requestAnimationFrame(()=>{for(let i of this._keypoints){let{image:e}=i;e&&(e.style.opacity=i.opacity.toString(),e.style.zIndex=i.zIndex.toString())}})}async _imageSrc({url:i=this._url,filter:e=this._filter,operation:t,value:r}={}){let n={...this._transformations};t&&(n[t]=e?{name:e,amount:r}:r);let o=this.offsetWidth;return await this.proxyUrl(ki(i,o,n))}async _constructKeypoint(i,e){return{src:await this._imageSrc({operation:i,value:e}),image:null,opacity:0,zIndex:0,value:e}}_isSame(i,e){return this._operation===i&&this._filter===e}async _addKeypoint(i,e,t){let r=()=>!this._isSame(i,e)||this._value!==t||!!this._keypoints.find(l=>l.value===t);if(r())return;let n=await this._constructKeypoint(i,t),o=new Image;o.src=n.src;let a=this._handleImageLoading(n.src);o.addEventListener("load",a,{once:!0}),o.addEventListener("error",a,{once:!0}),n.image=o,o.classList.add("uc-fader-image"),o.addEventListener("load",()=>{if(r())return;let l=this._keypoints,c=l.findIndex(h=>h.value>t),d=c<l.length?l[c].image:null;!this._container||d&&!this._container.contains(d)||(l.splice(c,0,n),this._container.insertBefore(o,d),this._update(i,t))},{once:!0}),o.addEventListener("error",()=>{this.$["*networkProblems"]=!0},{once:!0})}set(i){i=typeof i=="string"?parseInt(i,10):i,this._update(this._operation,i),this._addKeypointDebounced(this._operation,this._filter,i)}_update(i,e){this._operation=i,this._value=e;let{zero:t}=Me[i],r=this._keypoints.map(a=>a.value),n=rc(r,e,t),o=nc(r,t);for(let[a,l]of Object.entries(this._keypoints))l.opacity=n[a],l.zIndex=o[a];this._flush()}_createPreviewImage(){let i=new Image;return i.classList.add("uc-fader-image","uc-fader-image--preview"),i.style.opacity="0",i}async _initNodes(){let i=document.createDocumentFragment();this._previewImage=this._previewImage||this._createPreviewImage(),!this.contains(this._previewImage)&&i.appendChild(this._previewImage);let e=document.createElement("div");i.appendChild(e);let t=this._keypoints.map(c=>c.src),{images:r,promise:n,cancel:o}=hi(t);r.forEach(c=>{let d=this._handleImageLoading(c.src);c.addEventListener("load",d),c.addEventListener("error",d)}),this._cancelLastImages=()=>{o(),this._cancelLastImages=void 0};let a=this._operation,l=this._filter;await n,this._isActive&&this._isSame(a,l)&&(this._container&&this._container.remove(),this._container=e,this._keypoints.forEach((c,d)=>{let h=r[d];h.classList.add("uc-fader-image"),c.image=h,this._container.appendChild(h)}),this.appendChild(i),this._flush())}async setTransformations(i){if(this._transformations=i,this._previewImage){let e=await this._imageSrc(),t=this._handleImageLoading(e);this._previewImage.src=e,this._previewImage.addEventListener("load",t,{once:!0}),this._previewImage.addEventListener("error",t,{once:!0}),this._previewImage.style.opacity="1",this._previewImage.addEventListener("error",()=>{this.$["*networkProblems"]=!0},{once:!0})}}async preload({url:i,filter:e,operation:t,value:r}){this._cancelBatchPreload&&this._cancelBatchPreload();let n=hs(t,r),o=await Promise.all(n.map(l=>this._imageSrc({url:i,filter:e,operation:t,value:l}))),{cancel:a}=hi(o);this._cancelBatchPreload=a}_setOriginalSrc(i){let e=this._previewImage||this._createPreviewImage();if(!this.contains(e)&&this.appendChild(e),this._previewImage=e,e.src===i){e.style.opacity="1",e.style.transform="scale(1)",this.className=Y({"uc-active_from_viewer":this._fromViewer,"uc-active_from_cropper":!this._fromViewer,"uc-inactive_to_cropper":!1});return}e.style.opacity="0";let t=this._handleImageLoading(i);e.addEventListener("error",t,{once:!0}),e.src=i,e.addEventListener("load",()=>{t(),e&&(e.style.opacity="1",e.style.transform="scale(1)",this.className=Y({"uc-active_from_viewer":this._fromViewer,"uc-active_from_cropper":!this._fromViewer,"uc-inactive_to_cropper":!1}))},{once:!0}),e.addEventListener("error",()=>{this.$["*networkProblems"]=!0},{once:!0})}async activate({url:i,operation:e,value:t,filter:r,fromViewer:n}){if(this._isActive=!0,this._hidden=!1,this._url=i,this._operation=e||"initial",this._value=t,this._filter=r,this._fromViewer=n,typeof t!="number"&&!r){let a=await this._imageSrc({operation:e,value:t});this._setOriginalSrc(a),this._container&&this._container.remove();return}this._keypoints=await Promise.all(hs(e,t).map(a=>this._constructKeypoint(e,a))),this._update(e,t),this._initNodes()}deactivate({hide:i=!0}={}){this._isActive=!1,this._cancelLastImages&&this._cancelLastImages(),this._cancelBatchPreload&&this._cancelBatchPreload(),i&&!this._hidden?(this._hidden=!0,this._previewImage&&(this._previewImage.style.transform="scale(1)"),this.className=Y({"uc-active_from_viewer":!1,"uc-active_from_cropper":!1,"uc-inactive_to_cropper":!0}),this.addEventListener("transitionend",()=>{this._container&&this._container.remove()},{once:!0})):this._container&&this._container.remove()}}const ac=1;class Tr extends I{initCallback(){super.initCallback(),this.addEventListener("wheel",i=>{i.preventDefault();let{deltaY:e,deltaX:t}=i;Math.abs(t)>ac?this.scrollLeft+=t:this.scrollLeft+=e},{passive:!1}),this.addEventListener("scroll",()=>{},{passive:!0})}}Tr.template=" <slot></slot> ";function lc(s){return`
    <uc-presence-toggle
      class="uc-tab-toggle"
      set="visible: presence.tabToggle.${s}; styles: presence.tabToggleStyles;"
    >
      <uc-btn-ui
        theme="tab"
        ref="tab-toggle-${s}"
        data-id="${s}"
        icon="${s}"
        set="onclick: on.clickTab; aria-role:tab_role; aria-controls:tab_${s}; title-prop: a11y-editor-tab-${s}"
      >
      </uc-btn-ui>
    </uc-presence-toggle>
  `}function cc(s){return`
    <uc-presence-toggle
      id="tab_${s}"
      class="uc-tab-content"
      set="visible: presence.tabContent.${s}; styles: presence.tabContentStyles"
    >
      <uc-editor-scroller hidden-scrollbar>
        <div class="uc-controls-list_align">
          <div
            role="listbox"
            aria-orientation="horizontal"
            class="uc-controls-list_inner"
            ref="controls-list-${s}"
          ></div>
        </div>
      </uc-editor-scroller>
    </uc-presence-toggle>
  `}class xr extends I{constructor(){super();u(this,"_updateInfoTooltip",H(()=>{var o,a;const e=this.$["*editorTransformations"],t=this.$["*currentOperation"];let r="",n=!1;if(this.$["*tabId"]===O.FILTERS)if(n=!0,this.$["*currentFilter"]&&((o=e==null?void 0:e.filter)==null?void 0:o.name)===this.$["*currentFilter"]){let l=((a=e==null?void 0:e.filter)==null?void 0:a.amount)||100;r=this.$["*currentFilter"]+" "+l}else r=this.l10n(me);else if(this.$["*tabId"]===O.TUNING&&t){n=!0;let l=(e==null?void 0:e[t])||Me[t].zero;r=this.l10n(t)+" "+l}n&&(this.$["*operationTooltip"]=r),this.ref["tooltip-el"].classList.toggle("uc-info-tooltip_visible",n)},0));this.init$={...this.init$,"*sliderEl":null,"*loadingOperations":new Map,"*showSlider":!1,"*currentFilter":me,"*currentOperation":null,showLoader:!1,filters:bn,colorOperations:gn,cropOperations:_n,"*operationTooltip":null,"presence.mainToolbar":!0,"presence.subToolbar":!1,"presence.tabToggles":!0,"presence.tabContent.crop":!1,"presence.tabContent.tuning":!1,"presence.tabContent.filters":!1,"presence.tabToggle.crop":!0,"presence.tabToggle.tuning":!0,"presence.tabToggle.filters":!0,"presence.subTopToolbarStyles":{hidden:"uc-sub-toolbar--top-hidden",visible:"uc-sub-toolbar--visible"},"presence.subBottomToolbarStyles":{hidden:"uc-sub-toolbar--bottom-hidden",visible:"uc-sub-toolbar--visible"},"presence.tabContentStyles":{hidden:"uc-tab-content--hidden",visible:"uc-tab-content--visible"},"presence.tabToggleStyles":{hidden:"uc-tab-toggle--hidden",visible:"uc-tab-toggle--visible"},"presence.tabTogglesStyles":{hidden:"uc-tab-toggles--hidden",visible:"uc-tab-toggles--visible"},"on.cancel":()=>{var e;(e=this._cancelPreload)==null||e.call(this),this.$["*on.cancel"]()},"on.apply":()=>{this.$["*on.apply"](this.$["*editorTransformations"])},"on.applySlider":()=>{this.ref["slider-el"].apply(),this._onSliderClose()},"on.cancelSlider":()=>{this.ref["slider-el"].cancel(),this._onSliderClose()},"on.clickTab":e=>{const t=e.currentTarget.getAttribute("data-id");t&&this._activateTab(t,{fromViewer:!1})},tab_role:"tab",[`tab_${O.TUNING}`]:`tab_${O.TUNING}`,[`tab_${O.CROP}`]:`tab_${O.CROP}`,[`tab_${O.FILTERS}`]:`tab_${O.FILTERS}`,cancel:"cancel",apply:"apply","a11y-editor-tab-filters":"a11y-editor-tab-filters","a11y-editor-tab-tuning":"a11y-editor-tab-tuning","a11y-editor-tab-crop":"a11y-editor-tab-crop"},this._debouncedShowLoader=H(this._showLoader.bind(this),500)}_onSliderClose(){this.$["*showSlider"]=!1,this.$["*tabId"]===O.TUNING&&this.ref["tooltip-el"].classList.toggle("uc-info-tooltip_visible",!1)}_createOperationControl(e){let t=new Er;return t.operation=e,t}_createFilterControl(e){let t=new $i;return t.filter=e,t}_createToggleControl(e){let t=new wr;return t.operation=e,t}_renderControlsList(e){let t=this.ref[`controls-list-${e}`],r=document.createDocumentFragment();e===O.CROP?this.$.cropOperations.forEach(n=>{let o=this._createToggleControl(n);r.appendChild(o)}):e===O.FILTERS?[me,...this.$.filters].forEach(n=>{let o=this._createFilterControl(n);r.appendChild(o)}):e===O.TUNING&&this.$.colorOperations.forEach(n=>{let o=this._createOperationControl(n);r.appendChild(o)}),[...r.children].forEach((n,o)=>{o===r.childNodes.length-1&&n.classList.add("uc-controls-list_last-item")}),t.innerHTML="",t.appendChild(r)}_activateTab(e,{fromViewer:t}){this.$["*tabId"]=e,e===O.CROP?(this.$["*faderEl"].deactivate(),this.$["*cropperEl"].activate(this.$["*imageSize"],{fromViewer:t})):(this.$["*faderEl"].activate({url:this.$["*originalUrl"],fromViewer:t}),this.$["*cropperEl"].deactivate());for(let r of se){let n=r===e,o=this.ref[`tab-toggle-${r}`];o.active=n,n?(this._renderControlsList(e),this._syncTabIndicator()):this._unmountTabControls(r),this.$[`presence.tabContent.${r}`]=n}}_unmountTabControls(e){let t=this.ref[`controls-list-${e}`];t&&(t.innerHTML="")}_syncTabIndicator(){let e=this.ref[`tab-toggle-${this.$["*tabId"]}`],t=this.ref["tabs-indicator"];t.style.transform=`translateX(${e.offsetLeft}px)`}async _preloadEditedImage(){var e;if(this.$["*imgContainerEl"]&&this.$["*originalUrl"]){let t=this.$["*imgContainerEl"].offsetWidth,r=await this.proxyUrl(ki(this.$["*originalUrl"],t,this.$["*editorTransformations"]));(e=this._cancelPreload)==null||e.call(this);let{cancel:n}=hi([r]);this._cancelPreload=()=>{n(),this._cancelPreload=void 0}}}_showLoader(e){this.$.showLoader=e}initCallback(){super.initCallback(),this.$["*sliderEl"]=this.ref["slider-el"],this.sub("*imageSize",e=>{e&&setTimeout(()=>{this._activateTab(this.$["*tabId"],{fromViewer:!0})},0)}),this.sub("*editorTransformations",e=>{var r;let t=(r=e==null?void 0:e.filter)==null?void 0:r.name;this.$["*currentFilter"]!==t&&(this.$["*currentFilter"]=t)}),this.sub("*currentFilter",()=>{this._updateInfoTooltip()}),this.sub("*currentOperation",()=>{this._updateInfoTooltip()}),this.sub("*tabId",()=>{this._updateInfoTooltip()}),this.sub("*originalUrl",()=>{this.$["*faderEl"]&&this.$["*faderEl"].deactivate()}),this.sub("*editorTransformations",e=>{this._preloadEditedImage(),this.$["*faderEl"]&&this.$["*faderEl"].setTransformations(e)}),this.sub("*loadingOperations",e=>{let t=!1;for(let[,r]of e.entries()){if(t)break;for(let[,n]of r.entries())if(n){t=!0;break}}this._debouncedShowLoader(t)}),this.sub("*showSlider",e=>{this.$["presence.subToolbar"]=e,this.$["presence.mainToolbar"]=!e}),this.sub("*tabList",e=>{this.$["presence.tabToggles"]=e.length>1;for(const t of se){this.$[`presence.tabToggle.${t}`]=e.includes(t);const r=this.ref[`tab-toggle-${t}`];r.style.gridColumn=e.indexOf(t)+1}e.includes(this.$["*tabId"])||this._activateTab(e[0],{fromViewer:!1})}),this._updateInfoTooltip()}destroyCallback(){this.$["*showSlider"]=!1}}xr.template=`
  <uc-line-loader-ui set="active: showLoader"></uc-line-loader-ui>
  <div class="uc-info-tooltip_container">
    <div class="uc-info-tooltip_wrapper">
      <div ref="tooltip-el" class="uc-info-tooltip uc-info-tooltip_hidden">{{*operationTooltip}}</div>
    </div>
  </div>
  <div class="uc-toolbar-container">
    <uc-presence-toggle
      role="tablist"
      class="uc-sub-toolbar"
      set="visible: presence.mainToolbar; styles: presence.subTopToolbarStyles"
    >
      <div class="uc-tab-content-row">${se.map(cc).join("")}</div>
      <div class="uc-controls-row">
        <uc-presence-toggle
          class="uc-tab-toggles"
          set="visible: presence.tabToggles; styles: presence.tabTogglesStyles"
        >
          <div ref="tabs-indicator" class="uc-tab-toggles_indicator"></div>
          ${se.map(lc).join("")}
        </uc-presence-toggle>
        <uc-btn-ui style="order: -1" theme="secondary-icon" icon="closeMax" set="onclick: on.cancel; title-prop:cancel">
        </uc-btn-ui>
        <uc-btn-ui theme="primary-icon" icon="done" set="onclick: on.apply; title-prop:apply"> </uc-btn-ui>
      </div>
    </uc-presence-toggle>
    <uc-presence-toggle
      class="uc-sub-toolbar"
      set="visible: presence.subToolbar; styles: presence.subBottomToolbarStyles"
    >
      <div class="uc-slider">
        <uc-editor-slider ref="slider-el"></uc-editor-slider>
      </div>
      <div class="uc-controls-row">
        <uc-btn-ui theme="secondary" set="onclick: on.cancelSlider" l10n="@text:cancel"> </uc-btn-ui>
        <uc-btn-ui theme="primary" set="onclick: on.applySlider" l10n="@text:apply"> </uc-btn-ui>
      </div>
    </uc-presence-toggle>
  </div>
`;class Oi extends I{constructor(){super(),this._iconReversed=!1,this._iconSingle=!1,this._iconHidden=!1,this.init$={...this.init$,text:"",icon:"",iconCss:this._iconCss(),theme:null,"aria-role":"","aria-controls":"","title-prop":""},this.defineAccessor("active",i=>{i?this.setAttribute("active",""):this.removeAttribute("active")})}_iconCss(){return Y("uc-icon",{"uc-icon_left":!this._iconReversed,"uc-icon_right":this._iconReversed,"uc-icon_hidden":this._iconHidden,"uc-icon_single":this._iconSingle})}initCallback(){super.initCallback(),this.sub("icon",i=>{this._iconSingle=!this.$.text,this._iconHidden=!i,this.$.iconCss=this._iconCss()}),this.sub("theme",i=>{i!=="custom"&&(this.className=`uc-${i}`)}),this.sub("text",i=>{this._iconSingle=!1}),this.hasAttribute("theme")||this.setAttribute("theme","default"),this.defineAccessor("aria-role",i=>{this.$["aria-role"]=i||""}),this.defineAccessor("aria-controls",i=>{this.$["aria-controls"]=i||""}),this.defineAccessor("title-prop",i=>{this.$["title-prop"]=i||""})}set reverse(i){this.hasAttribute("reverse")?(this.style.flexDirection="row-reverse",this._iconReversed=!0):(this._iconReversed=!1,this.style.flexDirection=null)}}Oi.bindAttributes({text:"text",icon:"icon",reverse:"reverse",theme:"theme"});Oi.template=`
  <button
    type="button"
    set="@role:aria-role; @aria-controls: aria-controls; @aria-label:title-prop"
    l10n="@title:title-prop;"
  >
    <uc-icon set="className: iconCss; @name: icon; @hidden: !icon"></uc-icon>
    <div class="uc-text">{{text}}</div>
  </button>
`;class Sr extends I{constructor(){super(),this._active=!1,this._handleTransitionEndRight=()=>{let i=this.ref["line-el"];i.style.transition="initial",i.style.opacity="0",i.style.transform="translateX(-101%)",this._active&&this._start()}}initCallback(){super.initCallback(),this.defineAccessor("active",i=>{typeof i=="boolean"&&(i?this._start():this._stop())})}_start(){this._active=!0;let{width:i}=this.getBoundingClientRect(),e=this.ref["line-el"];e.style.transition="transform 1s",e.style.opacity="1",e.style.transform=`translateX(${i}px)`,e.addEventListener("transitionend",this._handleTransitionEndRight,{once:!0})}_stop(){this._active=!1}}Sr.template=`
  <div class="uc-inner">
    <div class="uc-line" ref="line-el"></div>
  </div>
`;const vt={transition:"uc-transition",visible:"uc-visible",hidden:"uc-hidden"};class Ir extends I{constructor(){super(),this._visible=!1,this._visibleStyle=vt.visible,this._hiddenStyle=vt.hidden,this._externalTransitions=!1,this.defineAccessor("styles",i=>{i&&(this._externalTransitions=!0,this._visibleStyle=i.visible,this._hiddenStyle=i.hidden)}),this.defineAccessor("visible",i=>{typeof i=="boolean"&&(this._visible=i,this._handleVisible())})}_handleVisible(){this.style.visibility=this._visible?"inherit":"hidden",Xl(this,{[vt.transition]:!this._externalTransitions,[this._visibleStyle]:this._visible,[this._hiddenStyle]:!this._visible}),this.setAttribute("aria-hidden",this._visible?"false":"true")}initCallback(){super.initCallback(),this.classList.toggle("uc-initial",!0),this._externalTransitions||this.classList.add(vt.transition),this._handleVisible(),setTimeout(()=>{this.classList.toggle("uc-initial",!1)},0)}}Ir.template="<slot></slot> ";class $r extends I{constructor(){super();u(this,"init$",{...this.init$,disabled:!1,min:0,max:100,onInput:null,onChange:null,defaultValue:null,"on.sliderInput":()=>{let e=parseInt(this.ref["input-el"].value,10);this._updateValue(e),this.$.onInput&&this.$.onInput(e)},"on.sliderChange":()=>{let e=parseInt(this.ref["input-el"].value,10);this.$.onChange&&this.$.onChange(e)}});this.setAttribute("with-effects","")}initCallback(){super.initCallback(),this.defineAccessor("disabled",t=>{this.$.disabled=t}),this.defineAccessor("min",t=>{this.$.min=t}),this.defineAccessor("max",t=>{this.$.max=t}),this.defineAccessor("defaultValue",t=>{this.$.defaultValue=t,this.ref["input-el"].value=t,this._updateValue(t)}),this.defineAccessor("zero",t=>{this._zero=t}),this.defineAccessor("onInput",t=>{t&&(this.$.onInput=t)}),this.defineAccessor("onChange",t=>{t&&(this.$.onChange=t)}),this._updateSteps(),this._observer=new ResizeObserver(()=>{this._updateSteps();let t=parseInt(this.ref["input-el"].value,10);this._updateValue(t)}),this._observer.observe(this),this._thumbSize=parseInt(window.getComputedStyle(this).getPropertyValue("--l-thumb-size"),10),setTimeout(()=>{let t=parseInt(this.ref["input-el"].value,10);this._updateValue(t)},0),this.sub("disabled",t=>{let r=this.ref["input-el"];t?r.setAttribute("disabled","disabled"):r.removeAttribute("disabled")});let e=this.ref["input-el"];e.addEventListener("focus",()=>{this.style.setProperty("--color-effect","var(--hover-color-rgb)")}),e.addEventListener("blur",()=>{this.style.setProperty("--color-effect","var(--idle-color-rgb)")})}_updateValue(e){this._updateZeroDot(e);let{width:t}=this.getBoundingClientRect(),o=100/(this.$.max-this.$.min)*(e-this.$.min)*(t-this._thumbSize)/100;window.requestAnimationFrame(()=>{this.ref["thumb-el"].style.transform=`translateX(${o}px)`})}_updateZeroDot(e){if(!this._zeroDotEl)return;e===this._zero?this._zeroDotEl.style.opacity="0":this._zeroDotEl.style.opacity="1";let{width:t}=this.getBoundingClientRect(),o=100/(this.$.max-this.$.min)*(this._zero-this.$.min)*(t-this._thumbSize)/100;window.requestAnimationFrame(()=>{this._zeroDotEl.style.transform=`translateX(${o}px)`})}_updateSteps(){let t=this.ref["steps-el"],{width:r}=t.getBoundingClientRect(),n=Math.ceil(r/2),o=Math.ceil(n/15)-2;if(this._stepsCount===o)return;let a=document.createDocumentFragment(),l=document.createElement("div"),c=document.createElement("div");l.className="uc-minor-step",c.className="uc-border-step",a.appendChild(c);for(let h=0;h<o;h++)a.appendChild(l.cloneNode());a.appendChild(c.cloneNode());for(let h=0;h<o;h++)a.appendChild(l.cloneNode());a.appendChild(c.cloneNode());let d=document.createElement("div");d.className="uc-zero-dot",a.appendChild(d),this._zeroDotEl=d,t.innerHTML="",t.appendChild(a),this._stepsCount=o}destroyCallback(){var e;super.destroyCallback(),(e=this._observer)==null||e.disconnect()}}$r.template=`
  <div class="uc-steps" ref="steps-el"></div>
  <div ref="thumb-el" class="uc-thumb"></div>
  <input
    class="uc-input"
    type="range"
    ref="input-el"
    set="oninput: on.sliderInput; onchange: on.sliderChange; @min: min; @max: max; @value: defaultValue;"
  />
`;class uc extends R{constructor(){super(...arguments);u(this,"couldBeCtxOwner",!0);u(this,"activityType",g.activities.CLOUD_IMG_EDIT);u(this,"_entry");u(this,"_instance")}get activityParams(){const e=super.activityParams;if("internalId"in e)return e;throw new Error("Cloud Image Editor activity params not found")}initCallback(){super.initCallback(),this.registerActivity(this.activityType,{onActivate:()=>this.mountEditor(),onDeactivate:()=>this.unmountEditor()}),this.subConfigValue("cropPreset",e=>{this._instance&&this._instance.getAttribute("crop-preset")!==e&&this._instance.setAttribute("crop-preset",e)}),this.subConfigValue("cloudImageEditorTabs",e=>{this._instance&&this._instance.getAttribute("tabs")!==e&&this._instance.setAttribute("tabs",e)})}handleApply(e){if(!this._entry)return;let t=e.detail;this._entry.setMultipleValues({cdnUrl:t.cdnUrl,cdnUrlModifiers:t.cdnUrlModifiers}),this.modalManager.close(g.activities.CLOUD_IMG_EDIT),this.historyBack()}handleCancel(){this.modalManager.close(g.activities.CLOUD_IMG_EDIT),this.historyBack()}mountEditor(){const{internalId:e}=this.activityParams,t=this.uploadCollection.read(e);if(!t)throw new Error(`Entry with internalId "${e}" not found`);this._entry=t;const r=this._entry.getValue("cdnUrl");if(!r)throw new Error(`Entry with internalId "${e}" hasn't uploaded yet`);const n=new Ve,o=this.cfg.cropPreset,a=this.cfg.cloudImageEditorTabs;n.setAttribute("ctx-name",this.ctxName),n.setAttribute("cdn-url",r),o&&n.setAttribute("crop-preset",o),a&&n.setAttribute("tabs",a),n.addEventListener("apply",l=>{const c=l;this.handleApply(c),this.debugPrint('editor event "apply"',c.detail)}),n.addEventListener("cancel",l=>{const c=l;this.handleCancel(),this.debugPrint('editor event "cancel"',c.detail)}),n.addEventListener("change",l=>{const c=l;this.debugPrint('editor event "change"',c.detail)}),this.innerHTML="",this.appendChild(n),this._instance=n}unmountEditor(){this._instance=void 0,this._entry=void 0,this.innerHTML=""}}const dc=function(s){return s.replace(/[\\-\\[]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},hc=function(s,i="i"){const e=s.split("*").map(dc);return new RegExp("^"+e.join(".+")+"$",i)};function fc(s,i){return window.getComputedStyle(s).getPropertyValue(i).trim()}const pc=["--uc-font-family","--uc-font-size","--uc-line-height","--uc-button-size","--uc-preview-size","--uc-input-size","--uc-padding","--uc-radius","--uc-transition","--uc-background","--uc-foreground","--uc-primary","--uc-primary-hover","--uc-primary-transparent","--uc-primary-foreground","--uc-secondary","--uc-secondary-hover","--uc-secondary-foreground","--uc-muted","--uc-muted-foreground","--uc-destructive","--uc-destructive-foreground","--uc-border"];function mc(s){return pc.reduce((i,e)=>{const t=fc(s,e);return t&&(i[e]=t),i},{})}const gc=["selected-files-change"],bc=s=>!s||typeof s!="object"?!1:"type"in s&&gc.includes(s.type);class _c{constructor(i){u(this,"_handlerMap",new Map);u(this,"_context");u(this,"_handleMessage",i=>{if(i.source!==this._context)return;const e=i.data;if(!bc(e))return;const t=this._handlerMap.get(e.type);if(t)for(const r of t)r(e)});this._context=i,window.addEventListener("message",this._handleMessage)}on(i,e){const t=this._handlerMap.get(i)??new Set;this._handlerMap.has(i)||this._handlerMap.set(i,t),t.add(e)}send(i){this._context.postMessage(i,"*")}destroy(){window.removeEventListener("message",this._handleMessage)}}function vc(s){let i=[];for(let[e,t]of Object.entries(s))t==null||typeof t=="string"&&t.length===0||i.push(`${e}=${encodeURIComponent(t)}`);return i.join("&")}class kr extends R{constructor(){super();u(this,"couldBeCtxOwner",!0);u(this,"activityType",g.activities.EXTERNAL);this.init$={...this.init$,activityIcon:"",activityCaption:"",selectedList:[],total:0,isSelectionReady:!1,isDoneBtnEnabled:!1,couldSelectAll:!1,couldDeselectAll:!1,showSelectionStatus:!1,counterText:"",doneBtnTextClass:"uc-hidden",onDone:()=>{for(const e of this.$.selectedList){const t=this.extractUrlFromSelectedFile(e),{filename:r}=e,{externalSourceType:n}=this.activityParams;this.api.addFileFromUrl(t,{fileName:r,source:n})}this.$["*currentActivity"]=g.activities.UPLOAD_LIST,this.modalManager.open(g.activities.UPLOAD_LIST)},onCancel:()=>{this.historyBack()},onSelectAll:()=>{var e;(e=this._messageBridge)==null||e.send({type:"select-all"})},onDeselectAll:()=>{var e;(e=this._messageBridge)==null||e.send({type:"deselect-all"})}}}get activityParams(){const e=super.activityParams;if("externalSourceType"in e)return e;throw new Error("External Source activity params not found")}initCallback(){super.initCallback(),this.registerActivity(this.activityType,{onActivate:()=>{let{externalSourceType:e}=this.activityParams;if(!e){this.modalManager.close(this.$["*currentActivity"]),this.$["*currentActivity"]=null,console.error(`Param "externalSourceType" is required for activity "${this.activityType}"`);return}this.set$({activityCaption:`${e==null?void 0:e[0].toUpperCase()}${e==null?void 0:e.slice(1)}`,activityIcon:e}),this.mountIframe()}}),this.sub("*currentActivityParams",e=>{this.isActivityActive&&(this.unmountIframe(),this.mountIframe())}),this.sub("*currentActivity",e=>{e!==this.activityType&&this.unmountIframe()}),this.subConfigValue("multiple",e=>{this.$.showSelectionStatus=e}),this.subConfigValue("localeName",e=>{this.setupL10n()}),this.subConfigValue("externalSourcesEmbedCss",e=>{this.applyEmbedCss(e)})}extractUrlFromSelectedFile(e){if(e.alternatives){const t=le(this.cfg.externalSourcesPreferredTypes);for(const r of t){const n=hc(r);for(const[o,a]of Object.entries(e.alternatives))if(n.test(o))return a}}return e.url}async handleSelectedFilesChange(e){if(this.cfg.multiple!==e.isMultipleMode){console.error("Multiple mode mismatch");return}this.bindL10n("counterText",()=>this.l10n("selected-count",{count:e.selectedCount,total:e.total})),this.set$({doneBtnTextClass:e.isReady?"":"uc-hidden",isSelectionReady:e.isReady,isDoneBtnEnabled:e.isReady&&e.selectedFiles.length>0,showSelectionStatus:e.isMultipleMode&&e.total>0,couldSelectAll:e.selectedCount<e.total,couldDeselectAll:e.selectedCount===e.total,selectedList:e.selectedFiles})}handleIframeLoad(){this.applyEmbedCss(this.cfg.externalSourcesEmbedCss),this.applyTheme(),this.setupL10n()}applyTheme(){var e;(e=this._messageBridge)==null||e.send({type:"set-theme-definition",theme:mc(this)})}applyEmbedCss(e){var t;(t=this._messageBridge)==null||t.send({type:"set-embed-css",css:e})}setupL10n(){var e;(e=this._messageBridge)==null||e.send({type:"set-locale-definition",localeDefinition:this.cfg.localeName})}remoteUrl(){var d,h;const{pubkey:e,remoteTabSessionKey:t,socialBaseUrl:r,multiple:n}=this.cfg,{externalSourceType:o}=this.activityParams,l={lang:((h=(d=this.l10n("social-source-lang"))==null?void 0:d.split("-"))==null?void 0:h[0])||"en",public_key:e,images_only:"false",session_key:t,wait_for_theme:!0,multiple:n.toString()},c=new URL(`/window4/${o}`,r);return c.search=vc(l),c.toString()}mountIframe(){var t;let e=vs({tag:"iframe",attributes:{src:this.remoteUrl(),marginheight:0,marginwidth:0,frameborder:0,allowTransparency:!0}});e.addEventListener("load",this.handleIframeLoad.bind(this)),this.ref.iframeWrapper.innerHTML="",this.ref.iframeWrapper.appendChild(e),e.contentWindow&&((t=this._messageBridge)==null||t.destroy(),this._messageBridge=new _c(e.contentWindow),this._messageBridge.on("selected-files-change",this.handleSelectedFilesChange.bind(this)),this.resetSelectionStatus())}unmountIframe(){var e;(e=this._messageBridge)==null||e.destroy(),this._messageBridge=void 0,this.ref.iframeWrapper.innerHTML="",this.resetSelectionStatus()}resetSelectionStatus(){this.set$({selectedList:[],total:0,isDoneBtnEnabled:!1,couldSelectAll:!1,couldDeselectAll:!1,showSelectionStatus:!1})}}kr.template=`
  <uc-activity-header>
    <button
      type="button"
      class="uc-mini-btn uc-close-btn"
      set="onclick: *historyBack"
      l10n="@title:a11y-activity-header-button-close;@aria-label:a11y-activity-header-button-close"
    >
      <uc-icon name="close"></uc-icon>
    </button>
  </uc-activity-header>
  <div class="uc-content">
    <div ref="iframeWrapper" class="uc-iframe-wrapper"></div>
    <div class="uc-toolbar">
      <button type="button" class="uc-cancel-btn uc-secondary-btn" set="onclick: onCancel" l10n="cancel"></button>
      <div set="@hidden: !showSelectionStatus" class="uc-selection-status-box">
        <span>{{counterText}}</span>
        <button type="button" set="onclick: onSelectAll; @hidden: !couldSelectAll" l10n="select-all"></button>
        <button type="button" set="onclick: onDeselectAll; @hidden: !couldDeselectAll" l10n="deselect-all"></button>
      </div>
      <button type="button" class="uc-done-btn uc-primary-btn" set="onclick: onDone; @disabled: !isDoneBtnEnabled;">
        <uc-spinner set="@hidden: isSelectionReady"></uc-spinner>
        <span l10n="done" set="@class: doneBtnTextClass"></span>
      </button>
    </div>
  </div>
`;class yc extends R{constructor(){super(...arguments);u(this,"requireCtxName",!0)}_createValidationInput(){const e=document.createElement("input");return e.type="text",e.name=this.ctxName,e.required=this.cfg.multipleMin>0,e.tabIndex=-1,mi(e,{opacity:0,height:0,width:0}),e}initCallback(){super.initCallback(),this._validationInputElement=this._createValidationInput(),this.appendChild(this._validationInputElement),this.sub("*collectionState",e=>{var t;{if(this._dynamicInputsContainer||(this._dynamicInputsContainer=document.createElement("div"),this.appendChild(this._dynamicInputsContainer)),!this._validationInputElement){const a=this._createValidationInput();this.appendChild(a),this._validationInputElement=a}if(this._dynamicInputsContainer.innerHTML="",e.status==="uploading"||e.status==="idle"){this._validationInputElement.value="",this._validationInputElement.setCustomValidity("");return}if(e.status==="failed"){const a=(t=e.errors[0])==null?void 0:t.message;this._validationInputElement.value="",this._validationInputElement.setCustomValidity(a);return}const r=e.group?e.group:null;if(r){this._validationInputElement.value=r.cdnUrl,this._validationInputElement.setCustomValidity("");return}const n=e.allEntries.map(a=>a.cdnUrl);if(!this.cfg.multiple&&n.length===1){this._validationInputElement.value=n[0],this._validationInputElement.setCustomValidity("");return}this._validationInputElement.remove(),this._validationInputElement=null;const o=new DocumentFragment;for(let a of n){const l=document.createElement("input");l.type="hidden",l.name=`${this.ctxName}[]`,l.value=a,o.appendChild(l)}this._dynamicInputsContainer.replaceChildren(o)}},!1)}}class wc extends g{}class Or extends I{constructor(){super(...arguments);u(this,"init$",{...this.init$,currentText:"",options:[],selectHtml:"",onSelect:e=>{var t;e.preventDefault(),e.stopPropagation(),this.value=this.ref.select.value,this.$.currentText=((t=this.$.options.find(r=>r.value==this.value))==null?void 0:t.text)||"",this.dispatchEvent(new Event("change"))}})}initCallback(){super.initCallback(),this.sub("options",e=>{var r;this.$.currentText=((r=e==null?void 0:e[0])==null?void 0:r.text)||"";let t="";e==null||e.forEach(n=>{t+=`<option value="${n.value}">${n.text}</option>`}),this.$.selectHtml=t})}}Or.template=' <select ref="select" set="innerHTML: selectHtml; onchange: onSelect"></select> ';class Mr extends I{initCallback(){super.initCallback(),this.subConfigValue("removeCopyright",i=>{this.toggleAttribute("hidden",!!i)})}}u(Mr,"template",`
    <a
      href="https://uploadcare.com/?utm_source=copyright&utm_medium=referral&utm_campaign=v4"
      target="_blank noopener"
      class="uc-credits"
      >Powered by Uploadcare</a
    >
  `);class Lr extends at{}Lr.template=' <div class="uc-spinner"></div> ';function Cc(s){let i=new Blob([s],{type:"image/svg+xml"});return URL.createObjectURL(i)}function si(s="hsl(209, 21%, 65%)",i=32,e=32){return Cc(`
  <svg width="${i}" height="${e}" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path fill-rule="evenodd" fill="${s}" d="M9.68848 8.70068C9.68848 8.42454 9.91233 8.20068 10.1885 8.20068H15.0885C15.2211 8.20068 15.3483 8.25336 15.442 8.34713L20.342 13.2471C20.4358 13.3409 20.4885 13.4681 20.4885 13.6007V21.3007C20.4885 21.5768 20.2646 21.8007 19.9885 21.8007H10.1885C9.91233 21.8007 9.68848 21.5768 9.68848 21.3007V8.70068ZM10.6885 9.20068V20.8007H19.4885V14.1007L15.0885 14.1007C14.8123 14.1007 14.5885 13.8768 14.5885 13.6007L14.5885 9.20068H10.6885ZM15.5885 9.90779L18.7814 13.1007L15.5885 13.1007L15.5885 9.90779Z"/>
  </svg>
  `)}function fs(s,i=40){if(s.type==="image/svg+xml")return URL.createObjectURL(s);let e=document.createElement("canvas"),t=e.getContext("2d"),r=new Image,n=new Promise((o,a)=>{r.onload=()=>{let l=r.height/r.width;l>1?(e.width=i,e.height=i*l):(e.height=i,e.width=i/l),t.fillStyle="rgb(240, 240, 240)",t.fillRect(0,0,e.width,e.height),t.drawImage(r,0,0,e.width,e.height),e.toBlob(c=>{if(!c){a();return}let d=URL.createObjectURL(c);o(d)})},r.onerror=l=>{a(l)}});return r.src=URL.createObjectURL(s),n}const Ec=3e3;class Mi extends hr{constructor(){super();u(this,"_renderedGridOnce",!1);u(this,"_thumbRect",null);u(this,"_isIntersecting",!1);u(this,"_firstViewMode",this.cfg.filesViewMode);u(this,"_generateThumbnail",this._withEntry(async(e,t=!1)=>{const r=e.getValue("fileInfo"),n=e.getValue("isImage"),o=e.getValue("uuid"),a=e.getValue("thumbUrl");let l=this._calculateThumbSize(t);if(r&&n&&o){let d=await this.proxyUrl(X(tt(this.cfg.cdnCname,o),ge(e.getValue("cdnUrlModifiers"),"stretch/off",`scale_crop/${l}x${l}/center`)));if(a===d)return;const{promise:h}=qt(d);h.then(()=>{e.setValue("thumbUrl",d),a!=null&&a.startsWith("blob:")&&URL.revokeObjectURL(a)}).catch(async()=>{if(!(a!=null&&a.startsWith("blob:")))try{const f=e.getValue("file");if(!f)return;const m=await fs(f,l);e.setValue("thumbUrl",m)}catch{const m=window.getComputedStyle(this).getPropertyValue("--uc-muted-foreground");e.setValue("thumbUrl",si(m))}});return}if(e.getValue("thumbUrl"))return;const c=e.getValue("file");if(c!=null&&c.type.includes("image"))try{let d=await fs(c,l);e.setValue("thumbUrl",d)}catch{let h=window.getComputedStyle(this).getPropertyValue("--uc-muted-foreground");e.setValue("thumbUrl",si(h))}else{let d=window.getComputedStyle(this).getPropertyValue("--uc-muted-foreground");e.setValue("thumbUrl",si(d))}}));u(this,"_debouncedGenerateThumb",H(this._generateThumbnail.bind(this),100));this.init$={...this.init$,thumbUrl:"",badgeIcon:"",uid:""}}_calculateThumbSize(e=!1){var r,n;e&&(this._thumbRect=this.getBoundingClientRect());let t=Math.max(parseInt(String(((r=this==null?void 0:this._thumbRect)==null?void 0:r.height)||0)),parseInt(String(((n=this==null?void 0:this._thumbRect)==null?void 0:n.width)||0)),this.cfg.thumbSize);return window.devicePixelRatio>1&&(t*=window.devicePixelRatio),Math.min(t,Ec)}_observerCallback(e){var r;const[t]=e;this._isIntersecting=t.isIntersecting,t.isIntersecting&&(this._thumbRect=t.boundingClientRect,this._debouncedGenerateThumb(),(r=this._observer)==null||r.disconnect()),t.intersectionRatio===0&&this._debouncedGenerateThumb.cancel()}_reset(){super._reset(),this._debouncedGenerateThumb.cancel()}_handleEntryId(e){var r;this._reset();let t=(r=this.uploadCollection)==null?void 0:r.read(e);this._entry=t,t&&(this._subEntry("fileInfo",n=>{n!=null&&n.isImage&&this._isIntersecting&&this._debouncedGenerateThumb()}),this._subEntry("thumbUrl",n=>{this.$.thumbUrl=n?`url(${n})`:""}),this._subEntry("cdnUrlModifiers",()=>{this._isIntersecting&&this._debouncedGenerateThumb()}),this._isIntersecting&&this._debouncedGenerateThumb())}initCallback(){super.initCallback(),this.defineAccessor("badgeIcon",e=>this.$.badgeIcon=e),this.defineAccessor("uid",e=>{this.set$({uid:e})}),this.sub("uid",e=>{this._handleEntryId(e)}),this.subConfigValue("filesViewMode",e=>{e==="grid"&&!this._renderedGridOnce&&(this._firstViewMode==="list"&&this._debouncedGenerateThumb(!0),this._renderedGridOnce=!0)}),this.setAttribute("role","img")}connectedCallback(){super.connectedCallback(),this._observer=new window.IntersectionObserver(this._observerCallback.bind(this),{threshold:.1}),this._observer.observe(this)}disconnectedCallback(){var e;super.disconnectedCallback(),this._entrySubs=new Set,this._debouncedGenerateThumb.cancel(),(e=this._observer)==null||e.disconnect()}}Mi.template=`
  <div class="uc-thumb" set="style.backgroundImage: thumbUrl">
    <div class="uc-badge">
      <uc-icon set="@name: badgeIcon"></uc-icon>
    </div>
  </div>
`;Mi.bindAttributes({badgeIcon:null,uid:null});const Ye=class Ye extends ct{constructor(){super(),this.init$={...this.init$,isHidden:!1}}initCallback(){super.initCallback(),this.defineAccessor("headless",i=>{this.set$({isHidden:S(i)})})}};u(Ye,"styleAttrs",[...de(Ye,Ye,"styleAttrs"),"uc-file-uploader-regular"]);let Ue=Ye;Ue.template=`
  <uc-simple-btn set="@hidden: isHidden"></uc-simple-btn>

  <uc-modal id="start-from" strokes block-body-scrolling>
    <uc-start-from>
      <uc-drop-area with-icon clickable></uc-drop-area>
      <uc-source-list role="list" wrap></uc-source-list>
      <button type="button" l10n="start-from-cancel" class="uc-secondary-btn" set="onclick: *historyBack"></button>
      <uc-copyright></uc-copyright>
    </uc-start-from>
  </uc-modal>

  <uc-modal id="upload-list" strokes block-body-scrolling>
    <uc-upload-list></uc-upload-list>
  </uc-modal>

  <uc-modal id="camera" strokes block-body-scrolling>
    <uc-camera-source></uc-camera-source>
  </uc-modal>

  <uc-modal id="url" strokes block-body-scrolling>
    <uc-url-source></uc-url-source>
  </uc-modal>

  <uc-modal id="external" strokes block-body-scrolling>
    <uc-external-source></uc-external-source>
  </uc-modal>

  <uc-modal id="cloud-image-edit" strokes block-body-scrolling>
    <uc-cloud-image-editor-activity></uc-cloud-image-editor-activity>
  </uc-modal>
`;Ue.bindAttributes({headless:null});const ri="active",yt="",Je=class Je extends ct{constructor(){super(),this.init$={...this.init$,singleUpload:!1,isHiddenStartFrom:!1,classUploadList:yt,classStartFrom:yt}}_handleModalOpen(i){var e;i.id===g.activities.CLOUD_IMG_EDIT&&this.set$({classUploadList:ri}),this.$["*currentActivity"]===g.activities.UPLOAD_LIST&&this.set$({classUploadList:ri,isHiddenStartFrom:!0}),((e=this.$["*uploadList"])==null?void 0:e.length)<=0&&this.set$({classStartFrom:ri})}_handleModalClose(i){i.id===this.$["*currentActivity"]&&(this.$["*currentActivity"]=g.activities.UPLOAD_LIST,this.set$({isHiddenStartFrom:!1})),i.id===g.activities.CLOUD_IMG_EDIT&&(this.$["*currentActivity"]=g.activities.UPLOAD_LIST)}initCallback(){super.initCallback();const i=this.ref.uBlock;this.sub("*currentActivity",e=>{e===g.activities.UPLOAD_LIST&&this.modalManager.closeAll(),e||(this.$["*currentActivity"]=i.initActivity||g.activities.START_FROM)}),this.sub("*uploadList",e=>{(e==null?void 0:e.length)>0?(this.$["*currentActivity"]=g.activities.UPLOAD_LIST,this.set$({classStartFrom:yt})):(this.set$({classUploadList:yt,isHiddenStartFrom:!1}),this.$["*currentActivity"]=i.initActivity||g.activities.START_FROM)}),this.subConfigValue("confirmUpload",e=>{e!==!1&&(this.cfg.confirmUpload=!1)}),this.subConfigValue("filesViewMode",e=>{this.setAttribute("mode",e),this.subConfigValue("multiple",t=>{e==="grid"?(t?this.style.removeProperty("--uc-grid-col"):this.style.setProperty("--uc-grid-col","1"),this.$.singleUpload=!t):(this.style.removeProperty("--uc-grid-col"),this.$.singleUpload=!1)})}),this.handleModalOpen=this._handleModalOpen.bind(this),this.handleModalClose=this._handleModalClose.bind(this),this.modalManager.subscribe(P.OPEN,this.handleModalOpen),this.modalManager.subscribe(P.CLOSE,this.handleModalClose)}destroyCallback(){super.destroyCallback(),this.modalManager.unsubscribe(P.OPEN,this.handleModalOpen),this.modalManager.unsubscribe(P.CLOSE,this.handleModalClose)}};u(Je,"styleAttrs",[...de(Je,Je,"styleAttrs"),"uc-file-uploader-minimal"]);let Re=Je;Re.template=`
  <uc-start-from set="@hidden: isHiddenStartFrom; @class:classStartFrom">
    <uc-drop-area set="@single:singleUpload;" initflow clickable tabindex="0" l10n="choose-file"></uc-drop-area>
    <uc-copyright></uc-copyright>
  </uc-start-from>
  <uc-upload-list set="@class:classUploadList" ref="uBlock"></uc-upload-list>

  <uc-modal id="start-from" strokes block-body-scrolling>
    <uc-start-from>
      <uc-drop-area with-icon clickable></uc-drop-area>
      <uc-source-list role="list" wrap></uc-source-list>
      <button type="button" l10n="start-from-cancel" class="uc-secondary-btn" set="onclick: *historyBack"></button>
    </uc-start-from>
  </uc-modal>

  <uc-modal id="camera" strokes block-body-scrolling>
    <uc-camera-source></uc-camera-source>
  </uc-modal>

  <uc-modal id="url" strokes block-body-scrolling>
    <uc-url-source></uc-url-source>
  </uc-modal>

  <uc-modal id="external" strokes block-body-scrolling>
    <uc-external-source></uc-external-source>
  </uc-modal>

  <uc-modal id="cloud-image-edit" strokes block-body-scrolling>
    <uc-cloud-image-editor-activity></uc-cloud-image-editor-activity>
  </uc-modal>
`;const Qe=class Qe extends ct{constructor(){super(),this.init$={...this.init$,couldCancel:!1,cancel:()=>{this.couldHistoryBack?this.$["*historyBack"]():this.couldShowList&&(this.$["*currentActivity"]=g.activities.UPLOAD_LIST)}}}get couldHistoryBack(){const i=this.$["*history"];return i.length>1&&i[i.length-1]!==g.activities.START_FROM}get couldShowList(){return this.cfg.showEmptyList||this.$["*uploadList"].length>0}initCallback(){super.initCallback();const i=this.ref.uBlock;this.sub("*currentActivity",e=>{e||(this.$["*currentActivity"]=i.initActivity||g.activities.START_FROM)}),this.sub("*uploadList",e=>{(e==null?void 0:e.length)>0&&this.$["*currentActivity"]===(i.initActivity||g.activities.START_FROM)&&(this.$["*currentActivity"]=g.activities.UPLOAD_LIST)}),this.sub("*history",()=>{this.$.couldCancel=this.couldHistoryBack||this.couldShowList})}};u(Qe,"styleAttrs",[...de(Qe,Qe,"styleAttrs"),"uc-file-uploader-inline"]);let Mt=Qe;Mt.template=`
  <uc-start-from>
    <uc-drop-area with-icon clickable></uc-drop-area>
    <uc-source-list role="list" wrap></uc-source-list>
    <button
      type="button"
      l10n="start-from-cancel"
      class="uc-cancel-btn uc-secondary-btn"
      set="onclick: cancel; @hidden: !couldCancel"
    ></button>
    <uc-copyright></uc-copyright>
  </uc-start-from>
  <uc-upload-list ref="uBlock"></uc-upload-list>
  <uc-camera-source></uc-camera-source>
  <uc-url-source></uc-url-source>
  <uc-external-source></uc-external-source>
  <uc-cloud-image-editor-activity></uc-cloud-image-editor-activity>
`;const et=class et extends Ve{initCallback(){var i;super.initCallback(),(i=this.a11y)==null||i.registerBlock(this)}};u(et,"styleAttrs",[...de(et,et,"styleAttrs"),"uc-wgt-common"]);let fi=et;function ut(s){for(let i in s){let e=[...i].reduce((t,r)=>(r.toUpperCase()===r&&(r="-"+r.toLowerCase()),t+=r),"");e.startsWith("-")&&(e=e.replace("-","")),e.startsWith("uc-")||(e="uc-"+e),s[i].reg&&s[i].reg(e)}}const ni="UC";async function Ac(s,i=!1){return new Promise((e,t)=>{if(typeof document!="object"){e(null);return}if(typeof window=="object"&&window[ni]){e(window[ni]);return}let r=document.createElement("script");r.async=!0,r.src=s,r.onerror=()=>{t()},r.onload=()=>{let n=window[ni];i&&ut(n),e(n)},document.head.appendChild(r)})}const Li=Object.freeze(Object.defineProperty({__proto__:null,ActivityBlock:g,ActivityHeader:wc,BaseComponent:at,Block:I,BtnUi:Oi,CameraSource:mr,CloudImageEditor:fi,CloudImageEditorActivity:uc,CloudImageEditorBlock:Ve,Config:er,Copyright:Mr,CropFrame:yr,Data:x,DropArea:rt,EditorCropButtonControl:wr,EditorFilterControl:$i,EditorImageCropper:Ar,EditorImageFader:oc,EditorOperationControl:Er,EditorScroller:Tr,EditorSlider:Cr,EditorToolbar:xr,ExternalSource:kr,ExternalUploadSource:Ht,FileItem:Ae,FileUploaderInline:Mt,FileUploaderMinimal:Re,FileUploaderRegular:Ue,FormInput:yc,Icon:xi,Img:ul,LineLoaderUi:Sr,Modal:Ot,ModalEvents:P,PACKAGE_NAME:zt,PACKAGE_VERSION:Bt,PresenceToggle:Ir,ProgressBar:_r,ProgressBarCommon:br,Select:Or,SimpleBtn:st,SliderUi:$r,SolutionBlock:ct,SourceBtn:Si,SourceList:bl,Spinner:Lr,StartFrom:ir,Thumb:Mi,UID:ot,UploadCtxProvider:di,UploadList:fr,UploadSource:U,UploaderBlock:R,UrlSource:pr,defineComponents:ut,defineLocale:qs,loadFileUploaderFrom:Ac,toKebabCase:jt},Symbol.toStringTag,{value:"Module"})),Tc=new Set(["children","ref","style","className"]),xc=(s={})=>Object==null?void 0:Object.keys(s).reduce((i,e)=>{var t,r;const n=s==null?void 0:s[e],o=`on${(r=(t=n==null?void 0:n.split("-"))==null?void 0:t.map(a=>a.charAt(0).toUpperCase()+a.slice(1)))==null?void 0:r.join("")}`;return i[o]=n,i},{}),ps=new WeakMap,Sc=s=>{let i=ps.get(s);return i===void 0&&(i=new Map,ps.set(s,i)),i},ms=({node:s,nameProp:i,valueProp:e,prevValueProp:t,event:r})=>{if(r!==void 0){if(e!==t){const n=Sc(s),o=n.has(r);let a=n.get(r);e!==void 0?o?a.handleEvent=e:(a={handleEvent:e},n.set(r,a),s.addEventListener(r,l=>a.handleEvent(l.detail))):o&&(n.delete(r),s.removeEventListener(r,a))}return}s[i]=e,e==null&&i in HTMLElement.prototype&&s.removeAttribute(i)},Ic=(s,i,e)=>{const t={},r={};return Object.entries(s).forEach(([n,o])=>{Tc.has(n)?t[n==="className"?"class":n]=o:i.has(n)||n in e.prototype?r[n]=o:t[n]=o}),{reactProps:t,customElProps:r}},dt=({react:s,tag:i,elClass:e,schemaEvents:t})=>{const r=xc(t),n=new Set(Object.keys(r??{})),o=s.forwardRef((a,l)=>{const c=s.useRef(new Map),d=s.useRef(null),{reactProps:h,customElProps:f}=Ic(a,n,e);return s.useLayoutEffect(()=>{if(d.current===null)return;const m=new Map;for(const p in f)ms({node:d.current,nameProp:p,valueProp:f[p],prevValueProp:c.current.get(p),event:r[p]}),c.current.delete(p),m.set(p,a[p]);for(const[p,b]of c.current)ms({node:d.current,nameProp:p,valueProp:void 0,prevValueProp:b,event:r[p]});c.current=m}),s.createElement(i??e.__tag,{...h,ref:s.useCallback(m=>{d.current=m,typeof l=="function"?l(m):l!==null&&(l.current=m)},[l])})});return o.displayName=e.name,o},$c=dt({react:ie,tag:"uc-config",elClass:er}),kc=dt({react:ie,tag:"uc-upload-ctx-provider",elClass:di,schemaEvents:di.EventType}),Oc=s=>{const i={},e={},t={};for(const[r,n]of Object.entries(s)){if(r.startsWith("on")){i[r]=n;continue}if(r==="headless"){t[r]=n;continue}e[r]=n}return{eventHandlers:i,uploader:t,config:e}},Mc="1.8.0",Lc="React-Uploader",Pc=()=>`${Lc}/${Mc}`,Uc=({children:s})=>s,Rc=()=>{const[s,i]=Et.useState(!1);return Et.useEffect(()=>{typeof window<"u"&&i(!0)},[]),s};ut(Li);const Dc=dt({react:ie,tag:"uc-file-uploader-regular",elClass:Ue}),Fc=({ctxName:s,className:i,classNameUploader:e,apiRef:t,fallback:r,...n})=>{const o=Et.useMemo(()=>s??ot.generate(),[s]),{eventHandlers:a,config:l,uploader:c}=Et.useMemo(()=>Oc(n),[n]),d=Rc();return ie.createElement(Uc,{condition:d,fallback:r},ie.createElement("div",{className:i},ie.createElement($c,{userAgentIntegration:Pc(),"ctx-name":o,...l}),ie.createElement(kc,{ref:t,"ctx-name":o,...a}),ie.createElement(Dc,{class:e,"ctx-name":o,...c})))};ut(Li);dt({react:ie,tag:"uc-file-uploader-minimal",elClass:Re});ut(Li);dt({react:ie,tag:"uc-file-uploader-inline",elClass:Re});function Bc({publicKey:s,value:i,onChange:e,ctxName:t}){const r=n=>{const o=n.allEntries.find(a=>a.status==="success");o&&o.cdnUrl&&e(o.cdnUrl)};return Ne.jsx(Ne.Fragment,{children:Ne.jsxs("div",{className:"mb-4 flex flex-col items-center",children:[Ne.jsx(Fc,{ctxName:t||"single-file-uploader",classNameUploader:"uc-dark",className:"fileUploaderWrapper",pubkey:s,multiple:!1,imgOnly:!0,onChange:r}),i&&Ne.jsx("img",{src:i,alt:"Preview",className:"mt-4 max-h-40 rounded shadow"})]})})}const Pr=Nr({id:ht(),slug:ht(),name:ht(),imageUrl:ht(),createdAt:Pi(),updatedAt:Pi()}),Hc=Pr.pick({name:!0,imageUrl:!0}),jc=Pr.pick({id:!0,name:!0,imageUrl:!0});export{Pr as A,Hc as C,Bc as S,jc as U};
